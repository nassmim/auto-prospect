{"version":3,"sources":["../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/services/message.service.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/lib/cache.config.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/server/web/spec-extension/cookies.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/shared/lib/action-revalidation-kind.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/shared/lib/promise-with-resolvers.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/server/app-render/staged-rendering.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/packages/shared/src/config/message.config.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/services/account.service.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/http-access-fallback/http-access-fallback.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/redirect-status-code.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/redirect-error.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/is-next-router-error.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/services/credit.service.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/server/app-render/module-loading/track-dynamic-import.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/node_modules/.pnpm/next%4016.1.1_%40babel%2Bcore%407.28.6_%40opentelemetry%2Bapi%401.9.0_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/build/webpack/loaders/next-flight-loader/track-dynamic-import.ts"],"sourcesContent":["/**\n * Message templating and rendering service\n * Handles variable replacement and message formatting\n */\n\nimport { pages } from \"@/config/routes\";\nimport { CACHE_TAGS } from \"@/lib/cache.config\";\nimport { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport { getUserAccount } from \"@/services/account.service\";\nimport { consumeCredit } from \"@/services/credit.service\";\nimport {\n  creditTransactions,\n  eq,\n  leadNotes,\n  messages,\n  TDBWithTokenClient,\n} from \"@auto-prospect/db\";\nimport { EContactChannel } from \"@auto-prospect/shared/src/config/message.config\";\nimport { revalidatePath, updateTag } from \"next/cache\";\n\nexport type TTemplateVariables = {\n  titre_annonce?: string;\n  prix?: string;\n  marque?: string;\n  modele?: string;\n  annee?: string;\n  ville?: string;\n  vendeur_nom?: string;\n};\n\n/**\n * Get the default WhatsApp template for the account\n */\nexport async function getDefaultWhatsAppTemplate(leadId: string) {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  try {\n    // First get the lead's account\n    const lead = await dbClient.rls(async (tx) => {\n      return tx.query.leads.findFirst({\n        where: (table, { eq }) => eq(table.id, leadId),\n        columns: {\n          accountId: true,\n        },\n      });\n    });\n\n    if (!lead) {\n      throw new Error(\"Lead not found\");\n    }\n\n    // Get the default WhatsApp template\n    const template = await dbClient.rls(async (tx) => {\n      return tx.query.messageTemplates.findFirst({\n        where: (table, { eq, and }) =>\n          and(\n            eq(table.accountId, lead.accountId),\n            eq(table.channel, EContactChannel.WHATSAPP_TEXT),\n            eq(table.isDefault, true),\n          ),\n      });\n    });\n\n    return template;\n  } catch {\n    throw new Error(\"Failed to fetch WhatsApp template\");\n  }\n}\n\n/**\n * Log a WhatsApp message attempt\n * MVP: Just logs the message, doesn't actually send via API\n */\nexport async function logWhatsAppMessage(\n  leadId: string,\n  renderedMessage: string,\n  templateId?: string,\n) {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  try {\n    // Get the lead's huntId first (needed for credit consumption)\n    const lead = await dbClient.rls(async (tx) => {\n      return await tx.query.leads.findFirst({\n        where: (table, { eq }) => eq(table.id, leadId),\n        columns: { huntId: true, assignedToId: true, accountId: true },\n      });\n    });\n\n    if (!lead) {\n      throw new Error(\"Lead not found\");\n    }\n\n    // Consume credit first - if this fails, we don't log the message\n    const creditResult = await consumeCredit({\n      huntId: lead.huntId,\n      channel: EContactChannel.WHATSAPP_TEXT,\n    });\n\n    if (!creditResult.success) {\n      throw new Error(creditResult.error);\n    }\n\n    // Credit consumed successfully - now log the message\n    const messageRecord = await dbClient.rls(async (tx) => {\n      // Log message in messages table\n      const [insertedMessage] = await tx\n        .insert(messages)\n        .values({\n          leadId,\n          templateId: templateId || null,\n          channel: EContactChannel.WHATSAPP_TEXT,\n          content: renderedMessage,\n          status: \"sent\", // MVP: assume sent immediately\n          sentAt: new Date(),\n          sentById: lead.assignedToId || lead.accountId,\n        })\n        .returning();\n\n      // Log activity\n      await tx.insert(leadNotes).values({\n        leadId,\n        content: `Message WhatsApp envoyé`,\n      });\n\n      return insertedMessage;\n    });\n\n    // Update the credit transaction with the messageId for audit trail\n    if (messageRecord?.id && creditResult.transaction?.id) {\n      // Update the transaction with the messageId reference\n      await dbClient.admin\n        .update(creditTransactions)\n        .set({\n          referenceId: messageRecord.id,\n          metadata: {\n            messageId: messageRecord.id,\n          },\n        })\n        .where(eq(creditTransactions.id, creditResult.transaction.id));\n    }\n\n    revalidatePath(pages.leads.detail(leadId));\n\n    return { success: true };\n  } catch (error) {\n    throw new Error(\n      error instanceof Error ? error.message : \"Failed to log WhatsApp message\",\n    );\n  }\n}\n\n/**\n * Fetch all templates for the user's account\n */\nexport async function getAccountTemplates() {\n  const dbClient = await createDrizzleSupabaseClient();\n  const account = await getUserAccount(dbClient, {\n    columnsToKeep: { id: true },\n  });\n  return getCachedAccountTemplates(account.id, dbClient);\n}\n\n/**\n * Internal cached function for account templates\n */\nasync function getCachedAccountTemplates(\n  accountId: string,\n  dbClient: TDBWithTokenClient,\n) {\n  \"use cache\";\n\n  const { cacheTag } = await import(\"next/cache\");\n  const { CACHE_TAGS } = await import(\"@/lib/cache.config\");\n\n  cacheTag(CACHE_TAGS.templatesByAccount(accountId));\n\n  const client = dbClient || (await createDrizzleSupabaseClient());\n\n  try {\n    // Fetch all templates for this account\n    const templates = await client.rls(async (tx) => {\n      return tx.query.messageTemplates.findMany({\n        where: (table, { eq }) => eq(table.accountId, accountId),\n        with: {\n          account: {\n            columns: {\n              id: true,\n              name: true,\n            },\n          },\n        },\n        orderBy: (table, { desc }) => [desc(table.createdAt)],\n      });\n    });\n\n    return templates;\n  } catch (error) {\n    console.error(\"Error fetching templates:\", error);\n    throw new Error(\"Failed to fetch templates\");\n  }\n}\n\nexport type MessageTemplate = Awaited<\n  ReturnType<typeof import(\"@/services/message.service\").getAccountTemplates>\n>[number];\n\n/**\n * Checks if the user has an SMS API key configured\n */\nexport async function hasSmsApiKeyAction(): Promise<boolean> {\n  try {\n    const account = await getUserAccount(undefined, {\n      columnsToKeep: { id: true, smsApiKey: true },\n    });\n\n    return !!account.smsApiKey;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Checks if the user is allowed to configure SMS Mobile API\n */\nexport async function isSmsApiAllowedAction(): Promise<boolean> {\n  try {\n    const account = await getUserAccount(undefined, {\n      columnsToKeep: { id: true, smsMobileAPiAllowed: true },\n    });\n\n    return !!account.smsMobileAPiAllowed;\n  } catch {\n    return false;\n  }\n}\n\nexport const updateAccountTemplatesCache = async (\n  dbClient: TDBWithTokenClient,\n  accountId?: string,\n) => {\n  let accountIdToUse = accountId;\n  if (!accountIdToUse) {\n    const account = await getUserAccount(dbClient, {\n      columnsToKeep: { id: true },\n    });\n    accountIdToUse = account.id;\n  }\n\n  updateTag(CACHE_TAGS.templatesByAccount(accountIdToUse));\n};\n","/**\n * Cache tag constants for consistent tagging across the application\n * Used with Next.js 16 'use cache' directive and updateTag()\n */\nexport const CACHE_TAGS = {\n  // Hunt configuration (without credits)\n  huntsByAccount: (accountId: string) => `hunts:${accountId}`,\n  hunt: (id: string) => `hunt:${id}`,\n\n  // Message templates\n  templatesByAccount: (accountId: string) => `templates:${accountId}`,\n\n  // Team members\n  teamMembersByAccount: (accountId: string) => `team-members:${accountId}`,\n\n  // Account-specific data\n  account: (id: string) => `account:${id}`,\n} as const;\n","export {\n  RequestCookies,\n  ResponseCookies,\n  stringifyCookie,\n} from 'next/dist/compiled/@edge-runtime/cookies'\n","export type ActionRevalidationKind = 0 | 1 | 2\n\nexport const ActionDidNotRevalidate = 0\nexport const ActionDidRevalidateStaticAndDynamic = 1\nexport const ActionDidRevalidateDynamicOnly = 2\n","export function createPromiseWithResolvers<T>(): PromiseWithResolvers<T> {\n  // Shim of Stage 4 Promise.withResolvers proposal\n  let resolve: (value: T | PromiseLike<T>) => void\n  let reject: (reason: any) => void\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n  return { resolve: resolve!, reject: reject!, promise }\n}\n","import { InvariantError } from '../../shared/lib/invariant-error'\nimport { createPromiseWithResolvers } from '../../shared/lib/promise-with-resolvers'\n\nexport enum RenderStage {\n  Before = 1,\n  Static = 2,\n  Runtime = 3,\n  Dynamic = 4,\n  Abandoned = 5,\n}\n\nexport type NonStaticRenderStage = RenderStage.Runtime | RenderStage.Dynamic\n\nexport class StagedRenderingController {\n  currentStage: RenderStage = RenderStage.Before\n\n  staticInterruptReason: Error | null = null\n  runtimeInterruptReason: Error | null = null\n  staticStageEndTime: number = Infinity\n  runtimeStageEndTime: number = Infinity\n\n  private runtimeStageListeners: Array<() => void> = []\n  private dynamicStageListeners: Array<() => void> = []\n\n  private runtimeStagePromise = createPromiseWithResolvers<void>()\n  private dynamicStagePromise = createPromiseWithResolvers<void>()\n\n  private mayAbandon: boolean = false\n\n  constructor(\n    private abortSignal: AbortSignal | null = null,\n    private hasRuntimePrefetch: boolean\n  ) {\n    if (abortSignal) {\n      abortSignal.addEventListener(\n        'abort',\n        () => {\n          const { reason } = abortSignal\n          if (this.currentStage < RenderStage.Runtime) {\n            this.runtimeStagePromise.promise.catch(ignoreReject) // avoid unhandled rejections\n            this.runtimeStagePromise.reject(reason)\n          }\n          if (\n            this.currentStage < RenderStage.Dynamic ||\n            this.currentStage === RenderStage.Abandoned\n          ) {\n            this.dynamicStagePromise.promise.catch(ignoreReject) // avoid unhandled rejections\n            this.dynamicStagePromise.reject(reason)\n          }\n        },\n        { once: true }\n      )\n\n      this.mayAbandon = true\n    }\n  }\n\n  onStage(stage: NonStaticRenderStage, callback: () => void) {\n    if (this.currentStage >= stage) {\n      callback()\n    } else if (stage === RenderStage.Runtime) {\n      this.runtimeStageListeners.push(callback)\n    } else if (stage === RenderStage.Dynamic) {\n      this.dynamicStageListeners.push(callback)\n    } else {\n      // This should never happen\n      throw new InvariantError(`Invalid render stage: ${stage}`)\n    }\n  }\n\n  canSyncInterrupt() {\n    // If we haven't started the render yet, it can't be interrupted.\n    if (this.currentStage === RenderStage.Before) {\n      return false\n    }\n\n    const boundaryStage = this.hasRuntimePrefetch\n      ? RenderStage.Dynamic\n      : RenderStage.Runtime\n    return this.currentStage < boundaryStage\n  }\n\n  syncInterruptCurrentStageWithReason(reason: Error) {\n    if (this.currentStage === RenderStage.Before) {\n      return\n    }\n\n    // If Sync IO occurs during the initial (abandonable) render, we'll retry it,\n    // so we want a slightly different flow.\n    // See the implementation of `abandonRenderImpl` for more explanation.\n    if (this.mayAbandon) {\n      return this.abandonRenderImpl()\n    }\n\n    // If we're in the final render, we cannot abandon it. We need to advance to the Dynamic stage\n    // and capture the interruption reason.\n    switch (this.currentStage) {\n      case RenderStage.Static: {\n        this.staticInterruptReason = reason\n        this.advanceStage(RenderStage.Dynamic)\n        return\n      }\n      case RenderStage.Runtime: {\n        // We only error for Sync IO in the runtime stage if the route\n        // is configured to use runtime prefetching.\n        // We do this to reflect the fact that during a runtime prefetch,\n        // Sync IO aborts aborts the render.\n        // Note that `canSyncInterrupt` should prevent us from getting here at all\n        // if runtime prefetching isn't enabled.\n        if (this.hasRuntimePrefetch) {\n          this.runtimeInterruptReason = reason\n          this.advanceStage(RenderStage.Dynamic)\n        }\n        return\n      }\n      case RenderStage.Dynamic:\n      case RenderStage.Abandoned:\n      default:\n    }\n  }\n\n  getStaticInterruptReason() {\n    return this.staticInterruptReason\n  }\n\n  getRuntimeInterruptReason() {\n    return this.runtimeInterruptReason\n  }\n\n  getStaticStageEndTime() {\n    return this.staticStageEndTime\n  }\n\n  getRuntimeStageEndTime() {\n    return this.runtimeStageEndTime\n  }\n\n  abandonRender() {\n    if (!this.mayAbandon) {\n      throw new InvariantError(\n        '`abandonRender` called on a stage controller that cannot be abandoned.'\n      )\n    }\n\n    this.abandonRenderImpl()\n  }\n\n  private abandonRenderImpl() {\n    // In staged rendering, only the initial render is abandonable.\n    // We can abandon the initial render if\n    //   1. We notice a cache miss, and need to wait for caches to fill\n    //   2. A sync IO error occurs, and the render should be interrupted\n    //      (this might be a lazy intitialization of a module,\n    //       so we still want to restart in this case and see if it still occurs)\n    // In either case, we'll be doing another render after this one,\n    // so we only want to unblock the Runtime stage, not Dynamic, because\n    // unblocking the dynamic stage would likely lead to wasted (uncached) IO.\n    const { currentStage } = this\n    switch (currentStage) {\n      case RenderStage.Static: {\n        this.currentStage = RenderStage.Abandoned\n        this.resolveRuntimeStage()\n        return\n      }\n      case RenderStage.Runtime: {\n        this.currentStage = RenderStage.Abandoned\n        return\n      }\n      case RenderStage.Dynamic:\n      case RenderStage.Before:\n      case RenderStage.Abandoned:\n        break\n      default: {\n        currentStage satisfies never\n      }\n    }\n  }\n\n  advanceStage(\n    stage: RenderStage.Static | RenderStage.Runtime | RenderStage.Dynamic\n  ) {\n    // If we're already at the target stage or beyond, do nothing.\n    // (this can happen e.g. if sync IO advanced us to the dynamic stage)\n    if (stage <= this.currentStage) {\n      return\n    }\n\n    let currentStage = this.currentStage\n    this.currentStage = stage\n\n    if (currentStage < RenderStage.Runtime && stage >= RenderStage.Runtime) {\n      this.staticStageEndTime = performance.now() + performance.timeOrigin\n      this.resolveRuntimeStage()\n    }\n    if (currentStage < RenderStage.Dynamic && stage >= RenderStage.Dynamic) {\n      this.runtimeStageEndTime = performance.now() + performance.timeOrigin\n      this.resolveDynamicStage()\n      return\n    }\n  }\n\n  /** Fire the `onStage` listeners for the runtime stage and unblock any promises waiting for it. */\n  private resolveRuntimeStage() {\n    const runtimeListeners = this.runtimeStageListeners\n    for (let i = 0; i < runtimeListeners.length; i++) {\n      runtimeListeners[i]()\n    }\n    runtimeListeners.length = 0\n    this.runtimeStagePromise.resolve()\n  }\n\n  /** Fire the `onStage` listeners for the dynamic stage and unblock any promises waiting for it. */\n  private resolveDynamicStage() {\n    const dynamicListeners = this.dynamicStageListeners\n    for (let i = 0; i < dynamicListeners.length; i++) {\n      dynamicListeners[i]()\n    }\n    dynamicListeners.length = 0\n    this.dynamicStagePromise.resolve()\n  }\n\n  private getStagePromise(stage: NonStaticRenderStage): Promise<void> {\n    switch (stage) {\n      case RenderStage.Runtime: {\n        return this.runtimeStagePromise.promise\n      }\n      case RenderStage.Dynamic: {\n        return this.dynamicStagePromise.promise\n      }\n      default: {\n        stage satisfies never\n        throw new InvariantError(`Invalid render stage: ${stage}`)\n      }\n    }\n  }\n\n  waitForStage(stage: NonStaticRenderStage) {\n    return this.getStagePromise(stage)\n  }\n\n  delayUntilStage<T>(\n    stage: NonStaticRenderStage,\n    displayName: string | undefined,\n    resolvedValue: T\n  ) {\n    const ioTriggerPromise = this.getStagePromise(stage)\n\n    const promise = makeDevtoolsIOPromiseFromIOTrigger(\n      ioTriggerPromise,\n      displayName,\n      resolvedValue\n    )\n\n    // Analogously to `makeHangingPromise`, we might reject this promise if the signal is invoked.\n    // (e.g. in the case where we don't want want the render to proceed to the dynamic stage and abort it).\n    // We shouldn't consider this an unhandled rejection, so we attach a noop catch handler here to suppress this warning.\n    if (this.abortSignal) {\n      promise.catch(ignoreReject)\n    }\n    return promise\n  }\n}\n\nfunction ignoreReject() {}\n\n// TODO(restart-on-cache-miss): the layering of `delayUntilStage`,\n// `makeDevtoolsIOPromiseFromIOTrigger` and and `makeDevtoolsIOAwarePromise`\n// is confusing, we should clean it up.\nfunction makeDevtoolsIOPromiseFromIOTrigger<T>(\n  ioTrigger: Promise<any>,\n  displayName: string | undefined,\n  resolvedValue: T\n): Promise<T> {\n  // If we create a `new Promise` and give it a displayName\n  // (with no userspace code above us in the stack)\n  // React Devtools will use it as the IO cause when determining \"suspended by\".\n  // In particular, it should shadow any inner IO that resolved/rejected the promise\n  // (in case of staged rendering, this will be the `setTimeout` that triggers the relevant stage)\n  const promise = new Promise<T>((resolve, reject) => {\n    ioTrigger.then(resolve.bind(null, resolvedValue), reject)\n  })\n  if (displayName !== undefined) {\n    // @ts-expect-error\n    promise.displayName = displayName\n  }\n  return promise\n}\n","/**\n * Message Configuration - SINGLE SOURCE OF TRUTH\n * All message-related enums, types, and configs\n */\n\n// ============================================================================\n// CHANNEL LIMITS\n// ============================================================================\n\n/**\n * WhatsApp messages are unlimited for users (competitive positioning)\n * Hard limit of 1000 per day per hunt to prevent abuse\n * This limit is auto-allocated when WhatsApp is enabled\n */\nexport const WHATSAPP_DAILY_LIMIT = 1000;\n\n// ============================================================================\n// CONTACT CHANNELS\n// ============================================================================\n\nexport const CONTACT_CHANNEL_DEFINITIONS = [\n  {\n    key: \"WHATSAPP_TEXT\",\n    value: \"whatsapp_text\",\n    label: \"Message WhatsApp\",\n    shortLabel: \"WhatsApp\",\n    description: \"Messages texte via WhatsApp Business\",\n    icon: \"message-circle\",\n    color: \"green\",\n  },\n  {\n    key: \"SMS\",\n    value: \"sms\",\n    label: \"SMS\",\n    shortLabel: \"SMS\",\n    description: \"Messages texte par SMS\",\n    icon: \"message-square\",\n    color: \"blue\",\n  },\n  {\n    key: \"RINGLESS_VOICE\",\n    value: \"ringless_voice\",\n    label: \"Message Vocal\",\n    shortLabel: \"Vocal\",\n    description: \"Messages vocaux sans sonnerie\",\n    icon: \"phone\",\n    color: \"purple\",\n  },\n] as const;\n\n// Enum-like constant access (e.g., EContactChannel.WHATSAPP_TEXT)\nexport const EContactChannel = Object.fromEntries(\n  CONTACT_CHANNEL_DEFINITIONS.map((channel) => [channel.key, channel.value]),\n) as {\n  [K in (typeof CONTACT_CHANNEL_DEFINITIONS)[number][\"key\"]]: Extract<\n    (typeof CONTACT_CHANNEL_DEFINITIONS)[number],\n    { key: K }\n  >[\"value\"];\n};\n\nexport type TContactChannel =\n  (typeof CONTACT_CHANNEL_DEFINITIONS)[number][\"value\"];\n\nexport const CONTACT_CHANNEL_VALUES = CONTACT_CHANNEL_DEFINITIONS.map(\n  (c) => c.value,\n) as [TContactChannel, ...TContactChannel[]];\n\nexport const getContactChannelConfig = (channel: string) => {\n  const config = CONTACT_CHANNEL_DEFINITIONS.find((c) => c.value === channel);\n  if (!config) throw new Error(`Invalid contact channel: ${channel}`);\n  return config;\n};\n\nexport const getContactChannelLabel = (channel: string): string => {\n  return getContactChannelConfig(channel).label;\n};\n\n// ============================================================================\n// MESSAGE STATUSES\n// ============================================================================\n\nexport const MESSAGE_STATUS_DEFINITIONS = [\n  {\n    key: \"PENDING\",\n    value: \"pending\",\n    label: \"En attente\",\n    description: \"Message en file d'attente\",\n    icon: \"clock\",\n    color: \"#eab308\",\n    class: \"bg-yellow-900/30 text-yellow-400 border-yellow-900/50\",\n  },\n  {\n    key: \"SENT\",\n    value: \"sent\",\n    label: \"Envoyé\",\n    description: \"Message envoyé avec succès\",\n    icon: \"send\",\n    color: \"#3b82f6\",\n    class: \"bg-blue-900/30 text-blue-400 border-blue-900/50\",\n  },\n  {\n    key: \"DELIVERED\",\n    value: \"delivered\",\n    label: \"Délivré\",\n    description: \"Message délivré au destinataire\",\n    icon: \"check\",\n    color: \"#22c55e\",\n    class: \"bg-green-900/30 text-green-400 border-green-900/50\",\n  },\n  {\n    key: \"FAILED\",\n    value: \"failed\",\n    label: \"Échoué\",\n    description: \"Échec de l'envoi\",\n    icon: \"x\",\n    color: \"#ef4444\",\n    class: \"bg-red-900/30 text-red-400 border-red-900/50\",\n  },\n  {\n    key: \"READ\",\n    value: \"read\",\n    label: \"Lu\",\n    description: \"Message lu par le destinataire\",\n    icon: \"check-check\",\n    color: \"#a855f7\",\n    class: \"bg-purple-900/30 text-purple-400 border-purple-900/50\",\n  },\n  {\n    key: \"REPLIED\",\n    value: \"replied\",\n    label: \"Répondu\",\n    description: \"Destinataire a répondu\",\n    icon: \"reply\",\n    color: \"#10b981\",\n    class: \"bg-emerald-900/30 text-emerald-400 border-emerald-900/50\",\n  },\n] as const;\n\n// Enum-like constant access (e.g., EMessageStatus.SENT)\nexport const EMessageStatus = Object.fromEntries(\n  MESSAGE_STATUS_DEFINITIONS.map((status) => [status.key, status.value]),\n) as {\n  [K in (typeof MESSAGE_STATUS_DEFINITIONS)[number][\"key\"]]: Extract<\n    (typeof MESSAGE_STATUS_DEFINITIONS)[number],\n    { key: K }\n  >[\"value\"];\n};\n\nexport type TMessageStatus =\n  (typeof MESSAGE_STATUS_DEFINITIONS)[number][\"value\"];\n\nexport const MESSAGE_STATUS_VALUES = MESSAGE_STATUS_DEFINITIONS.map(\n  (s) => s.value,\n) as [TMessageStatus, ...TMessageStatus[]];\n\nexport const getMessageStatusConfig = (status: string) => {\n  const config = MESSAGE_STATUS_DEFINITIONS.find((s) => s.value === status);\n  if (!config) throw new Error(`Invalid message status: ${status}`);\n  return config;\n};\n\nexport const getMessageStatusLabel = (status: TMessageStatus): string => {\n  return getMessageStatusConfig(status).label;\n};\n","import { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport {\n  TAccount,\n  TAccountSelectedKeys,\n  TDBWithTokenClient,\n} from \"@auto-prospect/db\";\n\n/**\n * Gets the current user's primary account (overload for no columns - returns full account)\n */\nexport async function getUserAccount(\n  dbClient?: TDBWithTokenClient,\n): Promise<TAccount>;\n\n/**\n * Gets the current user's primary account (overload for selected columns)\n */\nexport async function getUserAccount<\n  T extends Partial<Record<keyof TAccount, boolean>>,\n>(\n  dbClient: TDBWithTokenClient | undefined,\n  options: { columnsToKeep: T },\n): Promise<Pick<TAccount, TAccountSelectedKeys<T>>>;\n\n/**\n * Implementation\n */\nexport async function getUserAccount(\n  dbClient?: TDBWithTokenClient,\n  options?: { columnsToKeep?: Partial<Record<keyof TAccount, boolean>> },\n): Promise<TAccount | Partial<TAccount>> {\n  const client = dbClient || (await createDrizzleSupabaseClient());\n\n  const account = await client.rls(async (tx) => {\n    return tx.query.accounts.findFirst({\n      ...(options?.columnsToKeep && { columns: options.columnsToKeep }),\n    });\n  });\n\n  if (!account) throw new Error(\"account not found\");\n\n  return account;\n}\n","export const HTTPAccessErrorStatus = {\n  NOT_FOUND: 404,\n  FORBIDDEN: 403,\n  UNAUTHORIZED: 401,\n}\n\nconst ALLOWED_CODES = new Set(Object.values(HTTPAccessErrorStatus))\n\nexport const HTTP_ERROR_FALLBACK_ERROR_CODE = 'NEXT_HTTP_ERROR_FALLBACK'\n\nexport type HTTPAccessFallbackError = Error & {\n  digest: `${typeof HTTP_ERROR_FALLBACK_ERROR_CODE};${string}`\n}\n\n/**\n * Checks an error to determine if it's an error generated by\n * the HTTP navigation APIs `notFound()`, `forbidden()` or `unauthorized()`.\n *\n * @param error the error that may reference a HTTP access error\n * @returns true if the error is a HTTP access error\n */\nexport function isHTTPAccessFallbackError(\n  error: unknown\n): error is HTTPAccessFallbackError {\n  if (\n    typeof error !== 'object' ||\n    error === null ||\n    !('digest' in error) ||\n    typeof error.digest !== 'string'\n  ) {\n    return false\n  }\n  const [prefix, httpStatus] = error.digest.split(';')\n\n  return (\n    prefix === HTTP_ERROR_FALLBACK_ERROR_CODE &&\n    ALLOWED_CODES.has(Number(httpStatus))\n  )\n}\n\nexport function getAccessFallbackHTTPStatus(\n  error: HTTPAccessFallbackError\n): number {\n  const httpStatus = error.digest.split(';')[1]\n  return Number(httpStatus)\n}\n\nexport function getAccessFallbackErrorTypeByStatus(\n  status: number\n): 'not-found' | 'forbidden' | 'unauthorized' | undefined {\n  switch (status) {\n    case 401:\n      return 'unauthorized'\n    case 403:\n      return 'forbidden'\n    case 404:\n      return 'not-found'\n    default:\n      return\n  }\n}\n","export enum RedirectStatusCode {\n  SeeOther = 303,\n  TemporaryRedirect = 307,\n  PermanentRedirect = 308,\n}\n","import { RedirectStatusCode } from './redirect-status-code'\n\nexport const REDIRECT_ERROR_CODE = 'NEXT_REDIRECT'\n\nexport enum RedirectType {\n  push = 'push',\n  replace = 'replace',\n}\n\nexport type RedirectError = Error & {\n  digest: `${typeof REDIRECT_ERROR_CODE};${RedirectType};${string};${RedirectStatusCode};`\n}\n\n/**\n * Checks an error to determine if it's an error generated by the\n * `redirect(url)` helper.\n *\n * @param error the error that may reference a redirect error\n * @returns true if the error is a redirect error\n */\nexport function isRedirectError(error: unknown): error is RedirectError {\n  if (\n    typeof error !== 'object' ||\n    error === null ||\n    !('digest' in error) ||\n    typeof error.digest !== 'string'\n  ) {\n    return false\n  }\n\n  const digest = error.digest.split(';')\n  const [errorCode, type] = digest\n  const destination = digest.slice(2, -2).join(';')\n  const status = digest.at(-2)\n\n  const statusCode = Number(status)\n\n  return (\n    errorCode === REDIRECT_ERROR_CODE &&\n    (type === 'replace' || type === 'push') &&\n    typeof destination === 'string' &&\n    !isNaN(statusCode) &&\n    statusCode in RedirectStatusCode\n  )\n}\n","import {\n  isHTTPAccessFallbackError,\n  type HTTPAccessFallbackError,\n} from './http-access-fallback/http-access-fallback'\nimport { isRedirectError, type RedirectError } from './redirect-error'\n\n/**\n * Returns true if the error is a navigation signal error. These errors are\n * thrown by user code to perform navigation operations and interrupt the React\n * render.\n */\nexport function isNextRouterError(\n  error: unknown\n): error is RedirectError | HTTPAccessFallbackError {\n  return isRedirectError(error) || isHTTPAccessFallbackError(error)\n}\n","/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","import { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport { desc, TCreditTransaction, TDBQuery } from \"@auto-prospect/db\";\nimport { TContactChannel } from \"@auto-prospect/shared/src/config/message.config\";\nimport { type TransactionType } from \"@auto-prospect/shared/src/config/payment.config\";\n\nexport type TConsumeCreditsParams = {\n  huntId: string;\n  channel: TContactChannel;\n  messageId?: string;\n  recipient?: string;\n};\n\nexport type TConsumeCreditsResult =\n  | { success: true; transaction: TCreditTransaction }\n  | { success: false; error: string };\n\nexport type TSubscription =\n  | void\n  | {\n      active: boolean;\n      id: string;\n      accountId: string | null;\n      updatedAt: string;\n      createdAt: string;\n      billingProvider: \"stripe\" | \"lemon-squeezy\" | \"paddle\";\n      currency: string;\n      billingCustomerId: number;\n      status:\n        | \"active\"\n        | \"trialing\"\n        | \"past_due\"\n        | \"canceled\"\n        | \"unpaid\"\n        | \"incomplete\"\n        | \"incomplete_expired\"\n        | \"paused\";\n      cancelAtPeriodEnd: boolean;\n      periodStartsAt: string;\n      periodEndsAt: string;\n      trialStartsAt: string | null;\n      trialEndsAt: string | null;\n    }\n  | undefined;\n\n/**\n * Gets all channel credits for a hunt\n */\nexport async function getHuntChannelCredits(huntId: string) {\n  // call the endpoint\n}\n\n/**\n * Gets complete credit data for the authenticated user's account\n * Used by the credits page to display balances, allocations, and transaction history\n */\nexport async function getAccountCredits() {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  // Fetch credit balance, hunt allocations, and transaction history in parallel\n  const [balance, huntAllocations, transactions] = await Promise.all([\n    // Get account credit balance\n    dbClient.rls((tx: TDBQuery) => tx.query.creditBalances.findFirst()),\n\n    // Get hunt channel credit allocations with hunt names\n    dbClient.rls((tx: TDBQuery) =>\n      tx.query.huntChannelCredits.findMany({\n        with: {\n          hunt: {\n            columns: {\n              id: true,\n              name: true,\n            },\n          },\n        },\n      }),\n    ),\n\n    // Get recent credit transactions (last 50)\n    dbClient.rls((tx: TDBQuery) =>\n      tx.query.creditTransactions.findMany({\n        orderBy: (table) => [desc(table.createdAt)],\n        limit: 50,\n      }),\n    ),\n  ]);\n\n  return {\n    balance,\n    huntAllocations: huntAllocations.map((allocation) => ({\n      huntId: allocation.huntId,\n      huntName: allocation.hunt.name,\n      channel: allocation.channel as TContactChannel,\n      allocated: allocation.creditsAllocated,\n      consumed: allocation.creditsConsumed,\n      remaining: allocation.creditsAllocated - allocation.creditsConsumed,\n    })),\n    transactions: transactions.map((tx) => ({\n      id: tx.id,\n      type: tx.type as TransactionType,\n      channel: tx.channel as TContactChannel,\n      amount: tx.amount,\n      balanceAfter: tx.balanceAfter,\n      createdAt: tx.createdAt,\n      metadata: tx.metadata,\n    })),\n  };\n}\n","import { InvariantError } from '../../../shared/lib/invariant-error'\nimport { isThenable } from '../../../shared/lib/is-thenable'\nimport { trackPendingImport } from './track-module-loading.external'\n\n/**\n * in CacheComponents, `import(...)` will be transformed into `trackDynamicImport(import(...))`.\n * A dynamic import is essentially a cached async function, except it's cached by the module system.\n *\n * The promises are tracked globally regardless of if the `import()` happens inside a render or outside of it.\n * When rendering, we can make the `cacheSignal` wait for all pending promises via `trackPendingModules`.\n * */\nexport function trackDynamicImport<TExports extends Record<string, any>>(\n  modulePromise: Promise<TExports>\n): Promise<TExports> {\n  if (process.env.NEXT_RUNTIME === 'edge') {\n    throw new InvariantError(\n      \"Dynamic imports should not be instrumented in the edge runtime, because `cacheComponents` doesn't support it\"\n    )\n  }\n\n  if (!isThenable(modulePromise)) {\n    // We're expecting `import()` to always return a promise. If it's not, something's very wrong.\n    throw new InvariantError(\n      '`trackDynamicImport` should always receive a promise. Something went wrong in the dynamic imports transform.'\n    )\n  }\n\n  // Even if we're inside a prerender and have `workUnitStore.cacheSignal`, we always track the promise globally.\n  // (i.e. via the global `moduleLoadingSignal` that `trackPendingImport` uses internally).\n  //\n  // We do this because the `import()` promise might be cached in userspace:\n  // (which is quite common for e.g. lazy initialization in libraries)\n  //\n  //   let promise;\n  //   function doDynamicImportOnce() {\n  //     if (!promise) {\n  //       promise = import(\"...\");\n  //       // transformed into:\n  //       // promise = trackDynamicImport(import(\"...\"));\n  //     }\n  //     return promise;\n  //   }\n  //\n  // If multiple prerenders (e.g. multiple pages) depend on `doDynamicImportOnce`,\n  // we have to wait for the import *in all of them*.\n  // If we only tracked it using `workUnitStore.cacheSignal.trackRead()`,\n  // then only the first prerender to call `doDynamicImportOnce` would wait --\n  // Subsequent prerenders would re-use the existing `promise`,\n  // and `trackDynamicImport` wouldn't be called again in their scope,\n  // so their respective CacheSignals wouldn't wait for the promise.\n  trackPendingImport(modulePromise)\n\n  return modulePromise\n}\n","export { trackDynamicImport } from '../../../../server/app-render/module-loading/track-dynamic-import'\n"],"names":["RequestCookies","ResponseCookies","stringifyCookie","ActionDidNotRevalidate","ActionDidRevalidateDynamicOnly","ActionDidRevalidateStaticAndDynamic","createPromiseWithResolvers","resolve","reject","promise","Promise","res","rej","RenderStage","StagedRenderingController","constructor","abortSignal","hasRuntimePrefetch","currentStage","staticInterruptReason","runtimeInterruptReason","staticStageEndTime","Infinity","runtimeStageEndTime","runtimeStageListeners","dynamicStageListeners","runtimeStagePromise","dynamicStagePromise","mayAbandon","addEventListener","reason","catch","ignoreReject","once","onStage","stage","callback","push","InvariantError","canSyncInterrupt","boundaryStage","syncInterruptCurrentStageWithReason","abandonRenderImpl","advanceStage","getStaticInterruptReason","getRuntimeInterruptReason","getStaticStageEndTime","getRuntimeStageEndTime","abandonRender","resolveRuntimeStage","performance","now","timeOrigin","resolveDynamicStage","runtimeListeners","i","length","dynamicListeners","getStagePromise","waitForStage","delayUntilStage","displayName","resolvedValue","ioTriggerPromise","makeDevtoolsIOPromiseFromIOTrigger","ioTrigger","then","bind","undefined","HTTPAccessErrorStatus","HTTP_ERROR_FALLBACK_ERROR_CODE","getAccessFallbackErrorTypeByStatus","getAccessFallbackHTTPStatus","isHTTPAccessFallbackError","NOT_FOUND","FORBIDDEN","UNAUTHORIZED","ALLOWED_CODES","Set","Object","values","error","digest","prefix","httpStatus","split","has","Number","status","RedirectStatusCode","REDIRECT_ERROR_CODE","RedirectType","isRedirectError","errorCode","type","destination","slice","join","at","statusCode","isNaN","isNextRouterError","registerServerReference","trackDynamicImport","modulePromise","process","env","NEXT_RUNTIME","isThenable","trackPendingImport"],"mappings":"6FAKA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,MAAA,EAAA,EAAA,CAAA,CAAA,OAOA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,KAeO,eAAe,EAA2B,CAAc,EAC7D,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAElD,GAAI,CAEF,IAAM,EAAO,MAAM,EAAS,GAAG,CAAC,MAAO,GAC9B,EAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAC9B,MAAO,CAAC,EAAO,IAAE,CAAE,CAAE,GAAK,EAAG,EAAM,EAAE,CAAE,GACvC,QAAS,CACP,WAAW,CACb,CACF,IAGF,GAAI,CAAC,EACH,IADS,EACH,AAAI,MAAM,kBAelB,OAAO,AAXU,MAAM,EAAS,GAAG,CAAC,MAAO,GAClC,EAAG,KAAK,CAAC,gBAAgB,CAAC,SAAS,CAAC,CACzC,MAAO,CAAC,EAAO,IAAE,CAAE,KAAE,CAAG,CAAE,GACxB,EACE,EAAG,EAAM,SAAS,CAAE,EAAK,SAAS,EAClC,EAAG,EAAM,OAAO,CAAE,EAAA,eAAe,CAAC,aAAa,EAC/C,EAAG,EAAM,SAAS,CAAE,IAE1B,GAIJ,CAAE,KAAM,CACN,MAAM,AAAI,MAAM,oCAClB,CACF,CAMO,eAAe,EACpB,CAAc,CACd,CAAuB,CACvB,CAAmB,EAEnB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAElD,GAAI,CAEF,IAAM,EAAO,MAAM,EAAS,GAAG,CAAC,MAAO,GAC9B,MAAM,EAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CACpC,MAAO,CAAC,EAAO,IAAE,CAAE,CAAE,GAAK,EAAG,EAAM,EAAE,CAAE,GACvC,QAAS,CAAE,QAAQ,EAAM,cAAc,EAAM,WAAW,CAAK,CAC/D,IAGF,GAAI,CAAC,EACH,IADS,EACH,AAAI,MAAM,kBAIlB,IAAM,EAAe,MAAM,CAAA,EAAA,EAAA,aAAA,AAAa,EAAC,CACvC,OAAQ,EAAK,MAAM,CACnB,QAAS,EAAA,eAAe,CAAC,aAAa,AACxC,GAEA,GAAI,CAAC,EAAa,OAAO,CACvB,CADyB,KACnB,AAAI,MAAM,EAAa,KAAK,EAIpC,IAAM,EAAgB,MAAM,EAAS,GAAG,CAAC,MAAO,IAE9C,GAAM,CAAC,EAAgB,CAAG,MAAM,EAC7B,MAAM,CAAC,EAAA,QAAQ,EACf,MAAM,CAAC,QACN,EACA,WAAY,GAAc,KAC1B,QAAS,EAAA,eAAe,CAAC,aAAa,CACtC,QAAS,EACT,OAAQ,OACR,OAAQ,IAAI,KACZ,SAAU,EAAK,YAAY,EAAI,EAAK,SAAS,AAC/C,GACC,SAAS,GAQZ,OALA,MAAM,EAAG,MAAM,CAAC,EAAA,SAAS,EAAE,MAAM,CAAC,QAChC,EACA,QAAS,CAAC,0BAAuB,CAAC,AACpC,GAEO,CACT,GAkBA,OAfI,GAAe,IAAM,EAAa,WAAW,EAAE,IAAI,AAErD,MAAM,EAAS,KAAK,CACjB,MAAM,CAAC,EAAA,kBAAkB,EACzB,GAAG,CAAC,CACH,YAAa,EAAc,EAAE,CAC7B,SAAU,CACR,UAAW,EAAc,EAAE,AAC7B,CACF,GACC,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,kBAAkB,CAAC,EAAE,CAAE,EAAa,WAAW,CAAC,EAAE,GAGhE,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,EAAA,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,IAE3B,CAAE,SAAS,CAAK,CACzB,CAAE,MAAO,EAAO,CACd,MAAM,AAAI,MACR,aAAiB,MAAQ,EAAM,OAAO,CAAG,iCAE7C,CACF,CAKO,eAAe,IACpB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAIlD,OAAO,EAA0B,CAHjB,MAAM,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,EAAU,CAC7C,cAAe,CAAE,IAAI,CAAK,CAC5B,EAAA,EACyC,EAAE,CAAE,EAC/C,CAKA,IAAA,EAAA,eAAe,AACb,CAAiB,CACjB,CAA4B,EAI5B,GAAM,UAAE,CAAQ,CAAE,CAAG,MAAA,CAAA,EAAA,EAAA,kBAAA,EAAA,EAAA,CAAA,CAAA,QACf,YAAE,CAAU,CAAE,CAAG,MAAA,CAAA,EAAA,EAAA,kBAAA,EAAA,EAAA,CAAA,CAAA,QAEvB,EAAS,EAAW,kBAAkB,CAAC,IAEvC,IAAM,EAAS,GAAa,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAE7D,GAAI,CAiBF,OAfkB,AAeX,MAfiB,EAAO,GAAG,CAAC,MAAO,GACjC,EAAG,KAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CACxC,MAAO,CAAC,EAAO,IAAE,CAAE,CAAE,GAAK,EAAG,EAAM,SAAS,CAAE,GAC9C,KAAM,CACJ,QAAS,CACP,QAAS,CACP,IAAI,EACJ,MAAM,CACR,CACF,CACF,EACA,QAAS,CAAC,EAAO,CAAE,MAAI,CAAE,GAAK,CAAC,EAAK,EAAM,SAAS,EAAE,AACvD,GAIJ,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,4BAA6B,GACrC,AAAI,MAAM,4BAClB,CACF,MAnCA,EAAA,CAAA,EAAA,EAAA,KAAA,EAAA,SAAe,QAAf,CAAA,EAAA,EAAA,KAAA,EAAA,UAAA,6CAAA,EAAA,EAAA,aAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,8EAAe,EAAA,EA4CR,eAAe,IACpB,GAAI,CAKF,MAAO,CAAC,CAAC,CAJO,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,OAAC,EAAW,CAC9C,cAAe,CAAE,IAAI,EAAM,WAAW,CAAK,CAC7C,EAAA,EAEiB,SAAS,AAC5B,CAAE,KAAM,CACN,OAAO,CACT,CACF,CAKO,eAAe,IACpB,GAAI,CAKF,MAAO,CAAC,CAAC,CAJO,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,OAAC,EAAW,CAC9C,cAAe,CAAE,GAAI,GAAM,qBAAqB,CAAK,CACvD,EAAA,EAEiB,mBACnB,AADsC,CACpC,KAAM,CACN,OAAO,CACT,CACF,CAEO,IAAM,EAA8B,MACzC,EACA,KAEA,IAAI,EAAiB,EAChB,GAIH,GAAiB,CAHD,MAAM,CAAA,EADH,AACG,EAAA,cAAA,AAAc,EAAC,EAAU,CAC7C,cAAe,CAAE,IAAI,CAAK,CAC5B,EAAA,EACyB,EAAA,AAAE,EAG7B,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,EAAA,UAAU,CAAC,kBAAkB,CAAC,GAC1C,uQCtP0B,CAExB,eAAgB,AAAC,GAAsB,CAAC,MAAM,EAAE,EAAA,CAAW,CAC3D,KAAO,AAAD,GAAgB,CAAC,KAAK,EAAE,EAAA,CAAI,CAGlC,mBAAqB,AAAD,GAAuB,CAAC,UAAU,EAAE,EAAA,CAAW,CAGnE,qBAAsB,AAAC,GAAsB,CAAC,aAAa,EAAE,EAAA,CAAW,CAGxE,QAAS,AAAC,GAAe,CAAC,QAAQ,EAAE,EAAA,CACtC,AAD0C,0FCfxCA,cAAc,CAAA,kBAAdA,EAAAA,cAAc,EACdC,eAAe,CAAA,kBAAfA,EAAAA,eAAe,EACfC,eAAe,CAAA,kBAAfA,EAAAA,eAAe,8EACV,CAAA,CAAA,IAAA,yFCFMC,sBAAsB,CAAA,kBAAtBA,GAEAC,8BAA8B,CAAA,kBAA9BA,GADAC,mCAAmC,CAAA,kBAAnCA,uEADN,IAAMF,EAAyB,EACzBE,EAAsC,EACtCD,EAAiC,gCCJvC,SAASE,IAId,IAFIC,EACAC,EACEC,EAAU,IAAIC,QAAW,CAACC,EAAKC,KACnCL,EAAUI,EACVH,EAASI,CACX,GACA,MAAO,CAAEL,QAASA,EAAUC,OAAQA,EAASC,SAAQ,CACvD,0EATgBH,6BAAAA,qCAAAA,wFCGJO,KAAAA,MAAAA,KAAW,CAAA,kBAAXA,GAUCC,yBAAyB,CAAA,kBAAzBA,+EAbkB,CAAA,CAAA,IAAA,OACY,CAAA,CAAA,IAAA,GAEpC,IAAKD,cAAAA,WAAAA,GAAAA,yGAAAA,EAUL,OAAMC,EAgBXC,YACUC,EAAkC,IAAI,CACtCC,CAA2B,CACnC,MAFQD,WAAAA,CAAAA,OACAC,kBAAAA,CAAAA,OAjBVC,YAAAA,CAAAA,OAEAC,qBAAAA,CAAsC,UACtCC,sBAAAA,CAAuC,UACvCC,kBAAAA,CAA6BC,SAC7BC,mBAAAA,CAA8BD,SAEtBE,qBAAAA,CAA2C,EAAE,MAC7CC,qBAAAA,CAA2C,EAAE,MAE7CC,mBAAAA,CAAsBpB,CAAAA,EAAAA,EAAAA,0BAAAA,AAA0B,SAChDqB,mBAAAA,CAAsBrB,CAAAA,EAAAA,EAAAA,0BAA0B,AAA1BA,SAEtBsB,UAAAA,EAAsB,EAMxBZ,IACFA,EAAYa,OADG,SACa,CAC1B,QACA,KACE,GAAM,QAAEC,CAAM,CAAE,CAAGd,EACf,IAAI,CAACE,YAAY,CAAA,GAAwB,CAC3C,IAAI,CAACQ,mBAAmB,CAACjB,OAAO,CAACsB,KAAK,CAACC,GACvC,IAAI,CAACN,MADgD,aAC7B,CAAClB,MAAM,CAACsB,KAGhC,GAJkF,CAI9E,CAACZ,YAAY,CAAA,OACjB,IAAI,CAACA,YAAY,GACjB,CACA,IAAI,CAACS,mBAAmB,CAAClB,OAAO,CAACsB,KAAK,CAACC,GACvC,IAAI,CAACL,MADgD,aAC7B,CAACnB,MAAM,CAACsB,GAEpC,EACA,CAAEG,EAJoF,GAI9E,EAAK,GAGf,IAAI,CAACL,UAAU,EAAG,EAEtB,CAEAM,QAAQC,CAA2B,CAAEC,CAAoB,CAAE,CACzD,GAAI,IAAI,CAAClB,YAAY,EAAIiB,EACvBC,KAD8B,IAEzB,GAAID,GAA+B,CAA/BA,EACT,IAAI,CAACX,qBAAqB,CAACa,IAAI,CAACD,QAC3B,GAAID,GAA+B,CAA/BA,EACT,IAAI,CAACV,qBAAqB,CAACY,IAAI,CAACD,QAGhC,MAAM,OAAA,cAAoD,CAApD,IAAIE,EAAAA,cAAc,CAAC,CAAC,sBAAsB,EAAEH,EAAAA,CAAO,EAAnD,oBAAA,OAAA,mBAAA,gBAAA,CAAmD,EAE7D,CAEAI,kBAAmB,CAEjB,GAAqB,GAAyB,CAA1C,IAAI,CAACrB,YAAY,CACnB,MAAO,GAGT,IAAMsB,EAAgB,IAAI,CAACvB,kBAAkB,CAAA,EAAA,EAG7C,OAAO,IAAI,CAACC,YAAY,CAAGsB,CAC7B,CAEAC,oCAAoCX,CAAa,CAAE,CACjD,GAAqB,GAAyB,CAA1C,IAAI,CAACZ,YAAY,EAOrB,GAAI,IAAI,CAACU,UAAU,CACjB,CADmB,MACZ,IAAI,CAACc,iBAAiB,GAK/B,OAAQ,IAAI,CAACxB,YAAY,EACvB,KAAA,EACE,IAAI,CAACC,qBAAqB,CAAGW,EAC7B,IAAI,CAACa,YAAY,CAAA,GACjB,MAEF,MAAA,EAOM,IAAI,CAAC1B,kBAAkB,EAAE,CAC3B,IAAI,CAACG,sBAAsB,CAAGU,EAC9B,IAAI,CAACa,YAAY,CAAA,IAEnB,MAKJ,EACF,CAEAC,0BAA2B,CACzB,OAAO,IAAI,CAACzB,qBAAqB,AACnC,CAEA0B,2BAA4B,CAC1B,OAAO,IAAI,CAACzB,sBAAsB,AACpC,CAEA0B,uBAAwB,CACtB,OAAO,IAAI,CAACzB,kBAAkB,AAChC,CAEA0B,wBAAyB,CACvB,OAAO,IAAI,CAACxB,mBAAmB,AACjC,CAEAyB,eAAgB,CACd,GAAI,CAAC,IAAI,CAACpB,UAAU,CAClB,CADoB,KACd,OAAA,cAEL,CAFK,IAAIU,EAAAA,cAAc,CACtB,0EADI,oBAAA,OAAA,mBAAA,gBAAA,CAEN,GAGF,IAAI,CAACI,iBAAiB,EACxB,CAEQA,mBAAoB,CAU1B,GAAM,cAAExB,CAAY,CAAE,CAAG,IAAI,CAC7B,OAAQA,GACN,KAAA,EACE,IAAI,CAACA,YAAY,CAAA,EACjB,IAAI,CAAC+B,mBAAmB,GACxB,MAEF,MAAA,EACE,IAAI,CAAC/B,YAAY,CAAA,EACjB,MASJ,CACF,CAEAyB,aACER,CAAqE,CACrE,CAGA,GAAIA,GAAS,IAAI,CAACjB,YAAY,CAC5B,CAD8B,MAIhC,IAAIA,EAAe,IAAI,CAACA,YAAY,CAOpC,GANA,IAAI,CAACA,YAAY,CAAGiB,EAEhBjB,EAAAA,GAAsCiB,GAAAA,GAA8B,CACtE,IAAI,CAACd,kBAAkB,CAAG6B,YAAYC,GAAG,GAAKD,YAAYE,UAAU,CACpE,IAAI,CAACH,mBAAmB,IAEtB/B,EAAAA,GAAsCiB,GAAAA,EAA8B,CACtE,IAAI,CAACZ,mBAAmB,CAAG2B,YAAYC,GAAG,GAAKD,YAAYE,UAAU,CACrE,IAAI,CAACC,mBAAmB,GACxB,MACF,CACF,CAGQJ,qBAAsB,CAC5B,IAAMK,EAAmB,IAAI,CAAC9B,qBAAqB,CACnD,IAAK,IAAI+B,EAAI,EAAGA,EAAID,EAAiBE,MAAM,CAAED,IAAK,AAChDD,CAAgB,CAACC,EAAE,GAErBD,EAAiBE,MAAM,CAAG,EAC1B,IAAI,CAAC9B,mBAAmB,CAACnB,OAAO,EAClC,CAGQ8C,qBAAsB,CAC5B,IAAMI,EAAmB,IAAI,CAAChC,qBAAqB,CACnD,IAAK,IAAI8B,EAAI,EAAGA,EAAIE,EAAiBD,MAAM,CAAED,IAAK,AAChDE,CAAgB,CAACF,EAAE,EAErBE,GAAiBD,MAAM,CAAG,EAC1B,IAAI,CAAC7B,mBAAmB,CAACpB,OAAO,EAClC,CAEQmD,gBAAgBvB,CAA2B,CAAiB,CAClE,OAAQA,GACN,KAAA,EACE,OAAO,IAAI,CAACT,mBAAmB,CAACjB,OAAO,AAEzC,MAAA,EACE,OAAO,IAAI,CAACkB,mBAAmB,CAAClB,OAAO,AAEzC,SAEE,MAAM,OAAA,cAAoD,CAApD,IAAI6B,EAAAA,cAAc,CAAC,CAAC,sBAAsB,EAAEH,EAAAA,CAAO,EAAnD,oBAAA,OAAA,mBAAA,gBAAA,CAAmD,EAE7D,CACF,CAEAwB,aAAaxB,CAA2B,CAAE,CACxC,OAAO,IAAI,CAACuB,eAAe,CAACvB,EAC9B,CAEAyB,gBACEzB,CAA2B,CAC3B0B,CAA+B,CAC/BC,CAAgB,CAChB,OA0BFD,EACAC,QAxBQrD,CAuBuB,EAD/BwD,EAxB2B,AA0BX,IA1Be,CAACP,AAEdM,EAsBK,aAxBwB,CAAC7B,KAI5C0B,IACAC,EA4BErD,EAAU,IAAIC,EA9BhBqD,MA8B2B,CAACxD,EAASC,KACvCyD,EAAUC,IAAI,CAAC3D,EAAQ4D,IAAI,CAAC,KAAML,GAAgBtD,EACpD,GACIqD,AAAgBO,WAAW,CAE7B3D,GAAQoD,WAAW,CAAGA,CAAAA,EAEjBpD,GA1BL,OAHI,IAAI,CAACO,WAAW,EAAE,AACpBP,EAAQsB,KAAK,CAACC,GAETvB,CACT,CACF,CAEA,SAASuB,IAAgB,0BCnPlB,IAAM,EAA8B,CACzC,CACE,IAAK,gBACL,MAAO,gBACP,MAAO,mBACP,WAAY,WACZ,YAAa,uCACb,KAAM,iBACN,MAAO,OACT,EACA,CACE,IAAK,MACL,MAAO,MACP,MAAO,MACP,WAAY,MACZ,YAAa,yBACb,KAAM,iBACN,MAAO,MACT,EACA,CACE,IAAK,iBACL,MAAO,iBACP,MAAO,gBACP,WAAY,QACZ,YAAa,gCACb,KAAM,QACN,MAAO,QACT,EACD,CAGY,EAAkB,OAAO,WAAW,CAC/C,EAA4B,GAAG,CAAC,AAAC,GAAY,CAAC,EAAQ,GAAG,CAAE,EAAQ,KAAK,CAAC,GAWrC,EAA4B,GAAG,CACnE,AAAC,GAAM,EAAE,KAAK,EAiBT,IAAM,EAA6B,CACxC,CACE,IAAK,UACL,MAAO,UACP,MAAO,aACP,YAAa,4BACb,KAAM,QACN,MAAO,UACP,MAAO,uDACT,EACA,CACE,IAAK,OACL,MAAO,OACP,MAAO,SACP,YAAa,6BACb,KAAM,OACN,MAAO,UACP,MAAO,iDACT,EACA,CACE,IAAK,YACL,MAAO,YACP,MAAO,UACP,YAAa,kCACb,KAAM,QACN,MAAO,UACP,MAAO,oDACT,EACA,CACE,IAAK,SACL,MAAO,SACP,MAAO,SACP,YAAa,mBACb,KAAM,IACN,MAAO,UACP,MAAO,8CACT,EACA,CACE,IAAK,OACL,MAAO,OACP,MAAO,KACP,YAAa,iCACb,KAAM,cACN,MAAO,UACP,MAAO,uDACT,EACA,CACE,IAAK,UACL,MAAO,UACP,MAAO,UACP,YAAa,yBACb,KAAM,QACN,MAAO,UACP,MAAO,0DACT,EACD,CAGY,EAAiB,OAAO,WAAW,CAC9C,EAA2B,GAAG,CAAC,AAAC,GAAW,CAAC,EAAO,GAAG,CAAE,EAAO,KAAK,CAAC,GAW1D,EAAwB,EAA2B,GAAG,CACjE,AAAC,GAAM,EAAE,KAAK,uGA1IoB,+BA6IE,AAAC,IACrC,IAAM,EAAS,EAA2B,IAAI,CAAE,AAAD,GAAO,EAAE,KAAK,GAAK,GAClE,GAAI,CAAC,EAAQ,MAAM,AAAI,MAAM,CAAC,wBAAwB,EAAE,EAAA,CAAQ,EAChE,OAAO,CACT,2BC/JA,IAAA,EAAA,EAAA,CAAA,CAAA,OA2BO,eAAe,EACpB,CAA6B,CAC7B,CAAsE,EAEtE,IAAM,EAAS,GAAa,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAEvD,EAAU,MAAM,EAAO,GAAG,CAAC,MAAO,GAC/B,EAAG,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CACjC,GAAI,GAAS,eAAiB,CAAE,QAAS,EAAQ,aAAa,AAAC,CAAC,AAClE,IAGF,GAAI,CAAC,EAAS,MAAM,AAAI,MAAM,qBAE9B,OAAO,CACT,qHC1CaqC,qBAAqB,CAAA,kBAArBA,GAQAC,8BAA8B,CAAA,kBAA9BA,GAuCGC,kCAAkC,CAAA,kBAAlCA,GAPAC,2BAA2B,CAAA,kBAA3BA,GAnBAC,yBAAyB,CAAA,kBAAzBA,uEArBT,IAAMJ,EAAwB,CACnCK,UAAW,IACXC,UAAW,IACXC,aAAc,GAChB,EAEMC,EAAgB,IAAIC,IAAIC,OAAOC,MAAM,CAACX,IAE/BC,EAAiC,2BAavC,SAASG,EACdQ,CAAc,EAEd,GACmB,UAAjB,OAAOA,GACG,OAAVA,GACA,CAAE,CAAA,WAAYA,CAAAA,CAAI,EACM,UAAxB,AACA,OADOA,EAAMC,MAAM,CAEnB,OAAO,EAET,GAAM,CAACC,EAAQC,EAAW,CAAGH,EAAMC,MAAM,CAACG,KAAK,CAAC,KAEhD,OACEF,IAAWb,GACXO,EAAcS,GAAG,CAACC,OAAOH,GAE7B,CAEO,SAASZ,EACdS,CAA8B,EAG9B,OAAOM,OADYN,AACLG,EADWF,MAAM,CAACG,KAAK,CAAC,IAAI,CAAC,EAAE,CAE/C,CAEO,SAASd,EACdiB,CAAc,EAEd,OAAQA,GACN,KAAK,IACH,MAAO,cACT,MAAK,IACH,MAAO,WACT,MAAK,IACH,MAAO,WACT,SACE,MACJ,CACF,8TC5DYC,qBAAAA,qCAAAA,KAAL,MAAKA,IAAAA,iBAAAA,CAAAA,UAAAA,GAAAA,gGAAAA,6SCIAE,KAFCD,OAEDC,YAFoB,CAAA,kBAAnBD,GAEDC,YAAY,CAAA,kBAAZA,GAgBIC,eAAe,CAAA,kBAAfA,+EApBmB,CAAA,CAAA,IAAA,EAEtBF,EAAsB,gBAE5B,IAAKC,eAAAA,WAAAA,GAAAA,aAAAA,GAgBL,SAASC,EAAgBX,CAAc,EAC5C,GACmB,UAAjB,OAAOA,GACG,OAAVA,GACA,CAAE,CAAA,WAAYA,CAAAA,CAAI,EACM,UAAxB,AACA,OADOA,EAAMC,MAAM,CAEnB,OAAO,EAGT,IAAMA,EAASD,EAAMC,MAAM,CAACG,KAAK,CAAC,KAC5B,CAACQ,EAAWC,EAAK,CAAGZ,EACpBa,EAAcb,EAAOc,KAAK,CAAC,EAAG,CAAC,GAAGC,IAAI,CAAC,KAGvCE,EAAaZ,OAFJL,AAEWM,EAFJU,EAAE,CAAC,CAAC,IAI1B,OACEL,IAAcH,GACbI,CAAS,eAAsB,IAA/BA,KAAsBA,CAAS,CAAK,EACd,UAAvB,OAAOC,GACP,CAACK,MAAMD,IACPA,KAAcV,EAAAA,kBAAkB,AAEpC,+TCjCgBY,oBAAAA,qCAAAA,aART,CAAA,CAAA,IAAA,OAC6C,CAAA,CAAA,IAAA,GAO7C,SAASA,EACdpB,CAAc,EAEd,MAAOW,CAAAA,EAAAA,EAAAA,eAAAA,AAAe,EAACX,IAAUR,CAAAA,EAAAA,EAAAA,yBAAAA,AAAyB,EAACQ,EAC7D,qPCfoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CqB,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,8MCDxC,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAsDO,eAAe,IACpB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAG5C,CAAC,EAAS,EAAiB,EAAa,CAAG,MAAM,QAAQ,GAAG,CAAC,CAEjE,EAAS,GAAG,CAAC,AAAC,GAAiB,EAAG,KAAK,CAAC,cAAc,CAAC,SAAS,IAGhE,EAAS,GAAG,CAAC,AAAC,GACZ,EAAG,KAAK,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CACnC,KAAM,CACJ,KAAM,CACJ,QAAS,CACP,IAAI,EACJ,MAAM,CACR,CACF,CACF,CACF,IAIF,EAAS,GAAG,CAAC,AAAC,GACZ,EAAG,KAAK,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CACnC,QAAS,AAAC,GAAU,CAAC,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,EAAM,SAAS,EAAE,CAC3C,MAAO,EACT,IAEH,EAED,MAAO,SACL,EACA,gBAAiB,EAAgB,GAAG,CAAE,AAAD,IAAiB,CACpD,OAAQ,CAD2C,CAChC,MAAM,CACzB,SAAU,EAAW,IAAI,CAAC,IAAI,CAC9B,QAAS,EAAW,OAAO,CAC3B,UAAW,EAAW,gBAAgB,CACtC,SAAU,EAAW,eAAe,CACpC,UAAW,EAAW,gBAAgB,CAAG,EAAW,eAAe,AACrE,CAAC,GACD,aAAc,EAAa,GAAG,CAAC,AAAC,IAAQ,CAAD,AACrC,GAAI,EAAG,EAAE,CACT,KAAM,EAAG,IAAI,CACb,QAAS,EAAG,OAAO,CACnB,OAAQ,EAAG,MAAM,CACjB,aAAc,EAAG,YAAY,CAC7B,UAAW,EAAG,SAAS,CACvB,SAAU,EAAG,QAAQ,AACvB,CAAC,EACH,CACF,kVC/FgBC,qBAAAA,qCAAAA,aAXe,CAAA,CAAA,IAAA,OACJ,CAAA,CAAA,IAAA,OACQ,CAAA,CAAA,IAAA,GAS5B,SAASA,EACdC,CAAgC,EAQhC,GAAI,CAACI,CAAAA,EAAAA,EAAAA,UAAAA,AAAU,EAACJ,GAEd,MAAM,OAFwB,AAExB,cAEL,CAFK,IAAIlE,EAAAA,cAAc,CACtB,gHADI,oBAAA,OAAA,mBAAA,gBAAA,CAEN,GA4BF,MAFAuE,CAAAA,EAAAA,EAAAA,kBAAAA,AAAkB,EAACL,GAEZA,CACT,yGCrDSD,qBAAAA,qCAAAA,EAAAA,kBAAkB,YAAQ,CAAA,CAAA,IAAA","ignoreList":[2,3,4,5,8,9,10,11,12,14,15]}