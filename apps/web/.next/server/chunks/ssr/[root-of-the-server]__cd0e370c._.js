module.exports=[5522,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(82260)},51187,(a,b,c)=>{b.exports=a.x("next/dist/server/lib/incremental-cache/tags-manifest.external.js",()=>require("next/dist/server/lib/incremental-cache/tags-manifest.external.js"))},52616,a=>{"use strict";a.s(["CACHE_TAGS",0,{huntsByAccount:a=>`hunts:${a}`,hunt:a=>`hunt:${a}`,templatesByAccount:a=>`templates:${a}`,teamMembersByAccount:a=>`team-members:${a}`,account:a=>`account:${a}`}])},14392,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},37320,a=>{"use strict";var b=a.i(81446);a.i(96875);var c=a.i(42810),d=a.i(4867),e=a.i(69070),f=a.i(20118);async function g(a){let e=await (0,b.createDrizzleSupabaseClient)();try{let b=await e.rls(async b=>b.query.leads.findFirst({where:(0,c.eq)(d.leads.id,a),with:{ad:{with:{brand:!0,fuel:!0,gearBox:!0,location:!0,type:!0,subtype:!0,vehicleState:!0,vehicleSeats:!0,drivingLicence:!0}},assignedTo:{columns:{id:!0,name:!0}},notes:{orderBy:(a,{desc:b})=>[b(a.createdAt)]},reminders:{orderBy:(a,{asc:b})=>[b(a.dueAt)]}}}));if(!b)throw Error("Lead not found");return b}catch(a){throw console.error("Error fetching lead details:",a),Error("Failed to fetch lead details")}}async function h(a){let e=await (0,b.createDrizzleSupabaseClient)();try{let b=await e.rls(b=>b.query.leads.findFirst({where:(0,c.eq)(d.leads.id,a),columns:{accountId:!0}}));if(!b)throw Error("Lead not found");return await e.rls(a=>a.query.teamMembers.findMany({where:(a,{eq:c})=>c(a.accountId,b.accountId)}))}catch{throw Error("Failed to fetch account members")}}async function i(a){let d=await (0,b.createDrizzleSupabaseClient)();try{return await d.rls(async b=>b.query.messages.findMany({where:(0,c.eq)(e.messages.leadId,a),with:{sentBy:{columns:{id:!0,name:!0}}},orderBy:(a,{desc:b})=>[b(a.sentAt)]}))}catch{throw Error("Failed to fetch messages")}}async function j(a){let c=await (0,b.createDrizzleSupabaseClient)();try{return await c.rls(async b=>b.query.leadActivities.findMany({where:(b,{eq:c})=>c(b.leadId,a),with:{lead:{with:{assignedTo:{columns:{id:!0,name:!0}}}}},orderBy:(a,{desc:b})=>[b(a.createdAt)]}))}catch{throw Error("Failed to fetch activities")}}async function k(a){let{huntId:e,dbClient:f,tx:g}=a||{},h=new Date;h.setHours(0,0,0,0);let i=[(0,c.gte)(d.leads.createdAt,h)];if(e&&i.push((0,c.eq)(d.leads.huntId,e)),g){let a=await g.select({count:c.sql`cast(count(*) as integer)`}).from(d.leads).where((0,c.and)(...i));return{todayLeadsCount:a[0]?.count??0}}let j=f||await (0,b.createDrizzleSupabaseClient)(),k=await j.rls(async a=>a.select({count:c.sql`cast(count(*) as integer)`}).from(d.leads).where((0,c.and)(...i)));return{todayLeadsCount:k[0]?.count??0}}async function l(a){let{huntId:e,dbClient:g,tx:h}=a||{},i=[(0,c.eq)(d.leads.stage,f.ELeadStage.CONTACTED)];if(e&&i.push((0,c.eq)(d.leads.huntId,e)),h){let a=await h.select({count:c.sql`cast(count(*) as integer)`}).from(d.leads).where((0,c.and)(...i));return{contactedLeadsCount:a[0]?.count??0}}let j=g||await (0,b.createDrizzleSupabaseClient)(),k=await j.rls(async a=>a.select({count:c.sql`cast(count(*) as integer)`}).from(d.leads).where((0,c.and)(...i)));return{contactedLeadsCount:k[0]?.count??0}}async function m(a){let e,{huntId:f,dbClient:g,tx:h}=a||{};if(f&&(e=(0,c.eq)(d.leads.huntId,f)),h){let a=await h.select({count:c.sql`cast(count(*) as integer)`}).from(d.leads).where(e);return{totalLeads:a[0]?.count??0}}let i=g||await (0,b.createDrizzleSupabaseClient)(),j=await i.rls(async a=>a.select({count:c.sql`cast(count(*) as integer)`}).from(d.leads).where(e));return{totalLeads:j[0]?.count??0}}async function n(){let a=await (0,b.createDrizzleSupabaseClient)();return await a.rls(async a=>(await a.query.leads.findMany({orderBy:(a,{asc:b})=>[b(a.stage),b(a.position)],with:{ad:{columns:{id:!0,title:!0,price:!0,picture:!0,phoneNumber:!0,isWhatsappPhone:!0},with:{location:{columns:{name:!0}}}}}})).map(a=>({id:a.id,stage:a.stage,position:a.position,ad:{title:a.ad.title,price:a.ad.price,picture:a.ad.picture,phoneNumber:a.ad.phoneNumber,isWhatsappPhone:a.ad.isWhatsappPhone,zipcode:{name:a.ad.location.name}}})))}a.s(["getContactedLeads",()=>l,"getLeadActivities",()=>j,"getLeadAssociatedTeamMembers",()=>h,"getLeadDetails",()=>g,"getLeadMessages",()=>i,"getPipelineLeads",()=>n,"getTodayNewLeads",()=>k,"getTotalLeads",()=>m])},12789,a=>{"use strict";var b=a.i(5522),c=a.i(20840),d=a.i(26442),e=a.i(52616),f=a.i(81446),g=a.i(6495),h=a.i(37320);a.i(5327);var i=a.i(66811),j=a.i(42025),k=a.i(675);async function l(){let a=await (0,f.createDrizzleSupabaseClient)();return o((await (0,g.getUserAccount)(a,{columnsToKeep:{id:!0}})).id,a)}let m=async function(a,b){(0,k.cacheTag)(e.CACHE_TAGS.huntsByAccount(a));let c=b||await (0,f.createDrizzleSupabaseClient)();return await c.rls(async a=>a.query.hunts.findMany({orderBy:(a,{desc:b})=>[b(a.createdAt)],with:i.HUNT_WITH_RELATIONS}))};var n=(0,d.cache)(function(){return(0,c.cache)("default","e0c6d22713dddd2f666ea2bc6c4707dc5bd51b4e50",0,m,arguments)});(0,b.registerServerReference)(n,"e0c6d22713dddd2f666ea2bc6c4707dc5bd51b4e50",null),Object.defineProperty(n,"name",{value:"getCachedAccountHuntsConfig"});var o=n;async function p(a){let b=await (0,f.createDrizzleSupabaseClient)(),c=await b.rls(async b=>b.query.huntChannelCredits.findMany({where:(b,{inArray:c})=>c(b.huntId,a)})),d=new Map;for(let a of c)d.has(a.huntId)||d.set(a.huntId,[]),d.get(a.huntId).push(a);return d}async function q(){let a=await l();if(0===a.length)return[];let b=a.map(({id:a})=>a),c=await p(b);return a.map(a=>({...a,channelCredits:c.get(a.id)||[]}))}async function r(a){let b=await (0,f.createDrizzleSupabaseClient)();return u(a,(await (0,g.getUserAccount)(b,{columnsToKeep:{id:!0}})).id,b)}let s=async function(a,b,c){(0,k.cacheTag)(e.CACHE_TAGS.hunt(a),e.CACHE_TAGS.huntsByAccount(b));let d=c||await (0,f.createDrizzleSupabaseClient)(),g=await d.rls(async b=>b.query.hunts.findFirst({where:(b,{eq:c})=>c(b.id,a),with:i.HUNT_WITH_RELATIONS}));if(!g)throw Error("hunt not found");return g};var t=(0,d.cache)(function(){return(0,c.cache)("default","f0165f65ac6657ab99c1343b90c7d1753d9ed0dfd5",0,s,arguments)});(0,b.registerServerReference)(t,"f0165f65ac6657ab99c1343b90c7d1753d9ed0dfd5",null),Object.defineProperty(t,"name",{value:"getCachedHuntConfigById"});var u=t;async function v(a){let b=await r(a),c=await (0,f.createDrizzleSupabaseClient)(),d=await c.rls(async b=>b.query.huntChannelCredits.findMany({where:(b,{eq:c})=>c(b.huntId,a)}));return{...b,channelCredits:d}}async function w(){let a=await (0,f.createDrizzleSupabaseClient)();return await a.rls(async a=>{let b=await a.query.hunts.findMany({where:(a,{eq:b})=>b(a.status,j.EHuntStatus.ACTIVE),orderBy:(a,{desc:b})=>[b(a.lastScanAt),b(a.createdAt)],limit:10});return await Promise.all(b.map(async b=>{let[{totalLeads:c},{contactedLeadsCount:d}]=await Promise.all([(0,h.getTotalLeads)({huntId:b.id,tx:a}),(0,h.getContactedLeads)({huntId:b.id,tx:a})]);return{id:b.id,name:b.name,status:b.status,leadCount:c,contactedCount:d,lastScanAt:b.lastScanAt,createdAt:b.createdAt}}))})}let x=async(a,b,c)=>{let d=c;d||(d=(await (0,g.getUserAccount)(a,{columnsToKeep:{id:!0}})).id),(0,k.updateTag)(e.CACHE_TAGS.huntsByAccount(d)),b&&(0,k.updateTag)(e.CACHE_TAGS.hunt(b))};a.s(["$$RSC_SERVER_CACHE_0",()=>n,"$$RSC_SERVER_CACHE_1",()=>t,"getAccountHunts",()=>q,"getActiveHunts",()=>w,"getHuntById",()=>v,"updateAccountHuntsCache",0,x])},9910,a=>{"use strict";var b=a.i(81446),c=a.i(37320);a.i(96875);var d=a.i(42810),e=a.i(69070),f=a.i(73240);async function g(){let a=await (0,b.createDrizzleSupabaseClient)(),[g,h]=await Promise.all([a.rls(async a=>{let[b,d]=await Promise.all([(0,c.getTodayNewLeads)({tx:a}),(0,c.getContactedLeads)({tx:a})]);return{newLeadsToday:b.todayLeadsCount,leadsContacted:d.contactedLeadsCount}}),a.rls(async a=>{let b=[f.EContactChannel.WHATSAPP_TEXT,f.EContactChannel.SMS,f.EContactChannel.RINGLESS_VOICE];return(await Promise.all(b.map(async b=>{let c=await a.select({count:d.sql`cast(count(*) as integer)`}).from(e.messages).where((0,d.eq)(e.messages.channel,b));return{channel:b,count:c[0]?.count??0}}))).reduce((a,{channel:b,count:c})=>(a[b]=c,a),{})})]);return{...g,messagesSentByChannel:h}}a.s(["getDashboardStats",()=>g])},80890,a=>{"use strict";var b=a.i(5522),c=a.i(9910),d=a.i(12789);async function e(){return(0,c.getDashboardStats)()}async function f(){return(0,d.getActiveHunts)()}(0,a.i(14392).ensureServerEntryExports)([e,f]),(0,b.registerServerReference)(e,"003c878c0cee57d6bb0d44a12c262f79cb054d8946",null),(0,b.registerServerReference)(f,"002f8a0392800b465940e6cc4d7d57f3709d592bed",null),a.s([],88652),a.i(88652),a.s(["002f8a0392800b465940e6cc4d7d57f3709d592bed",()=>f,"003c878c0cee57d6bb0d44a12c262f79cb054d8946",()=>e,"e0c6d22713dddd2f666ea2bc6c4707dc5bd51b4e50",()=>d.$$RSC_SERVER_CACHE_0,"f0165f65ac6657ab99c1343b90c7d1753d9ed0dfd5",()=>d.$$RSC_SERVER_CACHE_1],80890)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cd0e370c._.js.map