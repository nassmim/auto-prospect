module.exports=[46786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},4446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},55004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},60438,(a,b,c)=>{b.exports=a.x("perf_hooks",()=>require("perf_hooks"))},39284,5919,89279,62631,45667,68923,19569,90661,11439,37525,37756,68784,78345,55233,68773,53043,77856,31535,15221,37361,28235,87451,14009,46240,12401,31240,27270,69599,49827,25822,42025,a=>{"use strict";let b,c,d=Symbol.for("drizzle:entityKind");function e(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,d))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(d in c&&c[d]===b[d])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind"),a.s(["entityKind",()=>d,"is",()=>e],5919);class f{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [d]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}let g=Symbol.for("drizzle:Name"),h=Symbol.for("drizzle:Schema"),i=Symbol.for("drizzle:Columns"),j=Symbol.for("drizzle:ExtraConfigColumns"),k=Symbol.for("drizzle:OriginalName"),l=Symbol.for("drizzle:BaseName"),m=Symbol.for("drizzle:IsAlias"),n=Symbol.for("drizzle:ExtraConfigBuilder"),o=Symbol.for("drizzle:IsDrizzleTable");class p{static [d]="Table";static Symbol={Name:g,Schema:h,OriginalName:k,Columns:i,ExtraConfigColumns:j,BaseName:l,IsAlias:m,ExtraConfigBuilder:n};[g];[k];[h];[i];[j];[l];[m]=!1;[o]=!0;[n]=void 0;constructor(a,b,c){this[g]=this[k]=a,this[h]=b,this[l]=c}}function q(a){return`${a[h]??"public"}.${a[g]}`}class r{static [d]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}class s{static [d]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new t(a,this)}}class t{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [d]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[g],...d,c[0].table[g],...e];return a??`${f.join("_")}_fk`}}function u(a){return new s(function(){let{name:b,columns:c,foreignColumns:d}=a;return{name:b,columns:c,foreignColumns:d}})}function v(a,...b){return a(...b)}function w(a){return new z(a)}function x(a,b){return`${a[g]}_${b.join("_")}_unique`}a.s(["ForeignKeyBuilder",()=>s,"foreignKey",()=>u],89279);class y{constructor(a,b){this.name=b,this.columns=a}static [d]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new A(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class z{static [d]="PgUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new y(a,this.name)}}class A{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??x(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [d]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function B(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}a.s(["UniqueConstraintBuilder",()=>y,"unique",()=>w,"uniqueKeyName",()=>x],62631);class C extends r{foreignKeyConfigs=[];static [d]="PgColumnBuilder";array(a){return new G(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>v((c,d)=>{let e=new s(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new E(a,this.config)}}class D extends f{constructor(a,b){b.uniqueName||(b.uniqueName=x(a,[b.name])),super(a,b),this.table=a}static [d]="PgColumn"}class E extends D{static [d]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class F{static [d]="IndexedColumn";constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class G extends C{static [d]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new H(a,this.config,b)}}class H extends D{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [d]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=B(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=B(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:e(this.baseColumn,H)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}class I extends C{static [d]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new J(a,this.config)}}class J extends D{static [d]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let K=Symbol.for("drizzle:isPgEnum");function L(a){return!!a&&"function"==typeof a&&K in a&&!0===a[K]}class M extends C{static [d]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new N(a,this.config)}}class N extends D{static [d]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}function O(a,b){return Array.isArray(b)?P(a,[...b],void 0):Q(a,b,void 0)}function P(a,b,c){let d=Object.assign(a=>new M(a??"",d),{enumName:a,enumValues:b,schema:c,[K]:!0});return d}function Q(a,b,c){let d=Object.assign(a=>new I(a??"",d),{enumName:a,enumValues:Object.values(b),schema:c,[K]:!0});return d}a.s(["isPgEnum",()=>L,"pgEnum",()=>O,"pgEnumObjectWithSchema",()=>Q,"pgEnumWithSchema",()=>P],45667);class R{static [d]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class S extends R{static [d]="WithSubquery"}let T=(a,d)=>b?(c||(c=b.trace.getTracer("drizzle-orm","0.45.1")),v((b,c)=>c.startActiveSpan(a,a=>{try{return d(a)}catch(c){throw a.setStatus({code:b.SpanStatusCode.ERROR,message:c instanceof Error?c.message:"Unknown error"}),c}finally{a.end()}}),b,c)):d(),U=Symbol.for("drizzle:ViewBaseConfig");class V{static [d]="FakePrimitiveParam"}function W(a){return null!=a&&"function"==typeof a.getSQL}class X{static [d]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new Y([this])}}class Y{constructor(a){for(const b of(this.queryChunks=a,a))if(e(b,p)){const a=b[p.Symbol.Schema];this.usedTables.push(void 0===a?b[p.Symbol.Name]:a+"."+b[p.Symbol.Name])}}static [d]="SQL";decoder=_;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return T("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:d,escapeName:g,escapeParam:h,prepareTyping:i,inlineParams:j,paramStartIndex:k}=c;var l=a.map(a=>{if(e(a,X))return{sql:a.value.join(""),params:[]};if(e(a,Z))return{sql:g(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new X("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new X(", "));return b.push(new X(")")),this.buildQueryFromSourceParams(b,c)}if(e(a,Y))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:j||a.shouldInlineParams});if(e(a,p)){let b=a[p.Symbol.Schema],c=a[p.Symbol.Name];return{sql:void 0===b||a[m]?g(c):g(b)+"."+g(c),params:[]}}if(e(a,f)){let c=d.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:g(c),params:[]};let e=a.table[p.Symbol.Schema];return{sql:a.table[m]||void 0===e?g(a.table[p.Symbol.Name])+"."+g(c):g(e)+"."+g(a.table[p.Symbol.Name])+"."+g(c),params:[]}}if(e(a,ao)){let b=a[U].schema,c=a[U].name;return{sql:void 0===b||a[U].isAlias?g(c):g(b)+"."+g(c),params:[]}}if(e(a,ab)){if(e(a.value,al))return{sql:h(k.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if(e(b,Y))return this.buildQueryFromSourceParams([b],c);if(j)return{sql:this.mapInlineParam(b,c),params:[]};let d=["none"];return i&&(d=[i(a.encoder)]),{sql:h(k.value++,b),params:[b],typings:d}}return e(a,al)?{sql:h(k.value++,a),params:[a],typings:["none"]}:e(a,Y.Aliased)&&void 0!==a.fieldAlias?{sql:g(a.fieldAlias),params:[]}:e(a,R)?a._.isWith?{sql:g(a._.alias),params:[]}:this.buildQueryFromSourceParams([new X("("),a._.sql,new X(") "),new Z(a._.alias)],c):L(a)?a.schema?{sql:g(a.schema)+"."+g(a.enumName),params:[]}:{sql:g(a.enumName),params:[]}:W(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new X("("),a.getSQL(),new X(")")],c):j?{sql:this.mapInlineParam(a,c),params:[]}:{sql:h(k.value++,a),params:[a],typings:["none"]}});let n={sql:"",params:[]};for(let a of l)n.sql+=a.sql,n.params.push(...a.params),a.typings?.length&&(n.typings||(n.typings=[]),n.typings.push(...a.typings));return n}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new Y.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class Z{constructor(a){this.value=a}static [d]="Name";brand;getSQL(){return new Y([this])}}function $(a){return"object"==typeof a&&null!==a&&"mapToDriverValue"in a&&"function"==typeof a.mapToDriverValue}let _={mapFromDriverValue:a=>a},aa={mapToDriverValue:a=>a};({..._,...aa});class ab{constructor(a,b=aa){this.value=a,this.encoder=b}static [d]="Param";brand;getSQL(){return new Y([this])}}function ac(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new X(a[0])),b.entries()))c.push(e,new X(a[d+1]));return new Y(c)}(ad=ac||(ac={})).empty=function(){return new Y([])},ad.fromList=function(a){return new Y(a)},ad.raw=function(a){return new Y([new X(a)])},ad.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new Y(c)},ad.identifier=function(a){return new Z(a)},ad.placeholder=function(a){return new al(a)},ad.param=function(a,b){return new ab(a,b)};var ad,ae,af,ag,ah,ai,aj=Y||(Y={});class ak{constructor(a,b){this.sql=a,this.fieldAlias=b}static [d]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new ak(this.sql,this.fieldAlias)}}aj.Aliased=ak;class al{constructor(a){this.name=a}static [d]="Placeholder";getSQL(){return new Y([this])}}function am(a,b){return a.map(a=>{if(e(a,al)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if(e(a,ab)&&e(a.value,al)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let an=Symbol.for("drizzle:IsDrizzleView");class ao{static [d]="View";[U];[an]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[U]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new Y([this])}}function ap(a,b){return!$(b)||W(a)||e(a,ab)||e(a,al)||e(a,f)||e(a,p)||e(a,ao)?a:new ab(a,b)}f.prototype.getSQL=function(){return new Y([this])},p.prototype.getSQL=function(){return new Y([this])},R.prototype.getSQL=function(){return new Y([this])},a.s(["Param",()=>ab,"Placeholder",()=>al,"SQL",()=>Y,"StringChunk",()=>X,"View",()=>ao,"fillPlaceholders",()=>am,"isDriverValueEncoder",()=>$,"isSQLWrapper",()=>W,"sql",()=>ac],68923);let aq=(a,b)=>ac`${a} = ${ap(b,a)}`,ar=(a,b)=>ac`${a} <> ${ap(b,a)}`;function as(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new Y(1===b.length?b:[new X("("),ac.join(b,new X(" and ")),new X(")")])}function at(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new Y(1===b.length?b:[new X("("),ac.join(b,new X(" or ")),new X(")")])}function au(a){return ac`not ${a}`}let av=(a,b)=>ac`${a} > ${ap(b,a)}`,aw=(a,b)=>ac`${a} >= ${ap(b,a)}`,ax=(a,b)=>ac`${a} < ${ap(b,a)}`,ay=(a,b)=>ac`${a} <= ${ap(b,a)}`;function az(a,b){return Array.isArray(b)?0===b.length?ac`false`:ac`${a} in ${b.map(b=>ap(b,a))}`:ac`${a} in ${ap(b,a)}`}function aA(a,b){return Array.isArray(b)?0===b.length?ac`true`:ac`${a} not in ${b.map(b=>ap(b,a))}`:ac`${a} not in ${ap(b,a)}`}function aB(a){return ac`${a} is null`}function aC(a){return ac`${a} is not null`}function aD(a){return ac`exists ${a}`}function aE(a){return ac`not exists ${a}`}function aF(a,b,c){return ac`${a} between ${ap(b,a)} and ${ap(c,a)}`}function aG(a,b,c){return ac`${a} not between ${ap(b,a)} and ${ap(c,a)}`}function aH(a,b){return ac`${a} like ${b}`}function aI(a,b){return ac`${a} not like ${b}`}function aJ(a,b){return ac`${a} ilike ${b}`}function aK(a,b){return ac`${a} not ilike ${b}`}a.s(["and",()=>as,"between",()=>aF,"eq",()=>aq,"exists",()=>aD,"gt",()=>av,"gte",()=>aw,"ilike",()=>aJ,"inArray",()=>az,"isNotNull",()=>aC,"isNull",()=>aB,"like",()=>aH,"lt",()=>ax,"lte",()=>ay,"ne",()=>ar,"not",()=>au,"notBetween",()=>aG,"notExists",()=>aE,"notIlike",()=>aK,"notInArray",()=>aA,"notLike",()=>aI,"or",()=>at],39284);var aL=a.i(46786),aM=a.i(22734);let aN=new Map,aO=new Map,aP=Symbol("OriginError"),aQ={};class aR extends Promise{constructor(a,b,c,d,e={}){let f,g;super((a,b)=>{f=a,g=b}),this.tagged=Array.isArray(a.raw),this.strings=a,this.args=b,this.handler=c,this.canceller=d,this.options=e,this.state=null,this.statement=null,this.resolve=a=>(this.active=!1,f(a)),this.reject=a=>(this.active=!1,g(a)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[aP]=this.handler.debug?Error():this.tagged&&function(a){if(aN.has(a))return aN.get(a);let b=Error.stackTraceLimit;return Error.stackTraceLimit=4,aN.set(a,Error()),Error.stackTraceLimit=b,aN.get(a)}(this.strings)}get origin(){return(this.handler.debug?this[aP].stack:this.tagged&&aO.has(this.strings)?aO.get(this.strings):aO.set(this.strings,this[aP].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(a=1,b){let c;return(this.options.simple=!1,"function"==typeof a&&(b=a,a=1),this.cursorRows=a,"function"==typeof b)?(this.cursorFn=b,this):{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};c&&c();let a=new Promise((a,b)=>{this.cursorFn=b=>(a({value:b,done:!1}),new Promise(a=>c=a)),this.resolve=()=>(this.active=!1,a({done:!0})),this.reject=a=>(this.active=!1,b(a))});return this.execute(),a},return:()=>(c&&c(aQ),{done:!0})})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw Error(".stream has been renamed to .forEach")}forEach(a){return this.forEachFn=a,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}class aS extends Error{constructor(a){super(a.message),this.name=this.constructor.name,Object.assign(this,a)}}let aT=function a(b,c,d){let{host:e,port:f}=d||c,g=Object.assign(Error("write "+b+" "+(c.path||e+":"+f)),{code:b,errno:b,address:c.path||e},c.path?{}:{port:f});return Error.captureStackTrace(g,a),g},aU=function a(b){let c=new aS(b);return Error.captureStackTrace(c,a),c},aV=function a(b,c){let d=Object.assign(Error(b+": "+c),{code:b});return Error.captureStackTrace(d,a),d},aW=function a(b){let c=Object.assign(Error(b+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:b});return Error.captureStackTrace(c,a),c};class aX{then(){a8()}catch(){a8()}finally(){a8()}}class aY extends aX{constructor(a){super(),this.value=be(a)}}class aZ extends aX{constructor(a,b,c){super(),this.value=a,this.type=b,this.array=c}}class a$ extends aX{constructor(a,b){super(),this.first=a,this.rest=b}build(a,b,c,d){let e=a7.map(([b,c])=>({fn:c,i:a.search(b)})).sort((a,b)=>a.i-b.i).pop();return -1===e.i?bd(this.first,d):e.fn(this.first,this.rest,b,c,d)}}function a_(a,b,c,d){let e=a instanceof aZ?a.value:a;if(void 0===e&&(a instanceof aZ?a.value=d.transform.undefined:e=a=d.transform.undefined,void 0===e))throw aV("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+c.push(a instanceof aZ?(b.push(a.value),a.array?a.array[a.type||bf(a.value)]||a.type||function a(b){return Array.isArray(b)?a(b[0]):1009*("string"==typeof b)}(a.value):a.type):(b.push(a),bf(a)))}let a0=bc({string:{to:25,from:null,serialize:a=>""+a},number:{to:0,from:[21,23,26,700,701],serialize:a=>""+a,parse:a=>+a},json:{to:114,from:[114,3802],serialize:a=>JSON.stringify(a),parse:a=>JSON.parse(a)},boolean:{to:16,from:16,serialize:a=>!0===a?"t":"f",parse:a=>"t"===a},date:{to:1184,from:[1082,1114,1184],serialize:a=>(a instanceof Date?a:new Date(a)).toISOString(),parse:a=>new Date(a)},bytea:{to:17,from:17,serialize:a=>"\\x"+Buffer.from(a).toString("hex"),parse:a=>Buffer.from(a.slice(2),"hex")}});function a1(a,b,c,d,e,f){for(let g=1;g<a.strings.length;g++)b+=a2(b,c,d,e,f)+a.strings[g],c=a.args[g];return b}function a2(a,b,c,d,e){return b instanceof a$?b.build(a,c,d,e):b instanceof aR?a3(b,c,d,e):b instanceof aY?b.value:b&&b[0]instanceof aR?b.reduce((a,b)=>a+" "+a3(b,c,d,e),""):a_(b,c,d,e)}function a3(a,b,c,d){return a.fragment=!0,a1(a,a.strings[0],a.args[0],b,c,d)}function a4(a,b,c,d,e){return a.map(a=>"("+d.map(d=>a2("values",a[d],b,c,e)).join(",")+")").join(",")}function a5(a,b,c,d,e){let f=Array.isArray(a[0]),g=b.length?b.flat():Object.keys(f?a[0]:a);return a4(f?a:[a],c,d,g,e)}function a6(a,b,c,d,e){let f;return("string"==typeof a&&(a=[a].concat(b)),Array.isArray(a))?bd(a,e):(b.length?b.flat():Object.keys(a)).map(b=>((f=a[b])instanceof aR?a3(f,c,d,e):f instanceof aY?f.value:a_(f,c,d,e))+" as "+be(e.transform.column.to?e.transform.column.to(b):b)).join(",")}let a7=Object.entries({values:a5,in:(...a)=>{let b=a5(...a);return"()"===b?"(null)":b},select:a6,as:a6,returning:a6,"\\(":a6,update:(a,b,c,d,e)=>(b.length?b.flat():Object.keys(a)).map(b=>be(e.transform.column.to?e.transform.column.to(b):b)+"="+a2("values",a[b],c,d,e)),insert(a,b,c,d,e){let f=b.length?b.flat():Object.keys(Array.isArray(a)?a[0]:a);return"("+bd(f,e)+")values"+a4(Array.isArray(a)?a:[a],c,d,f,e)}}).map(([a,b])=>[RegExp("((?:^|[\\s(])"+a+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),b]);function a8(){throw aV("NOT_TAGGED_CALL","Query not called as a tagged template literal")}let a9=a0.serializers,ba=a0.parsers,bb=function(a){let b=bc(a||{});return{serializers:Object.assign({},a9,b.serializers),parsers:Object.assign({},ba,b.parsers)}};function bc(a){return Object.keys(a).reduce((b,c)=>(a[c].from&&[].concat(a[c].from).forEach(d=>b.parsers[d]=a[c].parse),a[c].serialize&&(b.serializers[a[c].to]=a[c].serialize,a[c].from&&[].concat(a[c].from).forEach(d=>b.serializers[d]=a[c].serialize)),b),{parsers:{},serializers:{}})}function bd(a,{transform:{column:b}}){return a.map(a=>be(b.to?b.to(a):a)).join(",")}let be=function(a){return'"'+a.replace(/"/g,'""').replace(/\./g,'"."')+'"'},bf=function a(b){return b instanceof aZ?b.type:b instanceof Date?1184:b instanceof Uint8Array?17:!0===b||!1===b?16:"bigint"==typeof b?20:Array.isArray(b)?a(b[0]):0},bg=/\\/g,bh=/"/g,bi=function a(b,c,d,e){if(!1===Array.isArray(b))return b;if(!b.length)return"{}";let f=b[0],g=1020===e?";":",";return Array.isArray(f)&&!f.type?"{"+b.map(b=>a(b,c,d,e)).join(g)+"}":"{"+b.map(a=>{if(void 0===a&&void 0===(a=d.transform.undefined))throw aV("UNDEFINED_VALUE","Undefined values are not allowed");return null===a?"null":'"'+(c?c(a.type?a.value:a):""+a).replace(bg,"\\\\").replace(bh,'\\"')+'"'}).join(g)+"}"},bj={i:0,char:null,str:"",quoted:!1,last:0},bk=a=>{let b=a[0];for(let c=1;c<a.length;c++)b+="_"===a[c]?a[++c].toUpperCase():a[c];return b},bl=a=>{let b=a[0].toUpperCase();for(let c=1;c<a.length;c++)b+="_"===a[c]?a[++c].toUpperCase():a[c];return b},bm=a=>a.replace(/_/g,"-"),bn=a=>a.replace(/([A-Z])/g,"_$1").toLowerCase(),bo=a=>(a.slice(0,1)+a.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),bp=a=>a.replace(/-/g,"_");function bq(a){return function b(c,d){return"object"==typeof c&&null!==c&&(114===d.type||3802===d.type)?Array.isArray(c)?c.map(a=>b(a,d)):Object.entries(c).reduce((c,[e,f])=>Object.assign(c,{[a(e)]:b(f,d)}),{}):c}}bk.column={from:bk},bk.value={from:bq(bk)},bn.column={to:bn};let br={...bk};br.column.to=bn,bl.column={from:bl},bl.value={from:bq(bl)},bo.column={to:bo};let bs={...bl};bs.column.to=bo,bm.column={from:bm},bm.value={from:bq(bm)},bp.column={to:bp};let bt={...bm};bt.column.to=bp;var bu=a.i(4446),bv=a.i(55004),bw=a.i(54799),bx=a.i(88947),by=a.i(60438);class bz extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}let bA=function(a=[]){let b=a.slice(),c=0;return{get length(){return b.length-c},remove:a=>{let c=b.indexOf(a);return -1===c?null:(b.splice(c,1),a)},push:a=>(b.push(a),a),shift:()=>{let a=b[c++];return c===b.length?(c=0,b=[]):b[c-1]=void 0,a}}},bB=Buffer.allocUnsafe(256),bC=Object.assign(function(){return bC.i=0,bC},"BCcDdEFfHPpQSX".split("").reduce((a,b)=>{let c=b.charCodeAt(0);return a[b]=()=>(bB[0]=c,bC.i=5,bC),a},{}),{N:"\0",i:0,inc:a=>(bC.i+=a,bC),str(a){let b=Buffer.byteLength(a);return bD(b),bC.i+=bB.write(a,bC.i,b,"utf8"),bC},i16:a=>(bD(2),bB.writeUInt16BE(a,bC.i),bC.i+=2,bC),i32:(a,b)=>(b||0===b?bB.writeUInt32BE(a,b):(bD(4),bB.writeUInt32BE(a,bC.i),bC.i+=4),bC),z:a=>(bD(a),bB.fill(0,bC.i,bC.i+a),bC.i+=a,bC),raw:a=>(bB=Buffer.concat([bB.subarray(0,bC.i),a]),bC.i=bB.length,bC),end(a=1){bB.writeUInt32BE(bC.i-a,a);let b=bB.subarray(0,bC.i);return bC.i=0,bB=Buffer.allocUnsafe(256),b}});function bD(a){if(bB.length-bC.i<a){let b=bB,c=b.length;bB=Buffer.allocUnsafe(c+(c>>1)+a),b.copy(bB)}}let bE=function a(b,c={},{onopen:d=bL,onend:e=bL,onclose:f=bL}={}){let{sslnegotiation:g,ssl:h,max:i,user:j,host:k,port:l,database:m,parsers:n,transform:o,onnotice:p,onnotify:q,onparameter:r,max_pipeline:s,keep_alive:t,backoff:u,target_session_attrs:v}=b,w=bA(),x=bF++,y={pid:null,secret:null},z=bR(av,b.idle_timeout),A=bR(av,b.max_lifetime),B=bR(function(){at(aT("CONNECT_TIMEOUT",b,C)),C.destroy()},b.connect_timeout),C=null,D,E=null,F=new bz,G=Buffer.alloc(0),H=b.fetch_types,I={},J={},K=Math.random().toString(36).slice(2),L=1,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=null,U=null,V=!1,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ab=null,ac=null,ad=null,ae={queue:c.closed,idleTimer:z,connect(a){Y=a,aq()},terminate:aw,execute:ah,cancel:ag,end:av,count:0,id:x};return c.closed&&c.closed.push(ae),ae;async function af(){let a;try{a=b.socket?await Promise.resolve(b.socket(b)):new bu.default.Socket}catch(a){as(a);return}return a.on("error",as),a.on("close",ax),a.on("drain",an),a}async function ag({pid:a,secret:b},c,d){try{D=bC().i32(16).i32(0x4d2162e).i32(a).i32(b).end(16),await ap(),C.once("error",d),C.once("close",c)}catch(a){d(a)}}function ah(a){if(V)return au(a,aT("CONNECTION_DESTROYED",b));if($)return au(a,aV("COPY_IN_PROGRESS","You cannot execute queries during copy"));if(!a.cancelled)try{var c;let d,e,f;return a.state=y,ac?w.push(a):(ac=a).active=!0,c=a,d=[],e=[],f=a1(c,c.strings[0],c.args[0],d,e,b),c.tagged||c.args.forEach(a=>a_(a,d,e,b)),c.prepare=b.prepare&&(!("prepare"in c.options)||c.options.prepare),c.string=f,c.signature=c.prepare&&e+f,c.onlyDescribe&&delete J[c.signature],c.parameters=c.parameters||d,c.prepared=c.prepare&&c.signature in J,c.describeFirst=c.onlyDescribe||d.length&&!c.prepared,c.statement=c.prepared?J[c.signature]:{string:f,types:e,name:c.prepare?K+L++:""},"function"==typeof b.debug&&b.debug(x,f,d,e),ak(function(a){var b;if(a.parameters.length>=65534)throw aV("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return a.options.simple?bC().Q().str(a.statement.string+bC.N).end():a.describeFirst?Buffer.concat([ai(a),bH]):a.prepare?a.prepared?aj(a):Buffer.concat([ai(a),aj(a)]):(b=a,Buffer.concat([aH(b.statement.string,b.parameters,b.statement.types),bK,aj(b)]))}(a))&&!a.describeFirst&&!a.cursorFn&&w.length<s&&(!a.options.onexecute||a.options.onexecute(ae))}catch(a){return 0===w.length&&ak(bG),at(a),!0}}function ai(a){return Buffer.concat([aH(a.statement.string,a.parameters,a.statement.types,a.statement.name),function(a,b=""){return bC().D().str("S").str(b+bC.N).end()}("S",a.statement.name)])}function aj(a){return Buffer.concat([function(a,c,d="",e=""){let f,g;return bC().B().str(e+bC.N).str(d+bC.N).i16(0).i16(a.length),a.forEach((d,e)=>{if(null===d)return bC.i32(0xffffffff);g=c[e],a[e]=d=g in b.serializers?b.serializers[g](d):""+d,f=bC.i,bC.inc(4).str(d).i32(bC.i-f-4,f)}),bC.i16(0),bC.end()}(a.parameters,a.statement.types,a.statement.name,a.cursorName),a.cursorFn?aI("",a.cursorRows):bJ])}function ak(a,b){return(_=_?Buffer.concat([_,a]):Buffer.from(a),b||_.length>=1024)?al(b):(null===U&&(U=setImmediate(al)),!0)}function al(a){let b=C.write(_,a);return null!==U&&clearImmediate(U),_=U=null,b}async function am(){if("direct"!==g&&(ak(bI),!await new Promise(a=>C.once("data",b=>a(83===b[0])))&&"prefer"===h))return ar();let a={socket:C,servername:bu.default.isIP(C.host)?void 0:C.host};"direct"===g&&(a.ALPNProtocols=["postgresql"]),"require"===h||"allow"===h||"prefer"===h?a.rejectUnauthorized=!1:"object"==typeof h&&Object.assign(a,h),C.removeAllListeners(),(C=bv.default.connect(a)).on("secureConnect",ar),C.on("error",as),C.on("close",ax),C.on("drain",an)}function an(){ac||d(ae)}function ao(c){if(!W||(W.push(c),!((N-=c.length)>0)))for(G=W?Buffer.concat(W,Q-N):0===G.length?c:Buffer.concat([G,c],G.length+c.length);G.length>4;){if((Q=G.readUInt32BE(1))>=G.length){N=Q-G.length,W=[G];break}try{!function(c,e=c[0]){(68===e?function(a){let b,c,d,e=7,f=ac.isRaw?Array(ac.statement.columns.length):{};for(let g=0;g<ac.statement.columns.length;g++)c=ac.statement.columns[g],b=a.readInt32BE(e),e+=4,d=-1===b?null:!0===ac.isRaw?a.subarray(e,e+=b):void 0===c.parser?a.toString("utf8",e,e+=b):!0===c.parser.array?c.parser(a.toString("utf8",e+1,e+=b)):c.parser(a.toString("utf8",e,e+=b)),ac.isRaw?f[g]=!0===ac.isRaw?d:o.value.from?o.value.from(d,c):d:f[c.name]=o.value.from?o.value.from(d,c):d;ac.forEachFn?ac.forEachFn(o.row.from?o.row.from(f):f,F):F[S++]=o.row.from?o.row.from(f):f}:100===e?function(a){$&&($.push(a.subarray(5))||C.pause())}:65===e?function(a){if(!q)return;let b=9;for(;0!==a[b++];);q(a.toString("utf8",9,b-1),a.toString("utf8",b,a.length-1))}:83===e?function(a){let[c,d]=a.toString("utf8",5,a.length-1).split(bC.N);I[c]=d,b.parameters[c]!==d&&(b.parameters[c]=d,r&&r(c,d))}:90===e?function(c){var e,f,g,h;if(ac?E?ac.retried?at(ac.retried):ac.prepared&&bM.has(E.routine)?(e=ac,f=E,delete J[e.signature],e.retried=f,ah(e)):at(E):ac.resolve(X||F):E&&at(E),ac=X=E=null,F=new bz,B.cancel(),Y){if(v)if(!I.in_hot_standby||!I.default_transaction_read_only)return function(){let a=new aR([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],ah,null,{simple:!0});a.resolve=([[a],[b]])=>{I.default_transaction_read_only=a.transaction_read_only,I.in_hot_standby=b.pg_is_in_recovery?"on":"off"},a.execute()}();else{if(g=v,h=I,"read-write"===g&&"on"===h.default_transaction_read_only||"read-only"===g&&"off"===h.default_transaction_read_only||"primary"===g&&"on"===h.in_hot_standby||"standby"===g&&"off"===h.in_hot_standby||"prefer-standby"===g&&"off"===h.in_hot_standby&&b.host[P])return aw()}return H?(Y.reserve&&(Y=null),aF()):(Y&&!Y.reserve&&ah(Y),b.shared.retries=P=0,void(Y=null))}for(;w.length&&(ac=w.shift())&&(ac.active=!0,ac.cancelled);)a(b).cancel(ac.state,ac.cancelled.resolve,ac.cancelled.reject);ac||(ae.reserved?ae.reserved.release||73!==c[5]?ae.reserved():Z?aw():(ae.reserved=null,d(ae)):Z?aw():d(ae))}:67===e?function(a){S=0;for(let b=a.length-1;b>0;b--)if(32===a[b]&&a[b+1]<58&&null===F.count&&(F.count=+a.toString("utf8",b+1,a.length-1)),a[b-1]>=65){F.command=a.toString("utf8",5,b),F.state=y;break}return(ad&&(ad(),ad=null),"BEGIN"!==F.command||1===i||ae.reserved)?ac.options.simple?ay():void(ac.cursorFn&&(F.count&&ac.cursorFn(F),ak(bG))):at(aV("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"))}:50===e?ay:49===e?function(){ac.parsing=!1}:116===e?function(a){let b=a.readUInt16BE(5);for(let c=0;c<b;++c)ac.statement.types[c]||(ac.statement.types[c]=a.readUInt32BE(7+4*c));ac.prepare&&(J[ac.signature]=ac.statement),ac.describeFirst&&!ac.onlyDescribe&&(ak(aj(ac)),ac.describeFirst=!1)}:84===e?function(a){let b;F.command&&((X=X||[F]).push(F=new bz),F.count=null,ac.statement.columns=null);let c=a.readUInt16BE(5),d=7;ac.statement.columns=Array(c);for(let e=0;e<c;++e){for(b=d;0!==a[d++];);let c=a.readUInt32BE(d),f=a.readUInt16BE(d+4),g=a.readUInt32BE(d+6);ac.statement.columns[e]={name:o.column.from?o.column.from(a.toString("utf8",b,d-1)):a.toString("utf8",b,d-1),parser:n[g],table:c,number:f,type:g},d+=18}if(F.statement=ac.statement,ac.onlyDescribe)return ac.resolve(ac.statement),ak(bG)}:82===e?az:110===e?function(){if(F.statement=ac.statement,F.statement.columns=[],ac.onlyDescribe)return ac.resolve(ac.statement),ak(bG)}:75===e?function(a){y.pid=a.readUInt32BE(5),y.secret=a.readUInt32BE(9)}:69===e?function(a){ac?((ac.cursorFn||ac.describeFirst)&&ak(bG),E=aU(bO(a))):at(aU(bO(a)))}:115===e?aG:51===e?function(){F.count&&ac.cursorFn(F),ac.resolve(F)}:71===e?function(){$=new bx.default.Writable({autoDestroy:!0,write(a,b,c){C.write(bC().d().raw(a).end(),c)},destroy(a,b){b(a),C.write(bC().f().str(a+bC.N).end()),$=null},final(a){C.write(bC().c().end()),ad=a,$=null}}),ac.resolve($)}:78===e?function(a){p?p(bO(a)):console.log(bO(a))}:72===e?function(){$=new bx.default.Readable({read(){C.resume()}}),ac.resolve($)}:99===e?function(){$&&$.push(null),$=null}:73===e?function(){}:86===e?function(){at(aW("FunctionCallResponse"))}:118===e?function(){at(aW("NegotiateProtocolVersion"))}:87===e?function(){$=new bx.default.Duplex({autoDestroy:!0,read(){C.resume()},write(a,b,c){C.write(bC().d().raw(a).end(),c)},destroy(a,b){b(a),C.write(bC().f().str(a+bC.N).end()),$=null},final(a){C.write(bC().c().end()),ad=a}}),ac.resolve($)}:function(a){console.error("Postgres.js : Unknown Message:",a[0])})(c)}(G.subarray(0,Q+1))}catch(a){ac&&(ac.cursorFn||ac.describeFirst)&&ak(bG),at(a)}G=G.subarray(Q+1),N=0,W=null}}async function ap(){if(V=!1,I={},C||(C=await af()),C){if(B.start(),b.socket)return h?am():ar();if(C.on("connect",h?am:ar),b.path)return C.connect(b.path);C.ssl=h,C.connect(l[O],k[O]),C.host=k[O],C.port=l[O],O=(O+1)%l.length}}function aq(){setTimeout(ap,M?Math.max(0,M+R-by.performance.now()):0)}function ar(){try{J={},H=b.fetch_types,K=Math.random().toString(36).slice(2),L=1,A.start(),C.on("data",ao),t&&C.setKeepAlive&&C.setKeepAlive(!0,1e3*t);let a=D||bC().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:j,database:m,client_encoding:"UTF8"},b.connection)).filter(([,a])=>a).map(([a,b])=>a+bC.N+b).join(bC.N)).z(2).end(0);ak(a)}catch(a){as(a)}}function as(a){if(ae.queue!==c.connecting||!b.host[P+1])for(at(a);w.length;)au(w.shift(),a)}function at(a){$&&($.destroy(a),$=null),ac&&au(ac,a),Y&&(au(Y,a),Y=null)}function au(a,c){if(a.reserve)return a.reject(c);c&&"object"==typeof c||(c=Error(c)),"query"in c||"parameters"in c||Object.defineProperties(c,{stack:{value:c.stack+a.origin.replace(/.*\n/,"\n"),enumerable:b.debug},query:{value:a.string,enumerable:b.debug},parameters:{value:a.parameters,enumerable:b.debug},args:{value:a.args,enumerable:b.debug},types:{value:a.statement&&a.statement.types,enumerable:b.debug}}),a.reject(c)}function av(){return Z||(ae.reserved||e(ae),ae.reserved||Y||ac||0!==w.length?Z=new Promise(a=>aa=a):(aw(),new Promise(a=>C&&"closed"!==C.readyState?C.once("close",a):a())))}function aw(){V=!0,($||ac||Y||w.length)&&as(aT("CONNECTION_DESTROYED",b)),clearImmediate(U),C&&(C.removeListener("data",ao),C.removeListener("connect",ar),"open"===C.readyState&&C.end(bC().X().end())),aa&&(aa(),Z=aa=null)}async function ax(a){if(G=Buffer.alloc(0),N=0,W=null,clearImmediate(U),C.removeListener("data",ao),C.removeListener("connect",ar),z.cancel(),A.cancel(),B.cancel(),C.removeAllListeners(),C=null,Y)return aq();!a&&(ac||w.length)&&as(aT("CONNECTION_CLOSED",b,C)),M=by.performance.now(),a&&b.shared.retries++,R=("function"==typeof u?u(b.shared.retries):u)*1e3,f(ae,aT("CONNECTION_CLOSED",b,C))}function ay(){F.statement||(F.statement=ac.statement),F.columns=ac.statement.columns}async function az(a,b=a.readUInt32BE(5)){(3===b?aA:5===b?aB:10===b?aC:11===b?aD:12===b?function(a){a.toString("utf8",9).split(bC.N,1)[0].slice(2)!==T&&(at(aV("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),C.destroy())}:0!==b?function(a,b){console.error("Postgres.js : Unknown Auth:",b)}:bL)(a,b)}async function aA(){let a=await aE();ak(bC().p().str(a).z(1).end())}async function aB(a){let b="md5"+await bP(Buffer.concat([Buffer.from(await bP(await aE()+j)),a.subarray(9)]));ak(bC().p().str(b).z(1).end())}async function aC(){ab=(await bw.default.randomBytes(18)).toString("base64"),bC().p().str("SCRAM-SHA-256"+bC.N);let a=bC.i;ak(bC.inc(4).str("n,,n=*,r="+ab).i32(bC.i-a-4,a).end())}async function aD(a){var b;let c=a.toString("utf8",9).split(",").reduce((a,b)=>(a[b[0]]=b.slice(2),a),{}),d=await bw.default.pbkdf2Sync(await aE(),Buffer.from(c.s,"base64"),parseInt(c.i),32,"sha256"),e=await bQ(d,"Client Key"),f="n=*,r="+ab+",r="+c.r+",s="+c.s+",i="+c.i+",c=biws,r="+c.r;T=(await bQ(await bQ(d,"Server Key"),f)).toString("base64");let g="c=biws,r="+c.r+",p="+(function(a,b){let c=Math.max(a.length,b.length),d=Buffer.allocUnsafe(c);for(let e=0;e<c;e++)d[e]=a[e]^b[e];return d})(e,Buffer.from(await bQ(await (b=e,bw.default.createHash("sha256").update(b).digest()),f))).toString("base64");ak(bC().p().str(g).end())}function aE(){return Promise.resolve("function"==typeof b.pass?b.pass():b.pass)}async function aF(){H=!1,(await new aR([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],ah)).forEach(({oid:a,typarray:c})=>(function(a,c){if(b.parsers[c]&&b.serializers[c])return;let d=b.parsers[a];b.shared.typeArrayMap[a]=c,b.parsers[c]=a=>(bj.i=bj.last=0,function a(b,c,d,e){let f=[],g=1020===e?";":",";for(;b.i<c.length;b.i++){if(b.char=c[b.i],b.quoted)"\\"===b.char?b.str+=c[++b.i]:'"'===b.char?(f.push(d?d(b.str):b.str),b.str="",b.quoted='"'===c[b.i+1],b.last=b.i+2):b.str+=b.char;else if('"'===b.char)b.quoted=!0;else if("{"===b.char)b.last=++b.i,f.push(a(b,c,d,e));else if("}"===b.char){b.quoted=!1,b.last<b.i&&f.push(d?d(c.slice(b.last,b.i)):c.slice(b.last,b.i)),b.last=b.i+1;break}else b.char===g&&"}"!==b.p&&'"'!==b.p&&(f.push(d?d(c.slice(b.last,b.i)):c.slice(b.last,b.i)),b.last=b.i+1);b.p=b.char}return b.last<b.i&&f.push(d?d(c.slice(b.last,b.i+1)):c.slice(b.last,b.i+1)),f}(bj,a,d,c)),b.parsers[c].array=!0,b.serializers[c]=d=>bi(d,b.serializers[a],b,c)})(a,c))}async function aG(){try{let a=await Promise.resolve(ac.cursorFn(F));S=0,a===aQ?ak(function(a=""){return Buffer.concat([bC().C().str("P").str(a+bC.N).end(),bC().S().end()])}(ac.portal)):(F=new bz,ak(aI("",ac.cursorRows)))}catch(a){ak(bG),ac.reject(a)}}function aH(a,b,c,d=""){return bC().P().str(d+bC.N).str(a+bC.N).i16(b.length),b.forEach((a,b)=>bC.i32(c[b]||0)),bC.end()}function aI(a="",b=0){return Buffer.concat([bC().E().str(a+bC.N).i32(b).end(),bH])}},bF=1,bG=bC().S().end(),bH=bC().H().end(),bI=bC().i32(8).i32(0x4d2162f).end(8),bJ=Buffer.concat([bC().E().str(bC.N).i32(0).end(),bG]),bK=bC().D().str("S").str(bC.N).end(),bL=()=>{},bM=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),bN={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function bO(a){let b={},c=5;for(let d=5;d<a.length-1;d++)0===a[d]&&(b[bN[a[c]]]=a.toString("utf8",c+1,d),c=d+1);return b}function bP(a){return bw.default.createHash("md5").update(a).digest("hex")}function bQ(a,b){return bw.default.createHmac("sha256",a).update(b).digest()}function bR(a,b){let c;if(!(b="function"==typeof b?b():b))return{cancel:bL,start:bL};return{cancel(){c&&(clearTimeout(c),c=null)},start(){c&&clearTimeout(c),c=setTimeout(d,1e3*b,arguments)}};function d(b){a.apply(null,b),c=null}}let bS=()=>{};function bT(a,b,c,d){let e,f,g,h=d.raw?Array(b.length):{};for(let i=0;i<b.length;i++)e=a[c++],f=b[i],g=110===e?null:117===e?void 0:void 0===f.parser?a.toString("utf8",c+4,c+=4+a.readUInt32BE(c)):!0===f.parser.array?f.parser(a.toString("utf8",c+5,c+=4+a.readUInt32BE(c))):f.parser(a.toString("utf8",c+4,c+=4+a.readUInt32BE(c))),d.raw?h[i]=!0===d.raw?g:d.value.from?d.value.from(g,f):g:h[f.name]=d.value.from?d.value.from(g,f):g;return{i:c,row:d.row.from?d.row.from(h):h}}function bU(a,b,c=393216){return new Promise(async(d,e)=>{await a.begin(async a=>{let e;b||([{oid:b}]=await a`select lo_creat(-1) as oid`);let[{fd:f}]=await a`select lo_open(${b}, ${c}) as fd`,g={writable:i,readable:h,close:()=>a`select lo_close(${f})`.then(e),tell:()=>a`select lo_tell64(${f})`,read:b=>a`select loread(${f}, ${b}) as data`,write:b=>a`select lowrite(${f}, ${b})`,truncate:b=>a`select lo_truncate64(${f}, ${b})`,seek:(b,c=0)=>a`select lo_lseek64(${f}, ${b}, ${c})`,size:()=>a`
          select
            lo_lseek64(${f}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return d(g),new Promise(async a=>e=a);async function h({highWaterMark:a=16384,start:b=0,end:c=1/0}={}){let d=c-b;return b&&await g.seek(b),new bx.default.Readable({highWaterMark:a,async read(a){let b=a>d?a-d:a;d-=a;let[{data:c}]=await g.read(b);this.push(c),c.length<a&&this.push(null)}})}async function i({highWaterMark:a=16384,start:b=0}={}){return b&&await g.seek(b),new bx.default.Writable({highWaterMark:a,write(a,b,c){g.write(a).then(()=>c(),c)}})}}).catch(e)})}Object.assign(bW,{PostgresError:aS,toPascal:bl,pascal:bs,toCamel:bk,camel:br,toKebab:bm,kebab:bt,fromPascal:bo,fromCamel:bn,fromKebab:bp,BigInt:{to:20,from:[20],parse:a=>BigInt(a),serialize:a=>a.toString()}});let bV=bW;function bW(a,b){let c=function(a,b){var c;if(a&&a.shared)return a;let d=process.env,e=(a&&"string"!=typeof a?a:b)||{},{url:f,multihost:g}=function(a){if(!a||"string"!=typeof a)return{url:{searchParams:new Map}};let b=a;b=decodeURIComponent((b=b.slice(b.indexOf("://")+3).split(/[?/]/)[0]).slice(b.indexOf("@")+1));let c=new URL(a.replace(b,b.split(",")[0]));return{url:{username:decodeURIComponent(c.username),password:decodeURIComponent(c.password),host:c.host,hostname:c.hostname,port:c.port,pathname:c.pathname,searchParams:c.searchParams},multihost:b.indexOf(",")>-1&&b}}(a),h=[...f.searchParams].reduce((a,[b,c])=>(a[b]=c,a),{}),i=e.hostname||e.host||g||f.hostname||d.PGHOST||"localhost",j=e.port||f.port||d.PGPORT||5432,k=e.user||e.username||f.username||d.PGUSERNAME||d.PGUSER||function(){try{return aL.default.userInfo().username}catch(a){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}();e.no_prepare&&(e.prepare=!1),h.sslmode&&(h.ssl=h.sslmode,delete h.sslmode),"timeout"in e&&(console.log("The timeout option is deprecated, use idle_timeout instead"),e.idle_timeout=e.timeout),"system"===h.sslrootcert&&(h.ssl="verify-full");let l=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],m={max:globalThis.Cloudflare?3:10,ssl:!1,sslnegotiation:null,idle_timeout:null,connect_timeout:30,max_lifetime:bY,max_pipeline:100,backoff:bX,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(i)?i:i.split(",").map(a=>a.split(":")[0]),port:Array.isArray(j)?j:i.split(",").map(a=>parseInt(a.split(":")[1]||j)),path:e.path||i.indexOf("/")>-1&&i+"/.s.PGSQL."+j,database:e.database||e.db||(f.pathname||"").slice(1)||d.PGDATABASE||k,user:k,pass:e.pass||e.password||f.password||d.PGPASSWORD||"",...Object.entries(m).reduce((a,[b,c])=>{let f=b in e?e[b]:b in h?"disable"!==h[b]&&"false"!==h[b]&&h[b]:d["PG"+b.toUpperCase()]||c;return a[b]="string"==typeof f&&l.includes(b)?+f:f,a},{}),connection:{application_name:d.PGAPPNAME||"postgres.js",...e.connection,...Object.entries(h).reduce((a,[b,c])=>(b in m||(a[b]=c),a),{})},types:e.types||{},target_session_attrs:function(a,b,c){let d=a.target_session_attrs||b.searchParams.get("target_session_attrs")||c.PGTARGETSESSIONATTRS;if(!d||["read-write","read-only","primary","standby","prefer-standby"].includes(d))return d;throw Error("target_session_attrs "+d+" is not supported")}(e,f,d),onnotice:e.onnotice,onnotify:e.onnotify,onclose:e.onclose,onparameter:e.onparameter,socket:e.socket,transform:{undefined:(c=e.transform||{undefined:void 0}).undefined,column:{from:"function"==typeof c.column?c.column:c.column&&c.column.from,to:c.column&&c.column.to},value:{from:"function"==typeof c.value?c.value:c.value&&c.value.from,to:c.value&&c.value.to},row:{from:"function"==typeof c.row?c.row:c.row&&c.row.from,to:c.row&&c.row.to}},parameters:{},shared:{retries:0,typeArrayMap:{}},...bb(e.types)}}(a,b),d=c.no_subscribe||function(a,b){let c=new Map,d="postgresjs_"+Math.random().toString(36).slice(2),e={},f,g,h=!1,i=l.sql=a({...b,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...b.connection,replication:"database"},onclose:async function(){h||(g=null,e.pid=e.secret=void 0,m(await n(i,d,b.publications)),c.forEach(a=>a.forEach(({onsubscribe:a})=>a())))},no_subscribe:!0}),j=i.end,k=i.close;return i.end=async()=>(h=!0,g&&await new Promise(a=>(g.once("close",a),g.end())),j()),i.close=async()=>(g&&await new Promise(a=>(g.once("close",a),g.end())),k()),l;async function l(a,h,j=bS,k=bS){a=function(a){let[,b,c,d]=a.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];return(b||"*")+(c?":"+(-1===c.indexOf(".")?"public."+c:c):"")+(d?"="+d:"")}(a),f||(f=n(i,d,b.publications));let o={fn:h,onsubscribe:j},p=c.has(a)?c.get(a).add(o):c.set(a,new Set([o])).get(a),q=()=>{p.delete(o),0===p.size&&c.delete(a)};return f.then(a=>(m(a),j(),g&&g.on("error",k),{unsubscribe:q,state:e,sql:i}))}function m(a){g=a.stream,e.pid=a.state.pid,e.secret=a.state.secret}async function n(a,c,d){if(!d)throw Error("Missing publication names");let e=await a.unsafe(`CREATE_REPLICATION_SLOT ${c} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[f]=e,g=await a.unsafe(`START_REPLICATION SLOT ${c} LOGICAL ${f.consistent_point} (proto_version '1', publication_names '${d}')`).writable(),h={lsn:Buffer.concat(f.consistent_point.split("/").map(a=>Buffer.from(("00000000"+a).slice(-8),"hex")))};return g.on("data",function(c){var d,e,f,j,k;let l;119===c[0]?(d=c.subarray(25),e=h,f=a.options.parsers,j=i,k=b.transform,Object.entries({R:a=>{let b=1,c=e[a.readUInt32BE(b)]={schema:a.toString("utf8",b+=4,b=a.indexOf(0,b))||"pg_catalog",table:a.toString("utf8",b+1,b=a.indexOf(0,b+1)),columns:Array(a.readUInt16BE(b+=2)),keys:[]};b+=2;let d=0,g;for(;b<a.length;)(g=c.columns[d++]={key:a[b++],name:k.column.from?k.column.from(a.toString("utf8",b,b=a.indexOf(0,b))):a.toString("utf8",b,b=a.indexOf(0,b)),type:a.readUInt32BE(b+=1),parser:f[a.readUInt32BE(b)],atttypmod:a.readUInt32BE(b+=4)}).key&&c.keys.push(g),b+=4},Y:()=>{},O:()=>{},B:a=>{var b;b=a.readBigInt64BE(9),e.date=new Date(Date.UTC(2e3,0,1)+Number(b/BigInt(1e3))),e.lsn=a.subarray(1,9)},I:a=>{let b=1,c=e[a.readUInt32BE(b)],{row:d}=bT(a,c.columns,b+=7,k);j(d,{command:"insert",relation:c})},D:a=>{let b=1,c=e[a.readUInt32BE(b)],d=75===a[b+=4];j(d||79===a[b]?bT(a,c.columns,b+=3,k).row:null,{command:"delete",relation:c,key:d})},U:a=>{let b=1,c=e[a.readUInt32BE(b)],d=75===a[b+=4],f=d||79===a[b]?bT(a,c.columns,b+=3,k):null;f&&(b=f.i);let{row:g}=bT(a,c.columns,b+3,k);j(g,{command:"update",relation:c,key:d,old:f&&f.row})},T:()=>{},C:()=>{}}).reduce((a,[b,c])=>(a[b.charCodeAt(0)]=c,a),{})[d[0]](d)):107===c[0]&&c[17]&&(h.lsn=c.subarray(1,9),(l=Buffer.alloc(34))[0]=114,l.fill(h.lsn,1),l.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),g.write(l))}),g.on("error",function(a){console.error("Unexpected error during logical streaming - reconnecting",a)}),g.on("close",a.close),{stream:g,state:e.state};function i(a,b){let c=b.relation.schema+"."+b.relation.table;o("*",a,b),o("*:"+c,a,b),b.relation.keys.length&&o("*:"+c+"="+b.relation.keys.map(b=>a[b.name]),a,b),o(b.command,a,b),o(b.command+":"+c,a,b),b.relation.keys.length&&o(b.command+":"+c+"="+b.relation.keys.map(b=>a[b.name]),a,b)}}function o(a,b,d){c.has(a)&&c.get(a).forEach(({fn:c})=>c(b,d,a))}}(bW,{...c}),e=!1,f=bA(),g=bA(),h=bA(),i=bA(),j=bA(),k=bA(),l=bA(),m=bA(),n={connecting:g,reserved:h,closed:i,ended:j,open:k,busy:l,full:m},o=[...Array(c.max)].map(()=>bE(c,n,{onopen:E,onend:D,onclose:F})),p=q(function(a){return e?a.reject(aT("CONNECTION_ENDED",c,c)):k.length?x(k.shift(),a):i.length?C(i.shift(),a):void(l.length?x(l.shift(),a):f.push(a))});return Object.assign(p,{get parameters(){return c.parameters},largeObject:bU.bind(null,p),subscribe:d,CLOSE:aQ,END:aQ,PostgresError:aS,options:c,reserve:t,listen:r,begin:u,close:A,end:z}),p;function q(a){return a.debug=c.debug,Object.entries(c.types).reduce((a,[b,c])=>(a[b]=a=>new aZ(a,c.to),a),b),Object.assign(d,{types:b,typed:b,unsafe:function(b,c=[],d={}){return 2!=arguments.length||Array.isArray(c)||(d=c,c=[]),new aR([b],c,a,y,{prepare:!1,...d,simple:"simple"in d?d.simple:0===c.length})},notify:s,array:function a(b,d){return Array.isArray(b)?new aZ(b,d||(b.length?bf(b)||25:0),c.shared.typeArrayMap):a(Array.from(arguments))},json:w,file:function(b,c=[],d={}){return 2!=arguments.length||Array.isArray(c)||(d=c,c=[]),new aR([],c,c=>{aM.default.readFile(b,"utf8",(b,d)=>{if(b)return c.reject(b);c.strings=[d],a(c)})},y,{...d,simple:"simple"in d?d.simple:0===c.length})}}),d;function b(a,b){return new aZ(a,b)}function d(b,...e){return b&&Array.isArray(b.raw)?new aR(b,e,a,y):"string"!=typeof b||e.length?new a$(b,e):new aY(c.transform.column.to?c.transform.column.to(b):b)}}async function r(a,b,d){let e={fn:b,onlisten:d},f=r.sql||(r.sql=bW({...c,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(r.channels).forEach(([a,{listeners:b}])=>{delete r.channels[a],Promise.all(b.map(b=>r(a,b.fn,b.onlisten).catch(()=>{})))})},onnotify(a,b){a in r.channels&&r.channels[a].listeners.forEach(a=>a.fn(b))}})),g=r.channels||(r.channels={});if(a in g){g[a].listeners.push(e);let b=await g[a].result;return e.onlisten&&e.onlisten(),{state:b.state,unlisten:i}}g[a]={result:f`listen ${f.unsafe('"'+a.replace(/"/g,'""')+'"')}`,listeners:[e]};let h=await g[a].result;return e.onlisten&&e.onlisten(),{state:h.state,unlisten:i};async function i(){if(a in g!=!1&&(g[a].listeners=g[a].listeners.filter(a=>a!==e),!g[a].listeners.length))return delete g[a],f`unlisten ${f.unsafe('"'+a.replace(/"/g,'""')+'"')}`}}async function s(a,b){return await p`select pg_notify(${a}, ${""+b})`}async function t(){let a=bA(),b=k.length?k.shift():await new Promise((a,b)=>{let c={reserve:a,reject:b};f.push(c),i.length&&C(i.shift(),c)});v(b,h),b.reserved=()=>a.length?b.execute(a.shift()):v(b,h),b.reserved.release=!0;let c=q(function(c){b.queue===m?a.push(c):b.execute(c)||v(b,m)});return c.release=()=>{b.reserved=null,E(b)},c}async function u(a,b){b||(b=a,a="");let c=bA(),d=0,e,f=null;try{return await p.unsafe("begin "+a.replace(/[^a-z ]/ig,""),[],{onexecute:function(a){e=a,v(a,h),a.reserved=()=>c.length?a.execute(c.shift()):v(a,h)}}).execute(),await Promise.race([g(e,b),new Promise((a,b)=>e.onclose=b)])}catch(a){throw a}async function g(a,b,e){let h,i,j=q(function(b){b.catch(a=>h||(h=a)),a.queue===m?c.push(b):a.execute(b)||v(a,m)});j.savepoint=function b(c,e){return c&&Array.isArray(c.raw)?b(a=>a.apply(a,arguments)):(1==arguments.length&&(e=c,c=null),g(a,e,"s"+d+++(c?"_"+c:"")))},j.prepare=a=>f=a.replace(/[^a-z0-9$-_. ]/gi),e&&await j`savepoint ${j(e)}`;try{if(i=await new Promise((a,c)=>{let d=b(j);Promise.resolve(Array.isArray(d)?Promise.all(d):d).then(a,c)}),h)throw h}catch(a){throw await (e?j`rollback to ${j(e)}`:j`rollback`),a instanceof aS&&"25P02"===a.code&&h||a}return e||(f?await j`prepare transaction '${j.unsafe(f)}'`:await j`commit`),i}}function v(a,b){return a.queue.remove(a),b.push(a),a.queue=b,b===k?a.idleTimer.start():a.idleTimer.cancel(),a}function w(a){return new aZ(a,3802)}function x(a,b){return a.execute(b)?v(a,l):v(a,m)}function y(a){return new Promise((b,d)=>{a.state?a.active?bE(c).cancel(a.state,b,d):a.cancelled={resolve:b,reject:d}:(f.remove(a),a.cancelled=!0,a.reject(aV("57014","canceling statement due to user request")),b())})}async function z({timeout:a=null}={}){let b;return e||(await 1,e=Promise.race([new Promise(c=>null!==a&&(b=setTimeout(B,1e3*a,c))),Promise.all(o.map(a=>a.end()).concat(r.sql?r.sql.end({timeout:0}):[],d.sql?d.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(b)))}async function A(){await Promise.all(o.map(a=>a.end()))}async function B(a){for(await Promise.all(o.map(a=>a.terminate()));f.length;)f.shift().reject(aT("CONNECTION_DESTROYED",c));a()}function C(a,b){return v(a,g),a.connect(b),a}function D(a){v(a,j)}function E(a){if(0===f.length)return v(a,k);let b=Math.ceil(f.length/(g.length+1)),c=!0;for(;c&&f.length&&b-- >0;){let b=f.shift();if(b.reserve)return b.reserve(a);c=a.execute(b)}c?v(a,l):v(a,m)}function F(a,b){v(a,i),a.reserved=null,a.onclose&&(a.onclose(b),a.onclose=null),c.onclose&&c.onclose(a.id),f.length&&C(a,f.shift())}}function bX(a){return(.5+Math.random()/2)*Math.min(3**a/100,20)}function bY(){return 60*(30+30*Math.random())}a.s(["default",0,bV],19569);class bZ{static [d]="ConsoleLogWriter";write(a){console.log(a)}}class b${static [d]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new bZ}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class b_{static [d]="NoopLogger";logQuery(){}}class b0{static [d]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}class b1{constructor(a){this.table=a}static [d]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class b2{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [d]="TableAliasProxyHandler";get(a,b){if(b===p.Symbol.IsAlias)return!0;if(b===p.Symbol.Name||this.replaceOriginalName&&b===p.Symbol.OriginalName)return this.alias;if(b===U)return{...a[U],name:this.alias,isAlias:!0};if(b===p.Symbol.Columns){let b=a[p.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new b1(new Proxy(a,this)))}),c}let c=a[b];return e(c,f)?new Proxy(c,new b1(new Proxy(a,this))):c}}class b3{constructor(a){this.alias=a}static [d]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?b4(a.sourceTable,this.alias):a[b]}}function b4(a,b){return new Proxy(a,new b2(b,!1))}function b5(a,b){return new Proxy(a,new b1(new Proxy(a.table,new b2(b,!1))))}function b6(a,b){return new Y.Aliased(b7(a.sql,b),a.fieldAlias)}function b7(a,b){return ac.join(a.queryChunks.map(a=>e(a,f)?b5(a,b):e(a,Y)?b7(a,b):e(a,Y.Aliased)?b6(a,b):a))}class b8{static [d]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===U)return{...a[U],selectedFields:new Proxy(a[U].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=(e(a,R)?a._.selectedFields:e(a,ao)?a[U].selectedFields:a)[b];if(e(c,Y.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if(e(c,Y)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return e(c,f)?this.config.alias?new Proxy(c,new b1(new Proxy(c.table,new b2(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new b8(this.config))}}function b9(a,b){return Object.entries(a).reduce((a,[c,d])=>{if("string"!=typeof c)return a;let g=b?[...b,c]:[c];return e(d,f)||e(d,Y)||e(d,Y.Aliased)||e(d,R)?a.push({path:g,field:d}):e(d,p)?a.push(...b9(d[p.Symbol.Columns],g)):a.push(...b9(d,g)),a},[])}function ca(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function cb(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>e(c,Y)||e(c,f)?[b,c]:[b,new ab(c,a[p.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function cc(a){return a[p.Symbol.Columns]}function cd(a){return e(a,R)?a._.alias:e(a,ao)?a[U].name:e(a,Y)?void 0:a[p.Symbol.IsAlias]?a[p.Symbol.Name]:a[p.Symbol.BaseName]}function ce(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}"undefined"==typeof TextDecoder||new TextDecoder;class cf extends C{static [d]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class cg extends cf{static [d]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new ch(a,this.config)}}class ch extends D{static [d]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class ci extends cf{static [d]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new cj(a,this.config)}}class cj extends D{static [d]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}function ck(a,b){let{name:c,config:d}=ce(a,b);return"number"===d.mode?new cg(c):new ci(c)}class cl extends C{static [d]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new cm(a,this.config)}}class cm extends D{static [d]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class cn extends C{static [d]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new co(a,this.config)}}class co extends D{static [d]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}function cp(a,b){let{name:c,config:d}=ce(a,b);return"number"===d.mode?new cl(c):new cn(c)}a.s(["bigserial",()=>cp],90661);class cq extends C{static [d]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new cr(a,this.config)}}class cr extends D{static [d]="PgBoolean";getSQLType(){return"boolean"}}function cs(a){return new cq(a??"")}a.s(["boolean",()=>cs],11439);class ct extends C{static [d]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new cu(a,this.config)}}class cu extends D{static [d]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function cv(a,b={}){let{name:c,config:d}=ce(a,b);return new ct(c,d)}class cw extends C{static [d]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new cx(a,this.config)}}class cx extends D{static [d]="PgCidr";getSQLType(){return"cidr"}}function cy(a){return new cw(a??"")}class cz extends C{static [d]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new cA(a,this.config)}}class cA extends D{static [d]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function cB(a){return(b,c)=>{let{name:d,config:e}=ce(b,c);return new cz(d,e,a)}}class cC extends C{static [d]="PgDateColumnBaseBuilder";defaultNow(){return this.default(ac`now()`)}}class cD extends cC{static [d]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new cE(a,this.config)}}class cE extends D{static [d]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?new Date(a):a}mapToDriverValue(a){return a.toISOString()}}class cF extends cC{static [d]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new cG(a,this.config)}}class cG extends D{static [d]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?a:a.toISOString().slice(0,-14)}}function cH(a,b){let{name:c,config:d}=ce(a,b);return d?.mode==="date"?new cD(c):new cF(c)}a.s(["PgDate",()=>cE,"PgDateString",()=>cG,"date",()=>cH],37525);class cI extends C{static [d]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new cJ(a,this.config)}}class cJ extends D{static [d]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}function cK(a){return new cI(a??"")}a.s(["doublePrecision",()=>cK],37756);class cL extends C{static [d]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new cM(a,this.config)}}class cM extends D{static [d]="PgInet";getSQLType(){return"inet"}}function cN(a){return new cL(a??"")}class cO extends cf{static [d]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new cP(a,this.config)}}class cP extends D{static [d]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}function cQ(a){return new cO(a??"")}a.s(["integer",()=>cQ],68784);class cR extends C{static [d]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new cS(a,this.config)}}class cS extends D{static [d]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}function cT(a,b={}){let{name:c,config:d}=ce(a,b);return new cR(c,d)}class cU extends C{static [d]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new cV(a,this.config)}}class cV extends D{static [d]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function cW(a){return new cU(a??"")}class cX extends C{static [d]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new cY(a,this.config)}}class cY extends D{static [d]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function cZ(a){return new cX(a??"")}a.s(["PgJsonb",()=>cY,"jsonb",()=>cZ],78345);class c$ extends C{static [d]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new c_(a,this.config)}}class c_ extends D{static [d]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class c0 extends C{static [d]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new c1(a,this.config)}}class c1 extends D{static [d]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}function c2(a,b){let{name:c,config:d}=ce(a,b);return d?.mode&&"tuple"!==d.mode?new c0(c):new c$(c)}class c3 extends C{static [d]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new c4(a,this.config)}}class c4 extends D{static [d]="PgMacaddr";getSQLType(){return"macaddr"}}function c5(a){return new c3(a??"")}class c6 extends C{static [d]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new c7(a,this.config)}}class c7 extends D{static [d]="PgMacaddr8";getSQLType(){return"macaddr8"}}function c8(a){return new c6(a??"")}class c9 extends C{static [d]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new da(a,this.config)}}class da extends D{static [d]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class db extends C{static [d]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new dc(a,this.config)}}class dc extends D{static [d]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class dd extends C{static [d]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new de(a,this.config)}}class de extends D{static [d]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function df(a,b){let{name:c,config:d}=ce(a,b),e=d?.mode;return"number"===e?new db(c,d?.precision,d?.scale):"bigint"===e?new dd(c,d?.precision,d?.scale):new c9(c,d?.precision,d?.scale)}class dg extends C{static [d]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new dh(a,this.config)}}class dh extends D{static [d]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class di extends C{static [d]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new dj(a,this.config)}}class dj extends D{static [d]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function dk(a,b){let{name:c,config:d}=ce(a,b);return d?.mode&&"tuple"!==d.mode?new di(c):new dg(c)}function dl(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function dm(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=dl(b,c),d=dl(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class dn extends C{static [d]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new dp(a,this.config)}}class dp extends D{static [d]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return dm(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class dq extends C{static [d]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new dr(a,this.config)}}class dr extends D{static [d]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=dm(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}function ds(a,b){let{name:c,config:d}=ce(a,b);return d?.mode&&"tuple"!==d.mode?new dq(c):new dn(c)}class dt extends C{static [d]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new du(a,this.config)}}class du extends D{static [d]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}function dv(a){return new dt(a??"")}a.s(["real",()=>dv],55233);class dw extends C{static [d]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new dx(a,this.config)}}class dx extends D{static [d]="PgSerial";getSQLType(){return"serial"}}function dy(a){return new dw(a??"")}a.s(["serial",()=>dy],68773);class dz extends cf{static [d]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new dA(a,this.config)}}class dA extends D{static [d]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}function dB(a){return new dz(a??"")}a.s(["smallint",()=>dB],53043);class dC extends C{static [d]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new dD(a,this.config)}}class dD extends D{static [d]="PgSmallSerial";getSQLType(){return"smallserial"}}function dE(a){return new dC(a??"")}a.s(["smallserial",()=>dE],77856);class dF extends C{static [d]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new dG(a,this.config)}}class dG extends D{static [d]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function dH(a,b={}){let{name:c,config:d}=ce(a,b);return new dF(c,d)}a.s(["text",()=>dH],31535);class dI extends cC{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [d]="PgTimeBuilder";build(a){return new dJ(a,this.config)}}class dJ extends D{static [d]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}function dK(a,b={}){let{name:c,config:d}=ce(a,b);return new dI(c,d.withTimezone??!1,d.precision)}class dL extends cC{static [d]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new dM(a,this.config)}}class dM extends D{static [d]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){return"string"==typeof a?new Date(this.withTimezone?a:a+"+0000"):a}mapToDriverValue=a=>a.toISOString()}class dN extends cC{static [d]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new dO(a,this.config)}}class dO extends D{static [d]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){if("string"==typeof a)return a;let b=a.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let c=a.getTimezoneOffset();return`${b}${c<=0?"+":"-"}${Math.floor(Math.abs(c)/60).toString().padStart(2,"0")}`}return b}}function dP(a,b={}){let{name:c,config:d}=ce(a,b);return d?.mode==="string"?new dN(c,d.withTimezone??!1,d.precision):new dL(c,d?.withTimezone??!1,d?.precision)}a.s(["PgTimestamp",()=>dM,"PgTimestampString",()=>dO,"timestamp",()=>dP],15221);class dQ extends C{static [d]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default(ac`gen_random_uuid()`)}build(a){return new dR(a,this.config)}}class dR extends D{static [d]="PgUUID";getSQLType(){return"uuid"}}function dS(a){return new dQ(a??"")}a.s(["PgUUID",()=>dR,"uuid",()=>dS],37361);class dT extends C{static [d]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new dU(a,this.config)}}class dU extends D{static [d]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function dV(a,b={}){let{name:c,config:d}=ce(a,b);return new dT(c,d)}a.s(["varchar",()=>dV],28235);class dW extends C{static [d]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new dX(a,this.config)}}class dX extends D{static [d]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function dY(a,b){let{name:c,config:d}=ce(a,b);return new dW(c,d)}class dZ extends C{static [d]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new d$(a,this.config)}}class d$ extends D{static [d]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function d_(a,b){let{name:c,config:d}=ce(a,b);return new dZ(c,d)}class d0 extends C{static [d]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new d1(a,this.config)}}class d1 extends D{static [d]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function d2(a,b){let{name:c,config:d}=ce(a,b);return new d0(c,d)}class d3 extends C{static [d]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new d4(a,this.config)}}class d4 extends D{static [d]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function d5(a,b){let{name:c,config:d}=ce(a,b);return new d3(c,d)}let d6=Symbol.for("drizzle:PgInlineForeignKeys"),d7=Symbol.for("drizzle:EnableRLS");class d8 extends p{static [d]="PgTable";static Symbol=Object.assign({},p.Symbol,{InlineForeignKeys:d6,EnableRLS:d7});[d6]=[];[d7]=!1;[p.Symbol.ExtraConfigBuilder]=void 0;[p.Symbol.ExtraConfigColumns]={}}function d9(a,b,c,d,e=a){let f=new d8(a,d,e),g="function"==typeof b?b({bigint:ck,bigserial:cp,boolean:cs,char:cv,cidr:cy,customType:cB,date:cH,doublePrecision:cK,inet:cN,integer:cQ,interval:cT,json:cW,jsonb:cZ,line:c2,macaddr:c5,macaddr8:c8,numeric:df,point:dk,geometry:ds,real:dv,serial:dy,smallint:dB,smallserial:dE,text:dH,time:dK,timestamp:dP,uuid:dS,varchar:dV,bit:dY,halfvec:d_,sparsevec:d2,vector:d5}):b,h=Object.fromEntries(Object.entries(g).map(([a,b])=>{b.setName(a);let c=b.build(f);return f[d6].push(...b.buildForeignKeys(c,f)),[a,c]})),i=Object.fromEntries(Object.entries(g).map(([a,b])=>(b.setName(a),[a,b.buildExtraConfigColumn(f)]))),j=Object.assign(f,h);return j[p.Symbol.Columns]=h,j[p.Symbol.ExtraConfigColumns]=i,c&&(j[d8.Symbol.ExtraConfigBuilder]=c),Object.assign(j,{enableRLS:()=>(j[d8.Symbol.EnableRLS]=!0,j)})}let ea=(a,b,c)=>d9(a,b,c,void 0);a.s(["PgTable",()=>d8,"pgTable",()=>ea,"pgTableWithSchema",()=>d9],87451);class eb{constructor(a,b){this.name=a,this.value=b}static [d]="PgCheckBuilder";brand;build(a){return new ec(a,this)}}class ec{constructor(a,b){this.table=a,this.name=b.name,this.value=b.value}static [d]="PgCheck";name;value}class ed{constructor(a,b){this.unique=a,this.name=b}static [d]="PgIndexBuilderOn";on(...a){return new ee(a.map(a=>{if(e(a,Y))return a;let b=new F(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=JSON.parse(JSON.stringify(a.defaultConfig)),b}),this.unique,!1,this.name)}onOnly(...a){return new ee(a.map(a=>{if(e(a,Y))return a;let b=new F(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=a.defaultConfig,b}),this.unique,!0,this.name)}using(a,...b){return new ee(b.map(a=>{if(e(a,Y))return a;let b=new F(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=JSON.parse(JSON.stringify(a.defaultConfig)),b}),this.unique,!0,this.name,a)}}class ee{static [d]="PgIndexBuilder";config;constructor(a,b,c,d,e="btree"){this.config={name:d,columns:a,unique:b,only:c,method:e}}concurrently(){return this.config.concurrently=!0,this}with(a){return this.config.with=a,this}where(a){return this.config.where=a,this}build(a){return new ef(this.config,a)}}class ef{static [d]="PgIndex";config;constructor(a,b){this.config={...a,table:b}}}function eg(a){return new ed(!1,a)}a.s(["IndexBuilder",()=>ee,"index",()=>eg],14009);class eh{constructor(a,b){this.name=a,b&&(this.as=b.as,this.for=b.for,this.to=b.to,this.using=b.using,this.withCheck=b.withCheck)}static [d]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(a){return this._linkedTable=a,this}}function ei(a,b){return new eh(a,b)}a.s(["PgPolicy",()=>eh,"pgPolicy",()=>ei],46240);class ej{static [d]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new ek(a,this.columns,this.name)}}class ek{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [d]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[d8.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}let el=Symbol.for("drizzle:PgViewConfig");function em(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function en(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function eo(a){return a}a.s(["PgMaterializedViewConfig",()=>e0,"pgMaterializedViewWithSchema",()=>e3,"pgViewWithSchema",()=>e2],27270);class ep{static [d]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?em:"camelCase"===a?en:eo}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[p.Symbol.Schema]??"public",c=a.table[p.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[p.Symbol.Schema]??"public",c=a[p.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[p.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class eq extends Error{static [d]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class er extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,er),c&&(this.cause=c)}}class es extends eq{static [d]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}function et(a){return ac`${a} asc`}function eu(a){return ac`${a} desc`}a.s(["asc",()=>et,"desc",()=>eu],12401);class ev{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[p.Symbol.Name]}static [d]="Relation";referencedTableName;fieldName}class ew{constructor(a,b){this.table=a,this.config=b}static [d]="Relations"}class ex extends ev{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [d]="One";withFieldName(a){let b=new ex(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class ey extends ev{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [d]="Many";withFieldName(a){let b=new ey(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function ez(){return{and:as,between:aF,eq:aq,exists:aD,gt:av,gte:aw,ilike:aJ,inArray:az,isNull:aB,isNotNull:aC,like:aH,lt:ax,lte:ay,ne:ar,not:au,notBetween:aG,notExists:aE,notLike:aI,notIlike:aK,notInArray:aA,or:at,sql:ac}}function eA(){return{sql:ac,asc:et,desc:eu}}function eB(a,b){1===Object.keys(a).length&&"default"in a&&!e(a.default,p)&&(a=a.default);let c={},d={},f={};for(let[g,h]of Object.entries(a))if(e(h,p)){let a=q(h),b=d[a];for(let d of(c[a]=g,f[g]={tsName:g,dbName:h[p.Symbol.Name],schema:h[p.Symbol.Schema],columns:h[p.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(h[p.Symbol.Columns])))d.primary&&f[g].primaryKey.push(d);let i=h[p.Symbol.ExtraConfigBuilder]?.(h[p.Symbol.ExtraConfigColumns]);if(i)for(let a of Object.values(i))e(a,ej)&&f[g].primaryKey.push(...a.columns)}else if(e(h,ew)){let a,e=q(h.table),g=c[e];for(let[c,i]of Object.entries(h.config(b(h.table))))if(g){let b=f[g];b.relations[c]=i,a&&b.primaryKey.push(...a)}else e in d||(d[e]={relations:{},primaryKey:a}),d[e].relations[c]=i}return{tables:f,tableNamesMap:c}}function eC(a,b){return new ew(a,a=>Object.fromEntries(Object.entries(b(a)).map(([a,b])=>[a,b.withFieldName(a)])))}function eD(a,b,c){if(e(c,ex)&&c.config)return{fields:c.config.fields,references:c.config.references};let d=b[q(c.referencedTable)];if(!d)throw Error(`Table "${c.referencedTable[p.Symbol.Name]}" not found in schema`);let f=a[d];if(!f)throw Error(`Table "${d}" not found in schema`);let g=c.sourceTable,h=b[q(g)];if(!h)throw Error(`Table "${g[p.Symbol.Name]}" not found in schema`);let i=[];for(let a of Object.values(f.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&i.push(a);if(i.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${d}"`):Error(`There are multiple relations between "${d}" and "${c.sourceTable[p.Symbol.Name]}". Please specify relation name`);if(i[0]&&e(i[0],ex)&&i[0].config)return{fields:i[0].config.references,references:i[0].config.fields};throw Error(`There is not enough information to infer relation "${h}.${c.fieldName}"`)}function eE(a){return{one:function(b,c){return new ex(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new ey(a,b,c)}}}function eF(a,b,c,d,g=a=>a){let h={};for(let[i,j]of d.entries())if(j.isJson){let d=b.relations[j.tsKey],f=c[i],k="string"==typeof f?JSON.parse(f):f;h[j.tsKey]=e(d,ex)?k&&eF(a,a[j.relationTableTsKey],k,j.selection,g):k.map(b=>eF(a,a[j.relationTableTsKey],b,j.selection,g))}else{let a,b=g(c[i]),d=j.field;a=e(d,f)?d:e(d,Y)?d.decoder:d.sql.decoder,h[j.tsKey]=null===b?null:a.mapFromDriverValue(b)}return h}a.s(["Many",()=>ey,"One",()=>ex,"createTableRelationsHelpers",()=>eE,"extractTablesRelationalConfig",()=>eB,"getOperators",()=>ez,"getOrderByOperators",()=>eA,"mapRelationalRow",()=>eF,"normalizeRelation",()=>eD,"relations",()=>eC],31240);class eG extends ao{static [d]="PgViewBase"}class eH{static [d]="PgDialect";casing;constructor(a){this.casing=new ep(a?.casing)}async migrate(a,b,c){let d="string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e="string"==typeof c?"drizzle":c.migrationsSchema??"drizzle",f=ac`
			CREATE TABLE IF NOT EXISTS ${ac.identifier(e)}.${ac.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await b.execute(ac`CREATE SCHEMA IF NOT EXISTS ${ac.identifier(e)}`),await b.execute(f);let g=(await b.all(ac`select id, hash, created_at from ${ac.identifier(e)}.${ac.identifier(d)} order by created_at desc limit 1`))[0];await b.transaction(async b=>{for await(let c of a)if(!g||Number(g.created_at)<c.folderMillis){for(let a of c.sql)await b.execute(ac.raw(a));await b.execute(ac`insert into ${ac.identifier(e)}.${ac.identifier(d)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(a){return`"${a}"`}escapeParam(a){return`$${a+1}`}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[ac`with `];for(let[c,d]of a.entries())b.push(ac`${ac.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push(ac`, `);return b.push(ac` `),ac.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d}){let e=this.buildWithCTE(d),f=c?ac` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,g=b?ac` where ${b}`:void 0;return ac`${e}delete from ${a}${g}${f}`}buildUpdateSet(a,b){let c=a[p.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),f=d.length;return ac.join(d.flatMap((a,d)=>{let g=c[a],h=g.onUpdateFn?.(),i=b[a]??(e(h,Y)?h:ac.param(h,g)),j=ac`${ac.identifier(this.casing.getColumnCasing(g))} = ${i}`;return d<f-1?[j,ac.raw(", ")]:[j]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,from:f,joins:g}){let h=this.buildWithCTE(e),i=a[d8.Symbol.Name],j=a[d8.Symbol.Schema],k=a[d8.Symbol.OriginalName],l=i===k?void 0:i,m=ac`${j?ac`${ac.identifier(j)}.`:void 0}${ac.identifier(k)}${l&&ac` ${ac.identifier(l)}`}`,n=this.buildUpdateSet(a,b),o=f&&ac.join([ac.raw(" from "),this.buildFromTable(f)]),p=this.buildJoins(g),q=d?ac` returning ${this.buildSelection(d,{isSingleTable:!f})}`:void 0,r=c?ac` where ${c}`:void 0;return ac`${h}update ${m} set ${n}${o}${p}${r}${q}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let g=[];if(e(a,Y.Aliased)&&a.isSelectionField)g.push(ac.identifier(a.fieldAlias));else if(e(a,Y.Aliased)||e(a,Y)){let c=e(a,Y.Aliased)?a.sql:a;b?g.push(new Y(c.queryChunks.map(a=>e(a,D)?ac.identifier(this.casing.getColumnCasing(a)):a))):g.push(c),e(a,Y.Aliased)&&g.push(ac` as ${ac.identifier(a.fieldAlias)}`)}else if(e(a,f))b?g.push(ac.identifier(this.casing.getColumnCasing(a))):g.push(a);else if(e(a,R)){let b=Object.entries(a._.selectedFields);if(1===b.length){let c=b[0][1],d=e(c,Y)?c.decoder:e(c,f)?{mapFromDriverValue:a=>c.mapFromDriverValue(a)}:c.sql.decoder;d&&(a._.sql.decoder=d)}g.push(a)}return d<c-1&&g.push(ac`, `),g});return ac.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];for(let[c,d]of a.entries()){0===c&&b.push(ac` `);let f=d.table,g=d.lateral?ac` lateral`:void 0,h=d.on?ac` on ${d.on}`:void 0;if(e(f,d8)){let a=f[d8.Symbol.Name],c=f[d8.Symbol.Schema],e=f[d8.Symbol.OriginalName],i=a===e?void 0:d.alias;b.push(ac`${ac.raw(d.joinType)} join${g} ${c?ac`${ac.identifier(c)}.`:void 0}${ac.identifier(e)}${i&&ac` ${ac.identifier(i)}`}${h}`)}else if(e(f,ao)){let a=f[U].name,c=f[U].schema,e=f[U].originalName,i=a===e?void 0:d.alias;b.push(ac`${ac.raw(d.joinType)} join${g} ${c?ac`${ac.identifier(c)}.`:void 0}${ac.identifier(e)}${i&&ac` ${ac.identifier(i)}`}${h}`)}else b.push(ac`${ac.raw(d.joinType)} join${g} ${f}${h}`);c<a.length-1&&b.push(ac` `)}return ac.join(b)}buildFromTable(a){if(e(a,p)&&a[p.Symbol.IsAlias]){let b=ac`${ac.identifier(a[p.Symbol.OriginalName])}`;return a[p.Symbol.Schema]&&(b=ac`${ac.identifier(a[p.Symbol.Schema])}.${b}`),ac`${b} ${ac.identifier(a[p.Symbol.Name])}`}return a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:h,table:i,joins:j,orderBy:k,groupBy:l,limit:m,offset:n,lockingClause:o,distinct:q,setOperators:r}){let s,t,u,v=c??b9(b);for(let a of v){let b;if(e(a.field,f)&&a.field.table[g]!==(e(i,R)?i._.alias:e(i,eG)?i[U].name:e(i,Y)?void 0:i[g])&&(b=a.field.table,!j?.some(({alias:a})=>a===(b[p.Symbol.IsAlias]?b[g]:b[p.Symbol.BaseName])))){let b=a.field.table[g];throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let w=!j||0===j.length,x=this.buildWithCTE(a);q&&(s=!0===q?ac` distinct`:ac` distinct on (${ac.join(q.on,ac`, `)})`);let y=this.buildSelection(v,{isSingleTable:w}),z=this.buildFromTable(i),A=this.buildJoins(j),B=d?ac` where ${d}`:void 0,C=h?ac` having ${h}`:void 0;k&&k.length>0&&(t=ac` order by ${ac.join(k,ac`, `)}`),l&&l.length>0&&(u=ac` group by ${ac.join(l,ac`, `)}`);let D="object"==typeof m||"number"==typeof m&&m>=0?ac` limit ${m}`:void 0,E=n?ac` offset ${n}`:void 0,F=ac.empty();if(o){let a=ac` for ${ac.raw(o.strength)}`;o.config.of&&a.append(ac` of ${ac.join(Array.isArray(o.config.of)?o.config.of:[o.config.of],ac`, `)}`),o.config.noWait?a.append(ac` nowait`):o.config.skipLocked&&a.append(ac` skip locked`),F.append(a)}let G=ac`${x}select${s} ${y} from ${z}${A}${B}${u}${C}${t}${D}${E}${F}`;return r.length>0?this.buildSetOperations(G,r):G}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:f,orderBy:g,offset:h}}){let i,j=ac`(${a.getSQL()}) `,k=ac`(${d.getSQL()})`;if(g&&g.length>0){let a=[];for(let b of g)if(e(b,D))a.push(ac.identifier(b.name));else if(e(b,Y)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];e(c,D)&&(b.queryChunks[a]=ac.identifier(c.name))}a.push(ac`${b}`)}else a.push(ac`${b}`);i=ac` order by ${ac.join(a,ac`, `)} `}let l="object"==typeof f||"number"==typeof f&&f>=0?ac` limit ${f}`:void 0,m=ac.raw(`${b} ${c?"all ":""}`),n=h?ac` offset ${h}`:void 0;return ac`${j}${m}${k}${i}${l}${n}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:f,select:g,overridingSystemValue_:h}){let i=[],j=Object.entries(a[p.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),k=j.map(([,a])=>ac.identifier(this.casing.getColumnCasing(a)));if(g)e(b,Y)?i.push(b):i.push(b.getSQL());else for(let[a,c]of(i.push(ac.raw("values ")),b.entries())){let d=[];for(let[a,b]of j){let f=c[a];if(void 0===f||e(f,ab)&&void 0===f.value)if(void 0!==b.defaultFn){let a=b.defaultFn(),c=e(a,Y)?a:ac.param(a,b);d.push(c)}else if(b.default||void 0===b.onUpdateFn)d.push(ac`default`);else{let a=b.onUpdateFn(),c=e(a,Y)?a:ac.param(a,b);d.push(c)}else d.push(f)}i.push(d),a<b.length-1&&i.push(ac`, `)}let l=this.buildWithCTE(f),m=ac.join(i),n=d?ac` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,o=c?ac` on conflict ${c}`:void 0,q=!0===h?ac`overriding system value `:void 0;return ac`${l}insert into ${a} ${k} ${q}${m}${o}${n}`}buildRefreshMaterializedViewQuery({view:a,concurrently:b,withNoData:c}){let d=b?ac` concurrently`:void 0,e=c?ac` with no data`:void 0;return ac`refresh materialized view${d} ${a}${e}`}prepareTyping(a){if(e(a,cY)||e(a,cV))return"json";if(e(a,da))return"decimal";if(e(a,dJ))return"time";if(e(a,dM)||e(a,dO))return"timestamp";if(e(a,cE)||e(a,cG))return"date";else if(e(a,dR))return"uuid";else return"none"}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:b})}buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:g,queryConfig:h,tableAlias:i,nestedQueryRelation:j,joinOn:k}){let l,m=[],n,o,p=[],r,s=[];if(!0===h)m=Object.entries(g.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:b5(b,i),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(g.columns).map(([a,b])=>[a,b5(b,i)]));if(h.where){let a="function"==typeof h.where?h.where(d,ez()):h.where;r=a&&b7(a,i)}let j=[],k=[];if(h.columns){let a=!1;for(let[b,c]of Object.entries(h.columns))void 0!==c&&b in g.columns&&(a||!0!==c||(a=!0),k.push(b));k.length>0&&(k=a?k.filter(a=>h.columns?.[a]===!0):Object.keys(g.columns).filter(a=>!k.includes(a)))}else k=Object.keys(g.columns);for(let a of k){let b=g.columns[a];j.push({tsKey:a,value:b})}let l=[];if(h.with&&(l=Object.entries(h.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:g.relations[a]}))),h.extras)for(let[a,b]of Object.entries("function"==typeof h.extras?h.extras(d,{sql:ac}):h.extras))j.push({tsKey:a,value:b6(b,i)});for(let{tsKey:a,value:b}of j)m.push({dbKey:e(b,Y.Aliased)?b.fieldAlias:g.columns[a].name,tsKey:a,field:e(b,f)?b5(b,i):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let t="function"==typeof h.orderBy?h.orderBy(d,eA()):h.orderBy??[];for(let{tsKey:d,queryConfig:g,relation:j}of(Array.isArray(t)||(t=[t]),p=t.map(a=>e(a,f)?b5(a,i):b7(a,i)),n=h.limit,o=h.offset,l)){let f=eD(b,c,j),h=c[q(j.referencedTable)],k=`${i}_${d}`,l=as(...f.fields.map((a,b)=>aq(b5(f.references[b],k),b5(a,i)))),n=this.buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:a[h],tableConfig:b[h],queryConfig:e(j,ex)?!0===g?{limit:1}:{...g,limit:1}:g,tableAlias:k,joinOn:l,nestedQueryRelation:j}),o=ac`${ac.identifier(k)}.${ac.identifier("data")}`.as(d);s.push({on:ac`true`,table:new R(n.sql,{},k),alias:k,joinType:"left",lateral:!0}),m.push({dbKey:d,tsKey:d,field:o,relationTableTsKey:h,isJson:!0,selection:n.selection})}}if(0===m.length)throw new eq({message:`No fields selected for table "${g.tsName}" ("${i}")`});if(r=as(k,r),j){let a=ac`json_build_array(${ac.join(m.map(({field:a,tsKey:b,isJson:c})=>c?ac`${ac.identifier(`${i}_${b}`)}.${ac.identifier("data")}`:e(a,Y.Aliased)?a.sql:a),ac`, `)})`;e(j,ey)&&(a=ac`coalesce(json_agg(${a}${p.length>0?ac` order by ${ac.join(p,ac`, `)}`:void 0}), '[]'::json)`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:g.tsName,selection:m}];void 0!==n||void 0!==o||p.length>0?(l=this.buildSelectQuery({table:b4(d,i),fields:{},fieldsFlat:[{path:[],field:ac.raw("*")}],where:r,limit:n,offset:o,orderBy:p,setOperators:[]}),r=void 0,n=void 0,o=void 0,p=[]):l=b4(d,i),l=this.buildSelectQuery({table:e(l,d8)?l:new R(l,{},i),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:e(a,f)?b5(a,i):a})),joins:s,where:r,limit:n,offset:o,orderBy:p,setOperators:[]})}else l=this.buildSelectQuery({table:b4(d,i),fields:{},fieldsFlat:m.map(({field:a})=>({path:[],field:e(a,f)?b5(a,i):a})),joins:s,where:r,limit:n,offset:o,orderBy:p,setOperators:[]});return{tableTsKey:g.tsName,sql:l,selection:m}}}class eI{static [d]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class eJ{static [d]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,a.withList&&(this.withList=a.withList),this.distinct=a.distinct}authToken;setToken(a){return this.authToken=a,this}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:e(a,R)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):e(a,eG)?a[U].selectedFields:e(a,Y)?{}:cc(a),new eL({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class eK extends eI{static [d]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(const h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=cd(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},e4(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a,b){return(c,d)=>{let f=this.tableName,g=cd(c);for(let a of e4(c))this.usedTables.add(a);if("string"==typeof g&&this.config.joins?.some(a=>a.alias===g))throw Error(`Alias "${g}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof f&&(this.config.fields={[f]:this.config.fields}),"string"==typeof g&&!e(c,Y))){let a=e(c,R)?c._.selectedFields:e(c,ao)?c[U].selectedFields:c[p.Symbol.Columns];this.config.fields[g]=a}if("function"==typeof d&&(d=d(new Proxy(this.config.fields,new b8({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:d,table:c,joinType:a,alias:g,lateral:b}),"string"==typeof g)switch(a){case"left":this.joinsNotNullableMap[g]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[g]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[g]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[g]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(a,b){return c=>{let d="function"==typeof c?c(eN()):c;if(!ca(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new b8({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new b8({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new b8({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new b8({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}for(a,b={}){return this.config.lockingClause={strength:a,config:b},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...e4(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...e4(a.table));return new Proxy(new R(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new b8({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new b8({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}}class eL extends eK{static [d]="PgSelect";_prepare(a){let{session:b,config:c,dialect:d,joinsNotNullableMap:e,authToken:f,cacheConfig:g,usedTables:h}=this;if(!b)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:i}=c;return T("drizzle.prepareQuery",()=>{let c=b9(i),j=b.prepareQuery(d.sqlToQuery(this.getSQL()),c,a,!0,void 0,{type:"select",tables:[...h]},g);return j.joinsNotNullableMap=e,j.setToken(f)})}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>T("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}for(let a of[b0])for(let b of Object.getOwnPropertyNames(a.prototype))"constructor"!==b&&Object.defineProperty(eL.prototype,b,Object.getOwnPropertyDescriptor(a.prototype,b)||Object.create(null));function eM(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!ca(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}let eN=()=>({union:eO,unionAll:eP,intersect:eQ,intersectAll:eR,except:eS,exceptAll:eT}),eO=eM("union",!1),eP=eM("union",!0),eQ=eM("intersect",!1),eR=eM("intersect",!0),eS=eM("except",!1),eT=eM("except",!0);class eU{static [d]="PgQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=e(a,eH)?a:void 0,this.dialectConfig=e(a,eH)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new S(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new b8({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new eJ({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(a){return new eJ({fields:a??void 0,session:void 0,dialect:b.getDialect(),distinct:!0})},selectDistinctOn:function(a,c){return new eJ({fields:c??void 0,session:void 0,dialect:b.getDialect(),distinct:{on:a}})}}}select(a){return new eJ({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new eJ({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(a,b){return new eJ({fields:b??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:a}})}getDialect(){return this.dialect||(this.dialect=new eH(this.dialectConfig)),this.dialect}}class eV{constructor(a,b){this.name=a,this.schema=b}static [d]="PgDefaultViewBuilderCore";config={};with(a){return this.config.with=a,this}}class eW extends eV{static [d]="PgViewBuilder";as(a){"function"==typeof a&&(a=a(new eU));let b=new b8({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),c=new Proxy(a.getSelectedFields(),b);return new Proxy(new e_({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:c,query:a.getSQL().inlineParams()}}),b)}}class eX extends eV{static [d]="PgManualViewBuilder";columns;constructor(a,b,c){super(a,c),this.columns=cc(ea(a,b))}existing(){return new Proxy(new e_({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new b8({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(a){return new Proxy(new e_({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:a.inlineParams()}}),new b8({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class eY{constructor(a,b){this.name=a,this.schema=b}static [d]="PgMaterializedViewBuilderCore";config={};using(a){return this.config.using=a,this}with(a){return this.config.with=a,this}tablespace(a){return this.config.tablespace=a,this}withNoData(){return this.config.withNoData=!0,this}}class eZ extends eY{static [d]="PgMaterializedViewBuilder";as(a){"function"==typeof a&&(a=a(new eU));let b=new b8({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),c=new Proxy(a.getSelectedFields(),b);return new Proxy(new e1({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:c,query:a.getSQL().inlineParams()}}),b)}}class e$ extends eY{static [d]="PgManualMaterializedViewBuilder";columns;constructor(a,b,c){super(a,c),this.columns=cc(ea(a,b))}existing(){return new Proxy(new e1({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new b8({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(a){return new Proxy(new e1({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:a.inlineParams()}}),new b8({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class e_ extends eG{static [d]="PgView";[el];constructor({pgConfig:a,config:b}){super(b),a&&(this[el]={with:a.with})}}let e0=Symbol.for("drizzle:PgMaterializedViewConfig");class e1 extends eG{static [d]="PgMaterializedView";[e0];constructor({pgConfig:a,config:b}){super(b),this[e0]={with:a?.with,using:a?.using,tablespace:a?.tablespace,withNoData:a?.withNoData}}}function e2(a,b,c){return b?new eX(a,b,c):new eW(a,c)}function e3(a,b,c){return b?new e$(a,b,c):new eZ(a,c)}function e4(a){return e(a,d8)?[a[h]?`${a[h]}.${a[p.Symbol.BaseName]}`:a[p.Symbol.BaseName]]:e(a,R)?a._.usedTables??[]:e(a,Y)?a.usedTables??[]:[]}class e5 extends b0{constructor(a,b,c,d){super(),this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [d]="PgDelete";config;cacheConfig;where(a){return this.config.where=a,this}returning(a=this.config.table[p.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=b9(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return T("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"delete",tables:e4(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>T("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new b8({alias:this.config.table[g],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class e6{constructor(a,b,c,d,e){this.table=a,this.session=b,this.dialect=c,this.withList=d,this.overridingSystemValue_=e}static [d]="PgInsertBuilder";authToken;setToken(a){return this.authToken=a,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[p.Symbol.Columns];for(let d of Object.keys(a)){let f=a[d];b[d]=e(f,Y)?f:new ab(f,c[d])}return b});return new e7(this.table,b,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(a){let b="function"==typeof a?a(new eU):a;if(!e(b,Y)&&!ca(this.table[i],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new e7(this.table,b,this.session,this.dialect,this.withList,!0)}}class e7 extends b0{constructor(a,b,c,d,e,f,g){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f,overridingSystemValue_:g}}static [d]="PgInsert";config;cacheConfig;returning(a=this.config.table[p.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=b9(a),this}onConflictDoNothing(a={}){if(void 0===a.target)this.config.onConflict=ac`do nothing`;else{let b="";b=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target));let c=a.where?ac` where ${a.where}`:void 0;this.config.onConflict=ac`(${ac.raw(b)})${c} do nothing`}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let b=a.where?ac` where ${a.where}`:void 0,c=a.targetWhere?ac` where ${a.targetWhere}`:void 0,d=a.setWhere?ac` where ${a.setWhere}`:void 0,e=this.dialect.buildUpdateSet(this.config.table,cb(this.config.table,a.set)),f="";return f=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target)),this.config.onConflict=ac`(${ac.raw(f)})${c} do update set ${e}${b}${d}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return T("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:e4(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>T("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new b8({alias:this.config.table[g],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class e8{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [d]="PgUpdateBuilder";authToken;setToken(a){return this.authToken=a,this}set(a){return new e9(this.table,cb(this.table,a),this.session,this.dialect,this.withList).setToken(this.authToken)}}class e9 extends b0{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]},this.tableName=cd(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [d]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(a){let b=cd(a);return"string"==typeof b&&(this.joinsNotNullableMap[b]=!0),this.config.from=a,this}getTableLikeFields(a){return e(a,d8)?a[p.Symbol.Columns]:e(a,R)?a._.selectedFields:a[U].selectedFields}createJoin(a){return(b,c)=>{let d=cd(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from&&!e(this.config.from,Y)?this.getTableLikeFields(this.config.from):void 0;c=c(new Proxy(this.config.table[p.Symbol.Columns],new b8({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new b8({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:c,table:b,joinType:a,alias:d}),"string"==typeof d)switch(a){case"left":this.joinsNotNullableMap[d]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!0;break;case"inner":this.joinsNotNullableMap[d]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}returning(a){if(!a&&(a=Object.assign({},this.config.table[p.Symbol.Columns]),this.config.from)){let b=cd(this.config.from);if("string"==typeof b&&this.config.from&&!e(this.config.from,Y)){let c=this.getTableLikeFields(this.config.from);a[b]=c}for(let b of this.config.joins){let c=cd(b.table);if("string"==typeof c&&!e(b.table,Y)){let d=this.getTableLikeFields(b.table);a[c]=d}}}return this.config.returningFields=a,this.config.returning=b9(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){let b=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:e4(this.config.table)},this.cacheConfig);return b.joinsNotNullableMap=this.joinsNotNullableMap,b}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>this._prepare().execute(a,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new b8({alias:this.config.table[g],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class fa extends Y{constructor(a){super(fa.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.mapWith(Number),this.session=a.session,this.sql=fa.buildCount(a.source,a.filters)}sql;token;static [d]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(a,b){return ac`(select count(*) from ${a}${ac.raw(" where ").if(b)}${b})`}static buildCount(a,b){return ac`select count(*) as count from ${a}${ac.raw(" where ").if(b)}${b};`}setToken(a){return this.token=a,this}then(a,b){return Promise.resolve(this.session.count(this.sql,this.token)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class fb{constructor(a,b,c,d,e,f,g){this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g}static [d]="PgRelationalQueryBuilder";findMany(a){return new fc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return new fc(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class fc extends b0{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [d]="PgRelationalQuery";_prepare(a){return T("drizzle.prepareQuery",()=>{let{query:b,builtQuery:c}=this._toSQL();return this.session.prepareQuery(c,void 0,a,!0,(a,c)=>{let d=a.map(a=>eF(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})})}prepare(a){return this._prepare(a)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let a=this._getQuery(),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(a){return this.authToken=a,this}execute(){return T("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class fd extends b0{constructor(a,b,c,d){super(),this.execute=a,this.sql=b,this.query=c,this.mapBatchResult=d}static [d]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class fe extends b0{constructor(a,b,c){super(),this.session=b,this.dialect=c,this.config={view:a}}static [d]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return T("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>T("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}class ff{constructor(a,b,c){if(this.dialect=a,this.session=b,this._=c?{schema:c.schema,fullSchema:c.fullSchema,tableNamesMap:c.tableNamesMap,session:b}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:b},this.query={},this._.schema)for(const[d,e]of Object.entries(this._.schema))this.query[d]=new fb(c.fullSchema,this._.schema,this._.tableNamesMap,c.fullSchema[d],e,a,b);this.$cache={invalidate:async a=>{}}}static [d]="PgDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new eU(c.dialect))),new Proxy(new S(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new b8({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new fa({source:a,filters:b,session:this.session})}$cache;with(...a){let b=this;return{select:function(c){return new eJ({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new eJ({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},selectDistinctOn:function(c,d){return new eJ({fields:d??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:{on:c}})},update:function(c){return new e8(c,b.session,b.dialect,a)},insert:function(c){return new e6(c,b.session,b.dialect,a)},delete:function(c){return new e5(c,b.session,b.dialect,a)}}}select(a){return new eJ({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new eJ({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(a,b){return new eJ({fields:b??void 0,session:this.session,dialect:this.dialect,distinct:{on:a}})}update(a){return new e8(a,this.session,this.dialect)}insert(a){return new e6(a,this.session,this.dialect)}delete(a){return new e5(a,this.session,this.dialect)}refreshMaterializedView(a){return new fe(a,this.session,this.dialect)}authToken;execute(a){let b="string"==typeof a?ac.raw(a):a.getSQL(),c=this.dialect.sqlToQuery(b),d=this.session.prepareQuery(c,void 0,void 0,!1);return new fd(()=>d.execute(void 0,this.authToken),b,c,a=>d.mapResult(a,!0))}transaction(a,b){return this.session.transaction(a,b)}}class fg{static [d]="Cache"}class fh extends fg{strategy(){return"all"}static [d]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function fi(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class fj{constructor(a,b,c,d){this.query=a,this.cache=b,this.queryMetadata=c,this.cacheConfig=d,b&&"all"===b.strategy()&&void 0===d&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(a,b){return a}setToken(a){return this.authToken=a,this}static [d]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||e(this.cache,fh)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new er(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new er(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new er(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await fi(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new er(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await fi(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new er(a,b,c)}}}class fk{constructor(a){this.dialect=a}static [d]="PgSession";execute(a,b){return T("drizzle.operation",()=>T("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1)).setToken(b).execute(void 0,b))}all(a){return this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1).all()}async count(a,b){return Number((await this.execute(a,b))[0].count)}}class fl extends ff{constructor(a,b,c,d=0){super(a,b,c),this.schema=c,this.nestedIndex=d}static [d]="PgTransaction";rollback(){throw new es}getTransactionConfigSQL(a){let b=[];return a.isolationLevel&&b.push(`isolation level ${a.isolationLevel}`),a.accessMode&&b.push(a.accessMode),"boolean"==typeof a.deferrable&&b.push(a.deferrable?"deferrable":"not deferrable"),ac.raw(b.join(" "))}setTransaction(a){return this.session.execute(ac`set transaction ${this.getTransactionConfigSQL(a)}`)}}class fm extends fj{constructor(a,b,c,d,e,f,g,h,i,j){super({sql:b,params:c},e,f,g),this.client=a,this.queryString=b,this.params=c,this.logger=d,this.fields=h,this._isResponseInArrayMode=i,this.customResultMapper=j}static [d]="PostgresJsPreparedQuery";async execute(a={}){return T("drizzle.execute",async b=>{let c=am(this.params,a);b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.logger.logQuery(this.queryString,c);let{fields:d,queryString:h,client:i,joinsNotNullableMap:j,customResultMapper:k}=this;if(!d&&!k)return T("drizzle.driver.execute",()=>this.queryWithCache(h,c,async()=>await i.unsafe(h,c)));let l=await T("drizzle.driver.execute",()=>(b?.setAttributes({"drizzle.query.text":h,"drizzle.query.params":JSON.stringify(c)}),this.queryWithCache(h,c,async()=>await i.unsafe(h,c).values())));return T("drizzle.mapResponse",()=>k?k(l):l.map(a=>(function(a,b,c){let d={},h=a.reduce((a,{path:h,field:i},j)=>{let k;k=e(i,f)?i:e(i,Y)?i.decoder:e(i,R)?i._.sql.decoder:i.sql.decoder;let l=a;for(let[a,m]of h.entries())if(a<h.length-1)m in l||(l[m]={}),l=l[m];else{let a=b[j],n=l[m]=null===a?null:k.mapFromDriverValue(a);if(c&&e(i,f)&&2===h.length){let a=h[0];a in d?"string"==typeof d[a]&&d[a]!==i.table[g]&&(d[a]=!1):d[a]=null===n&&i.table[g]}}return a},{});if(c&&Object.keys(d).length>0)for(let[a,b]of Object.entries(d))"string"!=typeof b||c[b]||(h[a]=null);return h})(d,a,j)))})}all(a={}){return T("drizzle.execute",async b=>{let c=am(this.params,a);return b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.logger.logQuery(this.queryString,c),T("drizzle.driver.execute",()=>(b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.queryWithCache(this.queryString,c,async()=>this.client.unsafe(this.queryString,c))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class fn extends fk{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new b_,this.cache=d.cache??new fh}static [d]="PostgresJsSession";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new fm(this.client,a.sql,a.params,this.logger,this.cache,f,g,b,d,e)}query(a,b){return this.logger.logQuery(a,b),this.client.unsafe(a,b).values()}queryObjects(a,b){return this.client.unsafe(a,b)}transaction(a,b){return this.client.begin(async c=>{let d=new fn(c,this.dialect,this.schema,this.options),e=new fo(this.dialect,d,this.schema);return b&&await e.setTransaction(b),a(e)})}}class fo extends fl{constructor(a,b,c,d=0){super(a,b,c,d),this.session=b}static [d]="PostgresJsTransaction";transaction(a){return this.session.client.savepoint(b=>{let c=new fn(b,this.dialect,this.schema,this.session.options);return a(new fo(this.dialect,c,this.schema))})}}class fp extends ff{static [d]="PostgresJsDatabase"}function fq(a,b={}){let c,d,e=a=>a;for(let b of["1184","1082","1083","1114","1182","1185","1115","1231"])a.options.parsers[b]=e,a.options.serializers[b]=e;a.options.serializers["114"]=e,a.options.serializers["3802"]=e;let f=new eH({casing:b.casing});if(!0===b.logger?c=new b$:!1!==b.logger&&(c=b.logger),b.schema){let a=eB(b.schema,eE);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let g=new fn(a,f,d,{logger:c,cache:b.cache}),h=new fp(f,g,d);return h.$client=a,h.$cache=b.cache,h.$cache&&(h.$cache.invalidate=b.cache?.onMutate),h}function fr(...a){if("string"==typeof a[0])return fq(bV(a[0]),a[1]);if(function(a){if("object"!=typeof a||null===a||"Object"!==a.constructor.name)return!1;if("logger"in a){let b=typeof a.logger;return"boolean"===b||"object"===b&&"function"==typeof a.logger.logQuery||"undefined"===b}if("schema"in a){let b=typeof a.schema;return"object"===b||"undefined"===b}if("casing"in a){let b=typeof a.casing;return"string"===b||"undefined"===b}if("mode"in a)return"default"===a.mode&&"planetscale"===a.mode&&void 0===a.mode;if("connection"in a){let b=typeof a.connection;return"string"===b||"object"===b||"undefined"===b}if("client"in a){let b=typeof a.client;return"object"===b||"function"===b||"undefined"===b}return 0===Object.keys(a).length}(a[0])){let{connection:b,client:c,...d}=a[0];if(c)return fq(c,d);if("object"==typeof b&&void 0!==b.url){let{url:a,...c}=b;return fq(bV(a,c),d)}return fq(bV(b),d)}return fq(a[0],a[1])}(fr||(fr={})).mock=function(a){return fq({options:{parsers:{},serializers:{}}},a)},a.s(["drizzle",()=>fr],69599);let fs=[{key:"PERSONAL",value:"personal",label:"Personnel",description:"Compte personnel",icon:"user",color:"blue"},{key:"TEAM",value:"team",label:"quipe",description:"Compte d'quipe",icon:"users",color:"purple"}],ft=Object.fromEntries(fs.map(a=>[a.key,a.value])),fu=fs.map(a=>a.value),fv=[{key:"OWNER",value:"owner",label:"Propritaire",description:"Propritaire du compte avec tous les droits",permissions:["all"],color:"purple"},{key:"ADMIN",value:"admin",label:"Administrateur",description:"Administrateur avec droits tendus",permissions:["manage_users","manage_hunts","manage_credits"],color:"blue"},{key:"MEMBER",value:"member",label:"Membre",description:"Membre avec droits limits",permissions:["view_hunts","view_leads"],color:"gray"}];Object.fromEntries(fv.map(a=>[a.key,a.value]));let fw=fv.map(a=>a.value);a.s(["ACCOUNT_TYPE_VALUES",0,fu,"EAccountType",0,ft,"ROLE_VALUES",0,fw],49827);var fx=((ae={}).PHONE_REQUIRED="PHONE_REQUIRED",ae.PHONE_INVALID_FORMAT="PHONE_INVALID_FORMAT",ae.PHONE_UPDATE_FAILED="PHONE_UPDATE_FAILED",ae.CONNECTION_TIMEOUT="CONNECTION_TIMEOUT",ae.CONNECTION_FAILED="CONNECTION_FAILED",ae.QR_GENERATION_FAILED="QR_GENERATION_FAILED",ae.SESSION_NOT_FOUND="SESSION_NOT_FOUND",ae.SESSION_EXPIRED="SESSION_EXPIRED",ae.SESSION_SAVE_FAILED="SESSION_SAVE_FAILED",ae.SESSION_DELETE_FAILED="SESSION_DELETE_FAILED",ae.ACCOUNT_NOT_FOUND="ACCOUNT_NOT_FOUND",ae.MESSAGE_SEND_FAILED="MESSAGE_SEND_FAILED",ae.RECIPIENT_INVALID="RECIPIENT_INVALID",ae),fy=((af={}).VALIDATION_FAILED="VALIDATION_FAILED",af.UNAUTHORIZED="UNAUTHORIZED",af.DATABASE_ERROR="DATABASE_ERROR",af.UNKNOWN_ERROR="UNKNOWN_ERROR",af.NOT_FOUND="NOT_FOUND",af.FORBIDDEN="FORBIDDEN",af.RATE_LIMITED="RATE_LIMITED",af.SERVER_ERROR="SERVER_ERROR",af),fz=((ag={}).API_KEY_REQUIRED="API_KEY_REQUIRED",ag.API_KEY_INVALID="API_KEY_INVALID",ag.API_KEY_SAVE_FAILED="API_KEY_SAVE_FAILED",ag.ENCRYPTION_KEY_MISSING="ENCRYPTION_KEY_MISSING",ag.PHONE_NUMBER_REQUIRED="PHONE_NUMBER_REQUIRED",ag.PHONE_NUMBER_INVALID="PHONE_NUMBER_INVALID",ag.MESSAGE_REQUIRED="MESSAGE_REQUIRED",ag.MESSAGE_SEND_FAILED="MESSAGE_SEND_FAILED",ag.ACCOUNT_NOT_FOUND="ACCOUNT_NOT_FOUND",ag);(ah={}).API_KEY_MISSING="API_KEY_MISSING",ah.API_KEY_INVALID="API_KEY_INVALID",ah.PHONE_NUMBER_REQUIRED="PHONE_NUMBER_REQUIRED",ah.PHONE_NUMBER_INVALID="PHONE_NUMBER_INVALID",ah.AUDIO_TOKEN_REQUIRED="AUDIO_TOKEN_REQUIRED",ah.AUDIO_TOKEN_INVALID="AUDIO_TOKEN_INVALID",ah.MESSAGE_SEND_FAILED="MESSAGE_SEND_FAILED",ah.API_ERROR="API_ERROR",(ai={}).HUNT_EXECUTION_FAILED="HUNT_EXECUTION_FAILED",ai.HUNT_STATUS_FETCH_FAILED="HUNT_STATUS_FETCH_FAILED",ai.SMS_QUEUE_FAILED="SMS_QUEUE_FAILED",ai.VOICE_QUEUE_FAILED="VOICE_QUEUE_FAILED",ai.WHATSAPP_QUEUE_FAILED="WHATSAPP_QUEUE_FAILED",ai.JOB_STATUS_FETCH_FAILED="JOB_STATUS_FETCH_FAILED",ai.QUEUE_STATS_FETCH_FAILED="QUEUE_STATS_FETCH_FAILED",ai.MISSING_REQUIRED_FIELDS="MISSING_REQUIRED_FIELDS",ai.INVALID_QUEUE_NAME="INVALID_QUEUE_NAME",ai.JOB_NOT_FOUND="JOB_NOT_FOUND",ai.QUEUE_NOT_FOUND="QUEUE_NOT_FOUND",a.s(["EGeneralErrorCode",()=>fy,"ESmsErrorCode",()=>fz,"EWhatsAppErrorCode",()=>fx],25822);let fA=[{key:"ACTIVE",value:"active",label:"Active",description:"Recherche en cours",icon:"play",color:"green"},{key:"PAUSED",value:"paused",label:"En pause",description:"Recherche mise en pause",icon:"pause",color:"orange"}],fB=Object.fromEntries(fA.map(a=>[a.key,a.value])),fC=fA.map(a=>a.value);a.s(["EHuntStatus",0,fB,"HUNT_STATUS_VALUES",0,fC],42025)},20118,a=>{"use strict";let b=[{key:"NEW",value:"new",label:"Nouveau",description:"Leads nouvellement dcouverts",color:"#3b82f6",class:"bg-blue-900/30 text-blue-400 border-blue-900/50",icon:"star"},{key:"CONTACTED",value:"contacted",label:"Contact",description:"Premier contact tabli",color:"#8b5cf6",class:"bg-purple-900/30 text-purple-400 border-purple-900/50",icon:"message"},{key:"CHASED",value:"chased",label:"Relance",description:"En attente de rponse",color:"#f59e0b",class:"bg-orange-900/30 text-orange-400 border-orange-900/50",icon:"clock"},{key:"WON",value:"won",label:"Gagn",description:"Vente conclue",color:"#22c55e",class:"bg-green-900/30 text-green-400 border-green-900/50",icon:"check"},{key:"LOST",value:"lost",label:"Perdu",description:"Opportunit perdue",color:"#ef4444",class:"bg-red-900/30 text-red-400 border-red-900/50",icon:"x"}],c=Object.fromEntries(b.map(a=>[a.key,a.value])),d=b.map(a=>a.value),e=[{key:"STAGE_CHANGE",value:"stage_change",label:"Changement d'tape",description:"Le lead a chang d'tape",icon:"arrow-right",color:"blue"},{key:"MESSAGE_SENT",value:"message_sent",label:"Message envoy",description:"Un message a t envoy au lead",icon:"send",color:"green"},{key:"ASSIGNMENT_CHANGE",value:"assignment_change",label:"Changement d'assignation",description:"Le lead a t assign  un autre utilisateur",icon:"user",color:"purple"},{key:"NOTE_ADDED",value:"note_added",label:"Note ajoute",description:"Une note a t ajoute au lead",icon:"file-text",color:"orange"},{key:"REMINDER_SET",value:"reminder_set",label:"Rappel dfini",description:"Un rappel a t cr",icon:"bell",color:"yellow"},{key:"CREATED",value:"created",label:"Cr",description:"Le lead a t cr",icon:"plus",color:"gray"}];Object.fromEntries(e.map(a=>[a.key,a.value]));let f=e.map(a=>a.value);a.s(["ELeadStage",0,c,"LEAD_ACTIVITY_TYPE_VALUES",0,f,"LEAD_STAGE_VALUES",0,d,"getLeadStageConfig",0,a=>{let c=b.find(b=>b.value===a);if(!c)throw Error(`Invalid lead stage: ${a}`);return c}])},81446,21732,66811,81966,5327,70530,67442,4867,69070,10919,27692,77554,96875,42810,a=>{"use strict";var b=a.i(18885),c=a.i(39284),d=a.i(69599),e=a.i(19569);a.s(["accountType",()=>aJ,"accounts",()=>aK,"accountsRelations",()=>aL],27692);var f=a.i(49827);a.i(25822);var g=a.i(42025),h=a.i(20118),i=a.i(73240);let j=[{key:"PURCHASE",value:"purchase",label:"Achat",description:"Achat de crdits",icon:"shopping-cart",color:"green",isPositive:!0},{key:"USAGE",value:"usage",label:"Utilisation",description:"Consommation de crdits",icon:"arrow-down",color:"red",isPositive:!1},{key:"REFUND",value:"refund",label:"Remboursement",description:"Remboursement de crdits",icon:"rotate-ccw",color:"green",isPositive:!0},{key:"ADJUSTMENT",value:"adjustment",label:"Ajustement",description:"Ajustement manuel",icon:"edit",color:"orange",isPositive:!1}];Object.fromEntries(j.map(a=>[a.key,a.value]));let k=j.map(a=>a.value),l=[{key:"LOBSTR",value:"lobstrValue",label:"LobstrValue",description:"Plateforme LobstrValue",icon:"globe",color:"blue"}];Object.fromEntries(l.map(a=>[a.key,a.value])),l.map(a=>a.value),a.s(["WORKER_ROUTES",0,{WHATSAPP_TEXT:"/api/whatsapp/text",PHONE_SMS:"/api/phone/sms",PHONE_RINGLESS_VOICE:"/api/phone/ringless-voice",HUNT_EXECUTE:"/api/hunt/execute",HUNT_STATUS:"/api/hunt/status",JOB_STATUS:"/api/jobs",QUEUE_STATS_ALL:"/api/queues/stats",QUEUE_STATS:"/api/queues"}],21732),a.s(["HUNT_WITH_RELATIONS",0,{location:!0,brands:{with:{brand:!0}},subTypes:{with:{subType:!0}}}],66811);var m=a.i(54799);let n="aes-256-gcm";a.s(["decryptCredentials",0,(a,b)=>{let c=Buffer.from(b,"hex");if(32!==c.length)throw Error("Encryption key must be 32 bytes (64 hex characters)");let d=Buffer.from(a,"base64"),e=d.subarray(0,16),f=d.subarray(16,32),g=d.subarray(32),h=(0,m.createDecipheriv)(n,c,e);h.setAuthTag(f);let i=h.update(g);return(i=Buffer.concat([i,h.final()])).toString("utf8")},"encryptCredentials",0,(a,b)=>{let c=Buffer.from(b,"hex");if(32!==c.length)throw Error("Encryption key must be 32 bytes (64 hex characters)");let d=(0,m.randomBytes)(16),e=(0,m.createCipheriv)(n,c,d),f=e.update(a,"utf8","base64");f+=e.final("base64");let g=e.getAuthTag();return Buffer.concat([d,g,Buffer.from(f,"base64")]).toString("base64")}],81966),a.s([],5327);var o=a.i(31240),p=a.i(68923),q=a.i(11439),r=a.i(78345),s=a.i(45667),t=a.i(46240),u=a.i(87451),v=a.i(15221),w=a.i(37361),x=a.i(28235),y=a.i(90661),z=a.i(5919);class A{constructor(a,b,c){this.seqName=a,this.seqOptions=b,this.schema=c}static [z.entityKind]="PgSequence"}var B=a.i(27270);class C{constructor(a){this.schemaName=a}static [z.entityKind]="PgSchema";table=(a,b,c)=>(0,u.pgTableWithSchema)(a,b,c,this.schemaName);view=(a,b)=>(0,B.pgViewWithSchema)(a,b,this.schemaName);materializedView=(a,b)=>(0,B.pgMaterializedViewWithSchema)(a,b,this.schemaName);enum(a,b){return Array.isArray(b)?(0,s.pgEnumWithSchema)(a,[...b],this.schemaName):(0,s.pgEnumObjectWithSchema)(a,b,this.schemaName)}sequence=(a,b)=>new A(a,b,this.schemaName);getSQL(){return new p.SQL([p.sql.identifier(this.schemaName)])}shouldOmitSQLParens(){return!0}}function D(a){if("public"===a)throw Error("You can't specify 'public' as schema name. Postgres is using public schema by default. If you want to use 'public' schema, just use pgTable() instead of creating a schema");return new C(a)}var E=a.i(31535);class F{constructor(a,b){this.name=a,b&&(this.createDb=b.createDb,this.createRole=b.createRole,this.inherit=b.inherit)}static [z.entityKind]="PgRole";_existing;createDb;createRole;inherit;existing(){return this._existing=!0,this}}function G(a,b){return new F(a,b)}G("anon").existing();let H=G("authenticated").existing(),I=G("service_role").existing();G("postgres_role").existing(),G("supabase_auth_admin").existing(),D("auth").table("users",{id:(0,w.uuid)().primaryKey().notNull(),email:(0,x.varchar)({length:255}),phone:(0,E.text)().unique(),emailConfirmedAt:(0,v.timestamp)("email_confirmed_at",{withTimezone:!0}),phoneConfirmedAt:(0,v.timestamp)("phone_confirmed_at",{withTimezone:!0}),lastSignInAt:(0,v.timestamp)("last_sign_in_at",{withTimezone:!0}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0})}),D("realtime").table("messages",{id:(0,y.bigserial)({mode:"bigint"}).primaryKey(),topic:(0,E.text)().notNull(),extension:(0,E.text)({enum:["presence","broadcast","postgres_changes"]}).notNull()});let J=p.sql`(select auth.uid())`;p.sql`realtime.topic()`,a.s(["adSubTypes",()=>aw,"adTypes",()=>av,"ads",()=>au,"adsRelations",()=>aF,"brands",()=>aC,"contactedAds",()=>aE,"contactedAdsRelations",()=>aG,"drivingLicences",()=>ax,"fuels",()=>aD,"gearBoxes",()=>ay,"locations",()=>aB,"vehicleSeats",()=>az,"vehicleStates",()=>aA],33905);var K=a.i(37525),L=a.i(37756),M=a.i(14009),N=a.i(68784),O=a.i(55233),P=a.i(68773),Q=a.i(53043),R=a.i(77856),S=a.i(62631);a.s(["channel",()=>am,"channelPriorities",()=>ao,"messageStatus",()=>an,"messageTemplates",()=>ap,"messageTemplatesRelations",()=>as,"messages",()=>ar,"messagesRelations",()=>at,"templateVariables",()=>aq],69070);var T=a.i(89279);a.s(["leadActivities",()=>ah,"leadActivitiesRelations",()=>al,"leadActivityType",()=>ad,"leadNotes",()=>af,"leadNotesRelations",()=>aj,"leadReminders",()=>ag,"leadRemindersRelations",()=>ak,"leadStage",()=>ac,"leads",()=>ae,"leadsRelations",()=>ai],4867),a.s(["adSubTypesHuntsRelations",()=>Z,"brandsHunts",()=>X,"brandsHuntsRelations",()=>$,"huntStatus",()=>U,"hunts",()=>V,"huntsRelations",()=>Y,"subTypesHunts",()=>W],70530);let U=(0,s.pgEnum)("hunt_status",g.HUNT_STATUS_VALUES),V=(0,u.pgTable)("hunts",{id:(0,w.uuid)().defaultRandom().primaryKey(),accountId:(0,w.uuid)("account_id").notNull(),typeId:(0,Q.smallint)("type_id").references(()=>av.id).notNull(),locationId:(0,N.integer)("location_id").references(()=>aB.id).notNull(),radiusInKm:(0,Q.smallint)("radius_in_km").default(0).notNull(),name:(0,x.varchar)({length:255}).notNull(),status:U().notNull().default(g.EHuntStatus.ACTIVE),autoRefresh:(0,q.boolean)("auto_refresh").notNull().default(!0),dailyPacingLimit:(0,Q.smallint)("daily_pacing_limit"),outreachSettings:(0,r.jsonb)("outreach_settings").$type().default(p.sql`'{}'::jsonb`),templateIds:(0,r.jsonb)("template_ids").$type().default(p.sql`'{}'::jsonb`),lastScanAt:(0,v.timestamp)("last_scan_at",{withTimezone:!0}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),priceMin:(0,O.real)("price_min").default(0).notNull(),mileageMin:(0,O.real)("mileage_min").default(0).notNull(),mileageMax:(0,O.real)("mileage_max"),modelYearMin:(0,O.real)("model_year_min").default(2010).notNull(),modelYearMax:(0,O.real)("model_year_max"),hasBeenReposted:(0,q.boolean)("has_been_reposted").default(!1).notNull(),priceHasDropped:(0,q.boolean)("price_has_dropped").default(!1).notNull(),isUrgent:(0,q.boolean)("is_urgent").default(!1).notNull(),hasBeenBoosted:(0,q.boolean)("has_been_boosted").default(!1).notNull(),isLowPrice:(0,q.boolean)("is_low_price").default(!1).notNull(),priceMax:(0,O.real)("price_max")},a=>[(0,T.foreignKey)({columns:[a.accountId],foreignColumns:[aK.id],name:"hunt_account_id_fk"}).onDelete("cascade"),(0,M.index)("hunt_account_id_status_idx").on(a.accountId,a.status),(0,M.index)("hunt_account_id_idx").on(a.accountId),(0,t.pgPolicy)("enable insert for authenticated roles",{as:"permissive",for:"insert",to:H,withCheck:p.sql`true`}),(0,t.pgPolicy)("enable read update and delete for the hunt owners",{as:"permissive",for:"all",to:H,using:p.sql`${a.accountId} = ${J}`,withCheck:p.sql`${a.accountId} = ${J}`})]),W=(0,u.pgTable)("sub_types_hunts",{id:(0,w.uuid)().defaultRandom().primaryKey(),huntId:(0,w.uuid)("hunt_id").notNull(),subTypeId:(0,Q.smallint)("sub_type_id").notNull()},a=>[(0,T.foreignKey)({columns:[a.huntId],foreignColumns:[V.id],name:"hunt_id_fk"}).onDelete("cascade"),(0,T.foreignKey)({columns:[a.subTypeId],foreignColumns:[aw.id],name:"sub_types_id_fk"}).onDelete("no action"),(0,t.pgPolicy)("enable all crud for the hunt owners",{as:"permissive",for:"all",to:H,using:p.sql`exists (
        select 1 from hunts h
        where h.id = ${a.huntId}
        and h.account_id = ${J}
      )`,withCheck:p.sql`exists (
        select 1 from hunts h
        where h.id = ${a.huntId}
        and h.account_id = ${J}
      )`})]),X=(0,u.pgTable)("brands_hunts",{id:(0,w.uuid)().defaultRandom().primaryKey(),huntId:(0,w.uuid)("hunt_id").notNull(),brandId:(0,Q.smallint)("brand_id").notNull()},a=>[(0,T.foreignKey)({columns:[a.huntId],foreignColumns:[V.id],name:"hunt_id_fk"}).onDelete("cascade"),(0,T.foreignKey)({columns:[a.brandId],foreignColumns:[aC.id],name:"brands_id_fk"}).onDelete("no action"),(0,t.pgPolicy)("enable all crud for the hunt owners",{as:"permissive",for:"all",to:H,using:p.sql`exists (
        select 1 from hunts h
        where h.id = ${a.huntId}
        and h.account_id = ${J}
      )`,withCheck:p.sql`exists (
        select 1 from hunts h
        where h.id = ${a.huntId}
        and h.account_id = ${J}
      )`})]),Y=(0,o.relations)(V,({one:a,many:b})=>({account:a(aK,{fields:[V.accountId],references:[aK.id]}),location:a(aB,{fields:[V.locationId],references:[aB.id]}),type:a(av,{fields:[V.typeId],references:[av.id]}),subTypes:b(W),brands:b(X)})),Z=(0,o.relations)(W,({one:a})=>({base:a(V,{fields:[W.huntId],references:[V.id]}),subType:a(aw,{fields:[W.subTypeId],references:[aw.id]})})),$=(0,o.relations)(X,({one:a})=>({base:a(V,{fields:[X.huntId],references:[V.id]}),brand:a(aC,{fields:[X.brandId],references:[aC.id]})}));a.s(["role",()=>_,"teamMembers",()=>aa,"teamMembersRelations",()=>ab],67442);let _=(0,s.pgEnum)("role",f.ROLE_VALUES),aa=(0,u.pgTable)("team_members",{id:(0,w.uuid)().primaryKey().defaultRandom(),accountId:(0,w.uuid)("account_id").notNull(),name:(0,E.text)().notNull()},a=>[(0,T.foreignKey)({columns:[a.accountId],foreignColumns:[aK.id],name:"account_id_fk"}).onDelete("cascade"),(0,S.unique)("organisation_id_member_name_unique").on(a.accountId,a.name),(0,t.pgPolicy)("enable all for account owners",{as:"permissive",for:"all",to:H,using:p.sql`${a.accountId} = ${J}`,withCheck:p.sql`${a.accountId} = ${J}`})]),ab=(0,o.relations)(aa,({one:a})=>({account:a(aK,{fields:[aa.accountId],references:[aK.id]})})),ac=(0,s.pgEnum)("lead_stage",h.LEAD_STAGE_VALUES),ad=(0,s.pgEnum)("lead_activity_type",h.LEAD_ACTIVITY_TYPE_VALUES),ae=(0,u.pgTable)("leads",{id:(0,w.uuid)().defaultRandom().primaryKey(),accountId:(0,w.uuid)("account_id").references(()=>aK.id,{onDelete:"cascade"}).notNull(),huntId:(0,w.uuid)("hunt_id").references(()=>V.id,{onDelete:"cascade"}).notNull(),adId:(0,w.uuid)("ad_id").references(()=>au.id,{onDelete:"cascade"}).notNull(),stage:ac().notNull().default(h.ELeadStage.NEW),assignedToId:(0,w.uuid)("assigned_to_id").references(()=>aa.id,{onDelete:"set null"}),position:(0,N.integer)().notNull().default(0),notes:(0,E.text)(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().default(p.sql`now()`),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().default(p.sql`now()`)},a=>[(0,S.unique)("leads_account_id_ad_id_key").on(a.accountId,a.adId),(0,M.index)("leads_account_id_stage_idx").on(a.accountId,a.stage),(0,M.index)("leads_account_id_assigned_to_id_idx").on(a.accountId,a.assignedToId),(0,M.index)("leads_hunt_id_idx").on(a.huntId),(0,M.index)("leads_ad_id_idx").on(a.adId),(0,t.pgPolicy)("enable all for owners of the associated account",{as:"permissive",for:"all",to:H,using:p.sql`${a.accountId} = ${J}`,withCheck:p.sql`${a.accountId} = ${J}`})]),af=(0,u.pgTable)("lead_notes",{id:(0,w.uuid)().primaryKey().notNull().defaultRandom(),leadId:(0,w.uuid)("lead_id").notNull().references(()=>ae.id,{onDelete:"cascade"}),content:(0,E.text)().notNull(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>[(0,M.index)("lead_notes_lead_id_idx").on(a.leadId),(0,t.pgPolicy)("enable all for account members",{as:"permissive",for:"all",to:H,using:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J})`,withCheck:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J})`})]),ag=(0,u.pgTable)("lead_reminders",{id:(0,w.uuid)().primaryKey().notNull().defaultRandom(),leadId:(0,w.uuid)("lead_id").notNull().references(()=>ae.id,{onDelete:"cascade"}),dueAt:(0,v.timestamp)("due_at",{withTimezone:!0}).notNull(),note:(0,E.text)(),completed:(0,q.boolean)().notNull().default(!1),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>[(0,M.index)("lead_reminders_lead_id_idx").on(a.leadId),(0,M.index)("lead_reminders_due_at_idx").on(a.dueAt),(0,t.pgPolicy)("enable all for account members",{as:"permissive",for:"all",to:H,using:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J})`,withCheck:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J})`})]),ah=(0,u.pgTable)("lead_activities",{id:(0,w.uuid)().defaultRandom().primaryKey(),leadId:(0,w.uuid)("lead_id").notNull().references(()=>ae.id,{onDelete:"cascade"}),type:ad().notNull(),metadata:(0,r.jsonb)().$type(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>[(0,M.index)("lead_activities_lead_id_created_at_idx").on(a.leadId,a.createdAt),(0,M.index)("lead_activities_type_idx").on(a.type),(0,t.pgPolicy)("enable read for account owners",{as:"permissive",for:"select",to:H,using:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J}
      )`}),(0,t.pgPolicy)("enable insert for account owners",{as:"permissive",for:"insert",to:H,withCheck:p.sql`exists (
              select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J}
      )`})]),ai=(0,o.relations)(ae,({one:a,many:b})=>({account:a(aK,{fields:[ae.accountId],references:[aK.id]}),hunt:a(V,{fields:[ae.huntId],references:[V.id]}),ad:a(au,{fields:[ae.adId],references:[au.id]}),assignedTo:a(aa,{fields:[ae.assignedToId],references:[aa.id]}),notes:b(af),reminders:b(ag)})),aj=(0,o.relations)(af,({one:a})=>({lead:a(ae,{fields:[af.leadId],references:[ae.id]})})),ak=(0,o.relations)(ag,({one:a})=>({lead:a(ae,{fields:[ag.leadId],references:[ae.id]})})),al=(0,o.relations)(ah,({one:a})=>({lead:a(ae,{fields:[ah.leadId],references:[ae.id]})})),am=(0,s.pgEnum)("channel",i.EContactChannel),an=(0,s.pgEnum)("message_status",i.MESSAGE_STATUS_VALUES),ao=(0,u.pgTable)("channel_priorities",{id:(0,R.smallserial)().primaryKey(),channel:am().notNull(),priority:(0,Q.smallint)().notNull()},a=>[(0,S.unique)("channel_priorities_channel_unique").on(a.channel),(0,S.unique)("channel_priorities_priority_unique").on(a.priority),(0,t.pgPolicy)("enable all for service role",{as:"permissive",for:"all",to:I,using:p.sql`true`,withCheck:p.sql`true`})]),ap=(0,u.pgTable)("message_templates",{id:(0,w.uuid)().defaultRandom().primaryKey(),accountId:(0,w.uuid)("account_id").notNull(),name:(0,E.text)().notNull(),channel:am().notNull(),content:(0,E.text)(),audioUrl:(0,E.text)("audio_url"),audioDuration:(0,N.integer)("audio_duration"),isDefault:(0,q.boolean)("is_default").notNull().default(!1),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().default(p.sql`now()`),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().default(p.sql`now()`)},a=>[(0,T.foreignKey)({columns:[a.accountId],foreignColumns:[aK.id],name:"message_templates_organization_id_fk"}).onDelete("cascade"),(0,t.pgPolicy)("enable all for owners of the associated account",{as:"permissive",for:"all",to:H,using:p.sql`${a.accountId} = ${J}`,withCheck:p.sql`${a.accountId} = ${J}`})]),aq=(0,u.pgTable)("template_variables",{id:(0,P.serial)().primaryKey(),key:(0,E.text)().notNull().unique(),label:(0,E.text)().notNull(),description:(0,E.text)()}),ar=(0,u.pgTable)("messages",{id:(0,w.uuid)().defaultRandom().primaryKey(),leadId:(0,w.uuid)("lead_id").notNull(),templateId:(0,w.uuid)("template_id"),channel:am().notNull(),content:(0,E.text)().notNull(),status:an().notNull().default(i.EMessageStatus.PENDING),externalId:(0,x.varchar)("external_id",{length:255}),sentAt:(0,v.timestamp)("sent_at",{withTimezone:!0}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().default(p.sql`now()`),sentById:(0,w.uuid)("sent_by_id").notNull()},a=>[(0,T.foreignKey)({columns:[a.leadId],foreignColumns:[ae.id],name:"messages_lead_id_fk"}).onDelete("cascade"),(0,T.foreignKey)({columns:[a.templateId],foreignColumns:[ap.id],name:"messages_template_id_fk"}).onDelete("set null"),(0,T.foreignKey)({columns:[a.sentById],foreignColumns:[aa.id],name:"messages_sent_by_id_fk"}).onDelete("cascade"),(0,M.index)("messages_lead_id_created_at_idx").on(a.leadId,a.createdAt),(0,M.index)("messages_status_idx").on(a.status),(0,M.index)("messages_external_id_idx").on(a.externalId),(0,t.pgPolicy)("enable all for account owners",{as:"permissive",for:"all",to:H,using:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J}
      )`,withCheck:p.sql`exists (
        select 1 from leads l
        where l.id = ${a.leadId}
        and l.account_id = ${J}
      )`})]),as=(0,o.relations)(ap,({one:a})=>({account:a(aK,{fields:[ap.accountId],references:[aK.id]})})),at=(0,o.relations)(ar,({one:a})=>({lead:a(ae,{fields:[ar.leadId],references:[ae.id]}),template:a(ap,{fields:[ar.templateId],references:[ap.id]}),sentBy:a(aa,{fields:[ar.sentById],references:[aa.id]})})),au=(0,u.pgTable)("ads",{id:(0,w.uuid)().defaultRandom().primaryKey(),typeId:(0,Q.smallint)("type_id").references(()=>av.id).notNull(),subtypeId:(0,Q.smallint)("subtype_id").references(()=>aw.id),drivingLicenceId:(0,Q.smallint)("driving_licence_id").references(()=>ax.id),gearBoxId:(0,Q.smallint)("gear_box_id").references(()=>ay.id),vehicleSeatsId:(0,Q.smallint)("vehicle_seats_id").references(()=>az.id),vehicleStateId:(0,Q.smallint)("vehicle_state_id").references(()=>aA.id),locationId:(0,N.integer)("location_id").references(()=>aB.id).notNull(),brandId:(0,N.integer)("brand_id").references(()=>aC.id),fuelId:(0,Q.smallint)("fuel_id").references(()=>aD.id),url:(0,E.text)().notNull(),originalAdId:(0,E.text)("original_ad_id").notNull().unique(),title:(0,E.text)().notNull(),description:(0,E.text)(),picture:(0,E.text)(),price:(0,L.doublePrecision)().notNull(),hasBeenReposted:(0,q.boolean)("has_been_reposted").default(!1).notNull(),hasBeenBoosted:(0,q.boolean)("has_been_boosted").default(!1).notNull(),isUrgent:(0,q.boolean)("is_urgent").default(!1).notNull(),modelYear:(0,Q.smallint)("model_year"),initialPublicationDate:(0,K.date)("initial_publication_date").notNull(),lastPublicationDate:(0,K.date)("last_publication_date").notNull(),mileage:(0,O.real)(),createdAt:(0,K.date)("created_at").defaultNow(),priceHasDropped:(0,q.boolean)("price_has_dropped").default(!1).notNull(),favourite:(0,q.boolean)().default(!1).notNull(),priceMin:(0,O.real)("price_min"),priceMax:(0,O.real)("price_max"),isLowPrice:(0,q.boolean)("is_low_price").default(!1).notNull(),phoneNumber:(0,E.text)("phone_number"),isWhatsappPhone:(0,q.boolean)("is_whatsapp_phone").default(!1),ownerName:(0,E.text)("owner_name").notNull(),entryYear:(0,Q.smallint)("entry_year"),hasPhone:(0,q.boolean)("has_phone").default(!1).notNull(),equipments:(0,E.text)(),otherSpecifications:(0,E.text)("other_specifications"),technicalInspectionYear:(0,Q.smallint)("technical_inspection_year"),model:(0,E.text)(),acceptSalesmen:(0,q.boolean)("accept_salesmen").default(!0).notNull()},a=>[(0,M.index)("ads_created_at_location_state_flags_idx").on(a.createdAt,a.typeId,a.locationId,a.acceptSalesmen,a.hasPhone,a.ownerName,a.subtypeId,a.vehicleStateId,a.modelYear,a.mileage,a.isLowPrice,a.isUrgent,a.hasBeenReposted,a.hasBeenBoosted,a.priceHasDropped,a.price,a.drivingLicenceId,a.gearBoxId,a.vehicleSeatsId,a.brandId,a.fuelId,a.favourite),(0,M.index)("ads_title_search_idx").on(a.title),(0,t.pgPolicy)("Enable read access for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),av=(0,u.pgTable)("ad_types",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("ad_type_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aw=(0,u.pgTable)("sub_types",{id:(0,R.smallserial)().primaryKey(),adTypeId:(0,Q.smallint)("ad_type_id").references(()=>av.id).notNull(),name:(0,E.text)().notNull().unique("ad_sub_type_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),ax=(0,u.pgTable)("driving_licences",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("driving_licence_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),ay=(0,u.pgTable)("gear_boxes",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("gear_box_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),az=(0,u.pgTable)("vehicle_seats",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("vehicle_seats_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aA=(0,u.pgTable)("vehicle_states",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("vehicle_state_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aB=(0,u.pgTable)("locations",{id:(0,P.serial)().primaryKey(),zipcode:(0,x.varchar)({length:5}).notNull(),name:(0,E.text)().notNull(),lat:(0,O.real)().notNull(),lng:(0,O.real)().notNull()},a=>[(0,S.unique)("zipcode_name_unique").on(a.name,a.zipcode),(0,M.index)("locations_geo_idx").using("gist",p.sql`(ST_MakePoint(${a.lng}, ${a.lat})::geography)`),(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aC=(0,u.pgTable)("brands",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("brand_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aD=(0,u.pgTable)("fuels",{id:(0,R.smallserial)().primaryKey(),name:(0,E.text)().notNull().unique("fuel_name_unique"),lbcValue:(0,E.text)("lbc_value"),lobstrValue:(0,E.text)("lobstr_value")},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aE=(0,u.pgTable)("contacted_ads",{id:(0,w.uuid)().defaultRandom().primaryKey(),adId:(0,w.uuid)("ad_id").references(()=>au.id,{onDelete:"cascade"}).notNull(),accountId:(0,w.uuid)("account_id").references(()=>aK.id,{onDelete:"cascade"}).notNull(),channel:am("channel").notNull(),createdAt:(0,K.date)("created_at").defaultNow().notNull()},()=>[(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`}),(0,t.pgPolicy)("enable update for authenticated users",{as:"permissive",for:"update",to:H,using:p.sql`true`,withCheck:p.sql`true`}),(0,t.pgPolicy)("enable insert for authenticated users",{as:"permissive",for:"insert",to:H,withCheck:p.sql`true`})]),aF=(0,o.relations)(au,({one:a,many:b})=>({type:a(av,{fields:[au.typeId],references:[av.id]}),subtype:a(aw,{fields:[au.subtypeId],references:[aw.id]}),drivingLicence:a(ax,{fields:[au.drivingLicenceId],references:[ax.id]}),gearBox:a(ay,{fields:[au.gearBoxId],references:[ay.id]}),vehicleSeats:a(az,{fields:[au.vehicleSeatsId],references:[az.id]}),vehicleState:a(aA,{fields:[au.vehicleStateId],references:[aA.id]}),location:a(aB,{fields:[au.locationId],references:[aB.id]}),brand:a(aC,{fields:[au.brandId],references:[aC.id]}),fuel:a(aD,{fields:[au.fuelId],references:[aD.id]}),contactedAds:b(aE)})),aG=(0,o.relations)(aE,({one:a})=>({ad:a(au,{fields:[aE.adId],references:[au.id]}),account:a(aK,{fields:[aE.accountId],references:[aK.id]})}));a.s(["whatsappSessions",()=>aH,"whatsappSessionsRelations",()=>aI],10919);let aH=(0,u.pgTable)("whatsapp_sessions",{id:(0,w.uuid)().defaultRandom().primaryKey(),accountId:(0,w.uuid)("account_id").references(()=>aK.id,{onDelete:"cascade"}).unique().notNull(),credentials:(0,E.text)("credentials"),isConnected:(0,q.boolean)("is_connected").default(!1).notNull(),lastConnectedAt:(0,v.timestamp)("last_connected_at",{withTimezone:!0}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).defaultNow().notNull()},a=>[(0,t.pgPolicy)("enable all for own session",{as:"permissive",for:"all",to:H,using:p.sql`${J} = ${a.accountId}`,withCheck:p.sql`${J} = ${a.accountId}`})]),aI=(0,o.relations)(aH,({one:a})=>({account:a(aK,{fields:[aH.accountId],references:[aK.id]})})),aJ=(0,s.pgEnum)("account_type",f.ACCOUNT_TYPE_VALUES),aK=(0,u.pgTable)("accounts",{id:(0,w.uuid)().primaryKey(),name:(0,x.varchar)({length:255}),email:(0,x.varchar)({length:320}).notNull(),pictureUrl:(0,x.varchar)("picture_url",{length:1e3}),fixedPhoneNumber:(0,x.varchar)("fixed_phone_number",{length:14}),phoneNumber:(0,x.varchar)("phone_number",{length:14}),whatsappPhoneNumber:(0,x.varchar)("whatsapp_phone_number",{length:20}),smsMobileAPiAllowed:(0,q.boolean)("sms_mobile_api_allowed").default(!1).notNull(),smsApiKey:(0,x.varchar)("sms_api_key",{length:500}),type:aJ("type").notNull().default(f.EAccountType.PERSONAL),settings:(0,r.jsonb)().$type(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>[(0,t.pgPolicy)("enable update for account owners",{as:"permissive",for:"update",to:H,using:p.sql`
        ${J} = ${a.id}`,withCheck:p.sql`
        ${J} = ${a.id}`}),(0,t.pgPolicy)("enable delete for account owners",{as:"permissive",for:"delete",to:H,using:p.sql`
        ${J} = ${a.id} 
      `}),(0,t.pgPolicy)("enable read for account owners",{as:"permissive",for:"select",to:H,using:p.sql`
        ${J} = ${a.id} `})]),aL=(0,o.relations)(aK,({many:a,one:b})=>({contactedAds:a(aE),whatsappSession:b(aH)})),aM=(0,s.pgEnum)("transaction_type",k),aN=(0,u.pgTable)("credit_balances",{id:(0,w.uuid)().defaultRandom().primaryKey(),accountId:(0,w.uuid)("account_id").references(()=>aK.id,{onDelete:"cascade"}).notNull().unique(),sms:(0,N.integer)("sms").notNull().default(0),ringlessVoice:(0,N.integer)("ringless_voice").notNull().default(0),whatsappText:(0,N.integer)("whatsapp_text").notNull().default(0),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().default(p.sql`now()`)},a=>[(0,M.index)("credit_balances_account_id_idx").on(a.accountId),(0,t.pgPolicy)("enable read for credit walet owners",{as:"permissive",for:"select",to:H,using:p.sql`${a.accountId} = ${J}`})]),aO=(0,u.pgTable)("credit_transactions",{id:(0,w.uuid)().defaultRandom().primaryKey(),accountId:(0,w.uuid)("account_id").references(()=>aK.id,{onDelete:"cascade"}).notNull(),type:aM().notNull(),channel:am().notNull(),amount:(0,N.integer)().notNull(),balanceAfter:(0,N.integer)("balance_after").notNull(),referenceId:(0,w.uuid)("reference_id"),metadata:(0,r.jsonb)().$type(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().default(p.sql`now()`)},a=>[(0,M.index)("credit_transactions_org_created_idx").on(a.accountId,a.createdAt),(0,M.index)("credit_transactions_reference_id_idx").on(a.referenceId),(0,t.pgPolicy)("enable read for transaction owners",{as:"permissive",for:"select",to:H,using:p.sql`${a.accountId} = ${J}`})]),aP=(0,u.pgTable)("credit_packs",{id:(0,R.smallserial)().primaryKey(),channel:am().notNull(),credits:(0,N.integer)().notNull(),priceEur:(0,N.integer)("price_eur").notNull(),isActive:(0,q.boolean)("is_active").notNull().default(!0)},a=>[(0,M.index)("credit_packs_credit_type_idx").on(a.channel),(0,t.pgPolicy)("enable read for authenticated users",{as:"permissive",for:"select",to:H,using:p.sql`true`})]),aQ=(0,u.pgTable)("hunt_channel_credits",{id:(0,w.uuid)().defaultRandom().primaryKey(),huntId:(0,w.uuid)("hunt_id").notNull(),channel:am().notNull(),creditsAllocated:(0,N.integer)("credits_allocated").notNull().default(0),creditsConsumed:(0,N.integer)("credits_consumed").notNull().default(0),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().default(p.sql`now()`),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().default(p.sql`now()`)},a=>[(0,T.foreignKey)({columns:[a.huntId],foreignColumns:[V.id],name:"hunt_channel_credits_hunt_id_fk"}).onDelete("cascade"),(0,S.unique)("hunt_channel_unique").on(a.huntId,a.channel),(0,M.index)("hunt_channel_credits_hunt_id_idx").on(a.huntId),(0,t.pgPolicy)("enable all for hunt owners",{as:"permissive",for:"all",to:H,using:p.sql`exists (
        select 1 from hunts h
        where h.id = ${a.huntId}
        and h.account_id = ${J}
      )`,withCheck:p.sql`exists (
        select 1 from hunts h
        where h.id = ${a.huntId}
        and h.account_id = ${J}
      )`})]),aR=(0,o.relations)(aN,({one:a})=>({account:a(aK,{fields:[aN.accountId],references:[aK.id]})})),aS=(0,o.relations)(aO,({one:a})=>({account:a(aK,{fields:[aO.accountId],references:[aK.id]})})),aT=(0,o.relations)(aQ,({one:a})=>({hunt:a(V,{fields:[aQ.huntId],references:[V.id]})}));a.s(["creditBalances",0,aN,"creditBalancesRelations",0,aR,"creditPacks",0,aP,"creditTransactions",0,aO,"creditTransactionsRelations",0,aS,"huntChannelCredits",0,aQ,"huntChannelCreditsRelations",0,aT,"transactionType",0,aM],77554);let aU=(0,u.pgTable)("app_settings",{id:(0,R.smallserial)().primaryKey(),smsAlerts:(0,q.boolean)("sms_alerts").default(!1),slackAlerts:(0,q.boolean)("slack_alerts").default(!0)});a.s(["appSettings",0,aU],78544),a.s([],43394),a.i(43394),a.i(27692),a.i(33905),a.i(77554),a.i(78544),a.i(70530),a.i(4867),a.i(69070),a.i(67442),a.i(10919),a.s(["accountType",0,aJ,"accounts",0,aK,"accountsRelations",0,aL,"adSubTypes",0,aw,"adSubTypesHuntsRelations",0,Z,"adTypes",0,av,"ads",0,au,"adsRelations",0,aF,"appSettings",0,aU,"brands",0,aC,"brandsHunts",0,X,"brandsHuntsRelations",0,$,"channel",0,am,"channelPriorities",0,ao,"contactedAds",0,aE,"contactedAdsRelations",0,aG,"creditBalances",0,aN,"creditBalancesRelations",0,aR,"creditPacks",0,aP,"creditTransactions",0,aO,"creditTransactionsRelations",0,aS,"drivingLicences",0,ax,"fuels",0,aD,"gearBoxes",0,ay,"huntChannelCredits",0,aQ,"huntChannelCreditsRelations",0,aT,"huntStatus",0,U,"hunts",0,V,"huntsRelations",0,Y,"leadActivities",0,ah,"leadActivitiesRelations",0,al,"leadActivityType",0,ad,"leadNotes",0,af,"leadNotesRelations",0,aj,"leadReminders",0,ag,"leadRemindersRelations",0,ak,"leadStage",0,ac,"leads",0,ae,"leadsRelations",0,ai,"locations",0,aB,"messageStatus",0,an,"messageTemplates",0,ap,"messageTemplatesRelations",0,as,"messages",0,ar,"messagesRelations",0,at,"role",0,_,"subTypesHunts",0,W,"teamMembers",0,aa,"teamMembersRelations",0,ab,"templateVariables",0,aq,"transactionType",0,aM,"vehicleSeats",0,az,"vehicleStates",0,aA,"whatsappSessions",0,aH,"whatsappSessionsRelations",0,aI],43215);var aV=a.i(43215);class aW extends Error{}aW.prototype.name="InvalidTokenError";let aX=process.env.SUPABASE_DATABASE_URL;if(!aX)throw Error("SUPABASE_DATABASE_URL environment variable is not set");let aY=(0,e.default)(aX,{prepare:!1}),aZ=(0,d.drizzle)({client:aY,casing:"snake_case",schema:aV,logger:!1});function a$(a){return function(a,{admin:b,client:c}){return{admin:b,rls:async(b,...d)=>await c.transaction(async c=>{try{return await c.execute(p.sql`
          -- auth.jwt()
          select set_config('request.jwt.claims', '${p.sql.raw(JSON.stringify(a))}', TRUE);
          -- auth.uid()
          select set_config('request.jwt.claim.sub', '${p.sql.raw(a.sub??"")}', TRUE);												
          -- set local role
          set local role ${p.sql.raw(a.role??"anon")};
          `),await b(c)}finally{await c.execute(p.sql`
            -- reset
            select set_config('request.jwt.claims', NULL, TRUE);
            select set_config('request.jwt.claim.sub', NULL, TRUE);
            reset role;
            `)}},...d)}}(function(a){try{return function(a,b){let c;if("string"!=typeof a)throw new aW("Invalid token specified: must be a string");b||(b={});let d=+(!0!==b.header),e=a.split(".")[d];if("string"!=typeof e)throw new aW(`Invalid token specified: missing part #${d+1}`);try{c=function(a){let b=a.replace(/-/g,"+").replace(/_/g,"/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw Error("base64 string is not of the correct length")}try{var c;return c=b,decodeURIComponent(atob(c).replace(/(.)/g,(a,b)=>{let c=b.charCodeAt(0).toString(16).toUpperCase();return c.length<2&&(c="0"+c),"%"+c}))}catch(a){return atob(b)}}(e)}catch(a){throw new aW(`Invalid token specified: invalid base64 for part #${d+1} (${a.message})`)}try{return JSON.parse(c)}catch(a){throw new aW(`Invalid token specified: invalid json for part #${d+1} (${a.message})`)}}(a)}catch{return{role:"anon"}}}(a),{admin:aZ,client:aZ})}function a_(){return aZ}a.s(["getDBAdminClient",()=>a_,"getDBWithTokenClient",()=>a$,"postgresClient",()=>aY],66050),a.i(53655),a.s([],96875),a.i(66050);var a0=a.i(12401);async function a1(){let a=await (0,b.createClient)(),{data:{session:c}}=await a.auth.getSession();return a$(c?.access_token??"")}a.s(["and",()=>c.and,"desc",()=>a0.desc,"eq",()=>c.eq,"getDBWithTokenClient",()=>a$,"gte",()=>c.gte,"inArray",()=>c.inArray,"sql",()=>p.sql],42810),a.s(["createDrizzleSupabaseClient",()=>a1],81446)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5ce2e508._.js.map