{"version":3,"sources":["../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/services/account.service.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/app/whatsapp/test/whatsapp-test-client.tsx/__nextjs-internal-proxy.mjs","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/app/whatsapp/test/page.tsx"],"sourcesContent":["import { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport {\n  TAccount,\n  TAccountSelectedKeys,\n  TDBWithTokenClient,\n} from \"@auto-prospect/db\";\n\n/**\n * Gets the current user's primary account (overload for no columns - returns full account)\n */\nexport async function getUserAccount(\n  dbClient?: TDBWithTokenClient,\n): Promise<TAccount>;\n\n/**\n * Gets the current user's primary account (overload for selected columns)\n */\nexport async function getUserAccount<\n  T extends Partial<Record<keyof TAccount, boolean>>,\n>(\n  dbClient: TDBWithTokenClient | undefined,\n  options: { columnsToKeep: T },\n): Promise<Pick<TAccount, TAccountSelectedKeys<T>>>;\n\n/**\n * Implementation\n */\nexport async function getUserAccount(\n  dbClient?: TDBWithTokenClient,\n  options?: { columnsToKeep?: Partial<Record<keyof TAccount, boolean>> },\n): Promise<TAccount | Partial<TAccount>> {\n  const client = dbClient || (await createDrizzleSupabaseClient());\n\n  const account = await client.rls(async (tx) => {\n    return tx.query.accounts.findFirst({\n      ...(options?.columnsToKeep && { columns: options.columnsToKeep }),\n    });\n  });\n\n  if (!account) throw new Error(\"account not found\");\n\n  return account;\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const WhatsAppTestClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call WhatsAppTestClient() from the server but WhatsAppTestClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/app/whatsapp/test/whatsapp-test-client.tsx\",\n    \"WhatsAppTestClient\",\n);\n","import { getUserAccount } from \"@/services/account.service\";\nimport { isWhatsAppConnected } from \"@/services/whatsapp.service\";\nimport { WhatsAppTestClient } from \"./whatsapp-test-client\";\n\nexport default async function WhatsAppTestPage() {\n  const account = await getUserAccount(undefined, {\n    columnsToKeep: { id: true, whatsappPhoneNumber: true, email: true },\n  });\n\n  // Fetch initial data if user is authenticated\n  let initialData = null;\n  if (account) {\n    const connected = await isWhatsAppConnected(account.id);\n\n    initialData = {\n      userId: account.id,\n      email: account.email,\n      phoneNumber: account.whatsappPhoneNumber,\n      isConnected: connected,\n    };\n  }\n\n  return <WhatsAppTestClient initialData={initialData} />;\n}\n"],"names":[],"mappings":"sCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OA2BO,eAAe,EACpB,CAA6B,CAC7B,CAAsE,EAEtE,IAAM,EAAS,GAAa,MAAM,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAEvD,EAAU,MAAM,EAAO,GAAG,CAAC,MAAO,GAC/B,EAAG,KAAK,CAAC,QAAQ,CAAC,SAAS,CAAC,CACjC,GAAI,GAAS,eAAiB,CAAE,QAAS,EAAQ,aAAa,AAAC,CAAC,AAClE,IAGF,GAAI,CAAC,EAAS,MAAM,AAAI,MAAM,qBAE9B,OAAO,CACT,uXCxCO,IAAM,EAAqB,CAAA,EADlC,AACkC,EADlC,CAAA,CAAA,OACkC,uBAAA,AAAuB,EACrD,WAAa,MAAU,AAAJ,MAAU,kPAAoP,EACjR,yIACA,gFAHG,IAAM,EAAqB,CAAA,EADlC,AACkC,EADlC,CAAA,CAAA,OACkC,uBAAA,AAAuB,EACrD,WAAa,MAAM,AAAI,MAAM,kPAAoP,EACjR,qHACA,yHCLJ,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,eAAe,IAC5B,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,OAAC,EAAW,CAC9C,cAAe,CAAE,IAAI,EAAM,qBAAqB,EAAM,OAAO,CAAK,CACpE,GAGI,EAAc,KAClB,GAAI,EAAS,CACX,IAAM,EAAY,MAAM,CAAA,EAAA,EAAA,mBAAA,AAAmB,EAAC,EAAQ,EAAE,EAEtD,EAAc,CACZ,OAAQ,EAAQ,EAAE,CAClB,MAAO,EAAQ,KAAK,CACpB,YAAa,EAAQ,mBAAmB,CACxC,YAAa,CACf,CACF,CAEA,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,kBAAkB,CAAA,CAAC,YAAa,GAC1C","ignoreList":[1]}