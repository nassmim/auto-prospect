{"version":3,"sources":["../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/services/lead.service.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/services/hunt.service.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/src/actions/hunt.actions.ts","../../../../../../../../../../Projets/auto-prospect-worktrees/config/mono-repo/apps/web/.next-internal/server/app/dashboard/hunts/%5Bid%5D/edit/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport type { SQL, TDBQuery, TDBWithTokenClient } from \"@auto-prospect/db\";\nimport { and, eq, gte, leads, messages, sql } from \"@auto-prospect/db\";\nimport { ELeadStage } from \"@auto-prospect/shared/src/config/lead.config\";\n\ntype TLeadsSummaryStats = {\n  todayLeadsCount: number;\n  contactedLeadsCount: number;\n  totalLeads: number;\n};\n\n/**\n * Fetch complete lead details with all relations\n * Used by lead drawer and full page view\n */\nexport async function getLeadDetails(leadId: string) {\n  // This function can be cached\n  // Will be invalidated when the user performs an action on this specific lead\n  const dbClient = await createDrizzleSupabaseClient();\n\n  try {\n    // Fetch lead with all ad relations\n    const leadData = await dbClient.rls(async (tx) => {\n      return tx.query.leads.findFirst({\n        where: eq(leads.id, leadId),\n        with: {\n          ad: {\n            with: {\n              brand: true,\n              fuel: true,\n              gearBox: true,\n              location: true,\n              type: true,\n              subtype: true,\n              vehicleState: true,\n              vehicleSeats: true,\n              drivingLicence: true,\n            },\n          },\n          assignedTo: {\n            columns: {\n              id: true,\n              name: true,\n            },\n          },\n          notes: {\n            orderBy: (notes, { desc }) => [desc(notes.createdAt)],\n          },\n          reminders: {\n            orderBy: (reminders, { asc }) => [asc(reminders.dueAt)],\n          },\n        },\n      });\n    });\n\n    if (!leadData) {\n      throw new Error(\"Lead not found\");\n    }\n\n    return leadData;\n  } catch (error) {\n    console.error(\"Error fetching lead details:\", error);\n    throw new Error(\"Failed to fetch lead details\");\n  }\n}\n\n/**\n * Fetch all members of the lead's account for assignment dropdown\n */\nexport async function getLeadAssociatedTeamMembers(leadId: string) {\n  // This function can be cached\n  // Will be invalidated when the user associates another member or removes the member association\n  const dbClient = await createDrizzleSupabaseClient();\n\n  try {\n    // First, get the lead's account\n    const lead = await dbClient.rls((tx) =>\n      tx.query.leads.findFirst({\n        where: eq(leads.id, leadId),\n        columns: {\n          accountId: true,\n        },\n      }),\n    );\n\n    if (!lead) {\n      throw new Error(\"Lead not found\");\n    }\n\n    // Fetch all members of this account\n    return await dbClient.rls((tx) =>\n      tx.query.teamMembers.findMany({\n        where: (table, { eq }) => eq(table.accountId, lead.accountId),\n      }),\n    );\n  } catch {\n    throw new Error(\"Failed to fetch account members\");\n  }\n}\n\n/**\n * Fetch message history for a lead\n */\nexport async function getLeadMessages(leadId: string) {\n  // This function can be cached\n  // Will be invalidated when the user sends a new message to this lead\n  const dbClient = await createDrizzleSupabaseClient();\n\n  try {\n    const messagesList = await dbClient.rls(async (tx) => {\n      return tx.query.messages.findMany({\n        where: eq(messages.leadId, leadId),\n        with: {\n          sentBy: {\n            columns: {\n              id: true,\n              name: true,\n            },\n          },\n        },\n        orderBy: (table, { desc }) => [desc(table.sentAt)],\n      });\n    });\n\n    return messagesList;\n  } catch {\n    throw new Error(\"Failed to fetch messages\");\n  }\n}\n\n/**\n * Fetch activity timeline for a lead\n */\nexport async function getLeadActivities(leadId: string) {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  try {\n    const activitiesList = await dbClient.rls(async (tx) => {\n      return tx.query.leadActivities.findMany({\n        where: (table, { eq }) => eq(table.leadId, leadId),\n        with: {\n          lead: {\n            with: {\n              assignedTo: {\n                columns: {\n                  id: true,\n                  name: true,\n                },\n              },\n            },\n          },\n        },\n        orderBy: (table, { desc }) => [desc(table.createdAt)],\n      });\n    });\n\n    return activitiesList;\n  } catch {\n    throw new Error(\"Failed to fetch activities\");\n  }\n}\n\n/**\n * Fetches leads acquired today\n */\nexport async function getTodayNewLeads(options?: {\n  huntId?: string;\n  dbClient?: TDBWithTokenClient;\n  tx?: TDBQuery;\n}): Promise<{ todayLeadsCount: number }> {\n  const { huntId, dbClient, tx } = options || {};\n\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  // Build where conditions dynamically based on whether huntId is provided\n  const whereConditions = [gte(leads.createdAt, today)];\n\n  if (huntId) {\n    whereConditions.push(eq(leads.huntId, huntId));\n  }\n\n  // If transaction provided, use it directly; otherwise create new RLS transaction\n  if (tx) {\n    const todayLeads = await tx\n      .select({ count: sql<number>`cast(count(*) as integer)` })\n      .from(leads)\n      .where(and(...whereConditions));\n\n    return {\n      todayLeadsCount: todayLeads[0]?.count ?? 0,\n    };\n  }\n\n  const client = dbClient || (await createDrizzleSupabaseClient());\n  const todayLeads = await client.rls(async (tx) =>\n    tx\n      .select({ count: sql<number>`cast(count(*) as integer)` })\n      .from(leads)\n      .where(and(...whereConditions)),\n  );\n\n  return {\n    todayLeadsCount: todayLeads[0]?.count ?? 0,\n  };\n}\n\n/**\n * Fetches the number of leads contacted\n */\nexport async function getContactedLeads(options?: {\n  huntId?: string;\n  dbClient?: TDBWithTokenClient;\n  tx?: TDBQuery;\n}): Promise<{ contactedLeadsCount: number }> {\n  const { huntId, dbClient, tx } = options || {};\n\n  // Build where conditions dynamically based on whether huntId is provided\n  const whereConditions = [eq(leads.stage, ELeadStage.CONTACTED)];\n\n  if (huntId) {\n    whereConditions.push(eq(leads.huntId, huntId));\n  }\n\n  // If transaction provided, use it directly; otherwise create new RLS transaction\n  if (tx) {\n    const contactedLeads = await tx\n      .select({ count: sql<number>`cast(count(*) as integer)` })\n      .from(leads)\n      .where(and(...whereConditions));\n\n    return {\n      contactedLeadsCount: contactedLeads[0]?.count ?? 0,\n    };\n  }\n\n  const client = dbClient || (await createDrizzleSupabaseClient());\n  const contactedLeads = await client.rls(async (tx) =>\n    tx\n      .select({ count: sql<number>`cast(count(*) as integer)` })\n      .from(leads)\n      .where(and(...whereConditions)),\n  );\n\n  return {\n    contactedLeadsCount: contactedLeads[0]?.count ?? 0,\n  };\n}\n\n/**\n * Fetches the total number of leads\n */\nexport async function getTotalLeads(options?: {\n  huntId?: string;\n  dbClient?: TDBWithTokenClient;\n  tx?: TDBQuery;\n}): Promise<{ totalLeads: number }> {\n  const { huntId, dbClient, tx } = options || {};\n\n  // Build where conditions dynamically based on whether huntId is provided\n  let whereConditions: SQL<unknown> | undefined;\n  if (huntId) whereConditions = eq(leads.huntId, huntId);\n\n  // If transaction provided, use it directly; otherwise create new RLS transaction\n  if (tx) {\n    const totalLeads = await tx\n      .select({ count: sql<number>`cast(count(*) as integer)` })\n      .from(leads)\n      .where(whereConditions);\n\n    return {\n      totalLeads: totalLeads[0]?.count ?? 0,\n    };\n  }\n\n  const client = dbClient || (await createDrizzleSupabaseClient());\n  const totalLeads = await client.rls(async (tx) =>\n    tx\n      .select({ count: sql<number>`cast(count(*) as integer)` })\n      .from(leads)\n      .where(whereConditions),\n  );\n\n  return {\n    totalLeads: totalLeads[0]?.count ?? 0,\n  };\n}\n\n/**\n * Fetches summary statistics for leads\n * @param huntId - Optional hunt ID to filter by specific hunt. If not provided, returns global stats for all hunts.\n */\nexport async function getLeadsSummaryStats(\n  huntId?: string,\n): Promise<TLeadsSummaryStats> {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  const summaryStats = await Promise.all([\n    getTodayNewLeads({ huntId, dbClient }),\n    getContactedLeads({ huntId, dbClient }),\n    getTotalLeads({ huntId, dbClient }),\n  ]);\n\n  return {\n    todayLeadsCount: summaryStats[0].todayLeadsCount,\n    contactedLeadsCount: summaryStats[1].contactedLeadsCount,\n    totalLeads: summaryStats[2].totalLeads,\n  };\n}\n\n/**\n * Fetches all leads for the pipeline/kanban view with minimal ad details\n * Returns leads grouped for easy rendering in Kanban columns\n */\nexport async function getPipelineLeads() {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  const pipelineLeads = await dbClient.rls(async (tx) => {\n    const rawLeads = await tx.query.leads.findMany({\n      orderBy: (table, { asc }) => [asc(table.stage), asc(table.position)],\n      with: {\n        ad: {\n          columns: {\n            id: true,\n            title: true,\n            price: true,\n            picture: true,\n            phoneNumber: true,\n            isWhatsappPhone: true,\n          },\n          with: {\n            location: {\n              columns: {\n                name: true,\n              },\n            },\n          },\n        },\n      },\n    });\n\n    // Transform to match KanbanView expected structure\n    return rawLeads.map((lead) => ({\n      id: lead.id,\n      stage: lead.stage,\n      position: lead.position,\n      ad: {\n        title: lead.ad.title,\n        price: lead.ad.price,\n        picture: lead.ad.picture,\n        phoneNumber: lead.ad.phoneNumber,\n        isWhatsappPhone: lead.ad.isWhatsappPhone,\n        zipcode: {\n          name: lead.ad.location.name,\n        },\n      },\n    }));\n  });\n\n  return pipelineLeads;\n}\n\nexport type TPipelineLead = Awaited<\n  ReturnType<typeof getPipelineLeads>\n>[number];\n","import { CACHE_TAGS } from \"@/lib/cache.config\";\nimport { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport { getUserAccount } from \"@/services/account.service\";\nimport { getContactedLeads, getTotalLeads } from \"@/services/lead.service\";\nimport { TDBWithTokenClient } from \"@auto-prospect/db\";\nimport { HUNT_WITH_RELATIONS, THuntSummary } from \"@auto-prospect/shared\";\nimport { EHuntStatus } from \"@auto-prospect/shared/src/config/hunt.config\";\nimport { cacheTag, updateTag } from \"next/cache\";\n\n/**\n * Fetches hunt configurations (without credits) - CACHED\n * This is the cached version that only returns hunt config\n */\nexport async function getAccountHuntsConfig() {\n  const dbClient = await createDrizzleSupabaseClient();\n  const account = await getUserAccount(dbClient, {\n    columnsToKeep: { id: true },\n  });\n  return getCachedAccountHuntsConfig(account.id, dbClient);\n}\n\n/**\n * Internal cached function for hunt configurations\n */\nasync function getCachedAccountHuntsConfig(\n  accountId: string,\n  dbClient?: TDBWithTokenClient,\n) {\n  \"use cache\";\n\n  cacheTag(CACHE_TAGS.huntsByAccount(accountId));\n\n  const client = dbClient || (await createDrizzleSupabaseClient());\n\n  // Use RLS wrapper to ensure user can only see their account's hunts\n  const huntsData = await client.rls(async (tx) => {\n    return tx.query.hunts.findMany({\n      orderBy: (table, { desc }) => [desc(table.createdAt)],\n      with: HUNT_WITH_RELATIONS,\n    });\n  });\n\n  return huntsData;\n}\n\n/**\n * Fetches channel credits for multiple hunts - NOT CACHED\n * Called separately when credit display is needed\n */\nexport async function getHuntsChannelCredits(huntIds: string[]) {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  const allChannelCredits = await dbClient.rls(async (tx) => {\n    return tx.query.huntChannelCredits.findMany({\n      where: (table, { inArray }) => inArray(table.huntId, huntIds),\n    });\n  });\n\n  // Group credits by hunt ID\n  const creditsByHuntId = new Map<string, typeof allChannelCredits>();\n  for (const credit of allChannelCredits) {\n    if (!creditsByHuntId.has(credit.huntId)) {\n      creditsByHuntId.set(credit.huntId, []);\n    }\n    creditsByHuntId.get(credit.huntId)!.push(credit);\n  }\n\n  return creditsByHuntId;\n}\n\n/**\n * Fetches all hunts for the current user's account with channel credits\n * Combines cached config with fresh credits\n */\nexport async function getAccountHunts() {\n  // Get cached hunt configs\n  const huntsData = await getAccountHuntsConfig();\n\n  if (huntsData.length === 0) {\n    return [];\n  }\n\n  // Fetch fresh channel credits\n  const huntIds = huntsData.map(({ id }) => id);\n  const creditsByHuntId = await getHuntsChannelCredits(huntIds);\n\n  // Attach credits to each hunt\n  return huntsData.map((hunt) => ({\n    ...hunt,\n    channelCredits: creditsByHuntId.get(hunt.id) || [],\n  }));\n}\n\n/**\n * Fetches hunt config by ID (without credits) - CACHED\n */\nexport async function getHuntConfigById(huntId: string) {\n  const dbClient = await createDrizzleSupabaseClient();\n  const account = await getUserAccount(dbClient, {\n    columnsToKeep: { id: true },\n  });\n  return getCachedHuntConfigById(huntId, account.id, dbClient);\n}\n\n/**\n * Internal cached function for single hunt config\n */\nasync function getCachedHuntConfigById(\n  huntId: string,\n  accountId: string,\n  dbClient?: TDBWithTokenClient,\n) {\n  \"use cache\";\n\n  cacheTag(CACHE_TAGS.hunt(huntId), CACHE_TAGS.huntsByAccount(accountId));\n\n  const client = dbClient || (await createDrizzleSupabaseClient());\n\n  const hunt = await client.rls(async (tx) => {\n    return tx.query.hunts.findFirst({\n      where: (table, { eq }) => eq(table.id, huntId),\n      with: HUNT_WITH_RELATIONS,\n    });\n  });\n\n  if (!hunt) {\n    throw new Error(\"hunt not found\");\n  }\n\n  return hunt;\n}\n\n/**\n * Fetches a single hunt by ID with channel credits\n * Combines cached config with fresh credits\n */\nexport async function getHuntById(huntId: string) {\n  // Get cached hunt config\n  const hunt = await getHuntConfigById(huntId);\n\n  // Fetch fresh channel credits\n  const dbClient = await createDrizzleSupabaseClient();\n  const channelCreditsData = await dbClient.rls(async (tx) => {\n    return tx.query.huntChannelCredits.findMany({\n      where: (table, { eq }) => eq(table.huntId, huntId),\n    });\n  });\n\n  return {\n    ...hunt,\n    channelCredits: channelCreditsData,\n  };\n}\n\n/**\n * Fetches active hunts with summary data for dashboard\n */\nexport async function getActiveHunts(): Promise<THuntSummary[]> {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  const hunts = await dbClient.rls(async (tx) => {\n    // Fetch hunts with lead counts\n    const huntsData = await tx.query.hunts.findMany({\n      where: (table, { eq }) => eq(table.status, EHuntStatus.ACTIVE),\n      orderBy: (table, { desc }) => [\n        desc(table.lastScanAt),\n        desc(table.createdAt),\n      ],\n      limit: 10, // Show top 10 active hunts\n    });\n\n    // Get lead counts for each hunt - pass transaction to avoid nested RLS calls\n    const huntSummaries: THuntSummary[] = await Promise.all(\n      huntsData.map(async (hunt) => {\n        const [{ totalLeads }, { contactedLeadsCount }] = await Promise.all([\n          getTotalLeads({ huntId: hunt.id, tx }),\n          getContactedLeads({ huntId: hunt.id, tx }),\n        ]);\n\n        return {\n          id: hunt.id,\n          name: hunt.name,\n          status: hunt.status,\n          leadCount: totalLeads,\n          contactedCount: contactedLeadsCount,\n          lastScanAt: hunt.lastScanAt,\n          createdAt: hunt.createdAt,\n        };\n      }),\n    );\n\n    return huntSummaries;\n  });\n\n  return hunts;\n}\n\nexport const updateAccountHuntsCache = async (\n  dbClient: TDBWithTokenClient,\n  huntId?: string,\n  accountId?: string,\n) => {\n  let accountIdToUse = accountId;\n  if (!accountIdToUse) {\n    const account = await getUserAccount(dbClient, {\n      columnsToKeep: { id: true },\n    });\n    accountIdToUse = account.id;\n  }\n\n  updateTag(CACHE_TAGS.huntsByAccount(accountIdToUse));\n  if (huntId) updateTag(CACHE_TAGS.hunt(huntId));\n};\n","\"use server\";\n\nimport { CACHE_TAGS } from \"@/lib/cache.config\";\nimport { createDrizzleSupabaseClient } from \"@/lib/db\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { formatZodError } from \"@/lib/validation\";\nimport { getUserAccount } from \"@/services/account.service\";\nimport {\n  getAccountHunts,\n  getHuntById,\n  updateAccountHuntsCache,\n} from \"@/services/hunt.service\";\nimport { createHuntSchema, updateHuntSchema } from \"@/validation-schemas\";\nimport {\n  brandsHunts,\n  eq,\n  huntChannelCredits,\n  hunts,\n  subTypesHunts,\n} from \"@auto-prospect/db\";\nimport {\n  EHuntStatus,\n  THuntStatus,\n} from \"@auto-prospect/shared/src/config/hunt.config\";\nimport {\n  EContactChannel,\n  WHATSAPP_DAILY_LIMIT,\n} from \"@auto-prospect/shared/src/config/message.config\";\nimport { updateTag } from \"next/cache\";\n\n/**\n * Fetches all hunts for the current user's account\n * Server action wrapper for SWR client-side fetching\n */\nexport async function fetchAccountHunts() {\n  return getAccountHunts();\n}\n\n/**\n * Fetches a single hunt by ID\n * Server action wrapper for SWR client-side fetching\n */\nexport async function fetchHuntById(huntId: string) {\n  return getHuntById(huntId);\n}\n\n/**\n * Creates a new hunt\n */\nexport async function createHunt(data: unknown) {\n  // Validate input with Zod\n  const parseResult = createHuntSchema.safeParse(data);\n  if (!parseResult.success) {\n    throw new Error(formatZodError(parseResult.error));\n  }\n\n  const validatedData = parseResult.data;\n\n  const dbClient = await createDrizzleSupabaseClient();\n  const account = await getUserAccount(dbClient, {\n    columnsToKeep: { id: true },\n  });\n\n  // Create the hunt with RLS enforcement\n  const hunt = await dbClient.rls(async (tx) => {\n    // Insert the main hunt record\n    const [newHunt] = await tx\n      .insert(hunts)\n      .values({\n        accountId: account.id,\n        name: validatedData.name,\n        locationId: validatedData.locationId,\n        typeId: validatedData.adTypeId,\n        status: EHuntStatus.ACTIVE,\n        radiusInKm: validatedData.radiusInKm,\n        dailyPacingLimit: validatedData.dailyPacingLimit,\n        autoRefresh: validatedData.autoRefresh,\n        outreachSettings: validatedData.outreachSettings,\n        templateIds: validatedData.templateIds,\n        priceMin: validatedData.priceMin,\n        priceMax: validatedData.priceMax,\n        mileageMin: validatedData.mileageMin,\n        mileageMax: validatedData.mileageMax,\n        modelYearMin: validatedData.modelYearMin,\n        modelYearMax: validatedData.modelYearMax,\n        hasBeenReposted: validatedData.hasBeenReposted,\n        priceHasDropped: validatedData.priceHasDropped,\n        isUrgent: validatedData.isUrgent,\n        hasBeenBoosted: validatedData.hasBeenBoosted,\n        isLowPrice: validatedData.isLowPrice,\n      })\n      .returning();\n\n    // Insert brand filters if provided\n    if (validatedData.brandIds?.length) {\n      await tx.insert(brandsHunts).values(\n        validatedData.brandIds.map((brandId) => ({\n          huntId: newHunt.id,\n          brandId,\n        })),\n      );\n    }\n\n    // Insert subType filters if provided\n    if (validatedData.subTypeIds?.length) {\n      await tx.insert(subTypesHunts).values(\n        validatedData.subTypeIds.map((subTypeId) => ({\n          huntId: newHunt.id,\n          subTypeId,\n        })),\n      );\n    }\n\n    // Insert channel credit allocations for enabled channels\n    const channelCreditsToInsert = [];\n\n    if (\n      validatedData.channelCredits?.sms &&\n      validatedData.channelCredits.sms > 0\n    ) {\n      channelCreditsToInsert.push({\n        huntId: newHunt.id,\n        channel: EContactChannel.SMS,\n        creditsAllocated: validatedData.channelCredits.sms,\n        creditsConsumed: 0,\n      });\n    }\n\n    // WhatsApp: auto-allocate daily limit (unlimited for users, hard limit to prevent abuse)\n    if (validatedData.outreachSettings?.whatsapp) {\n      channelCreditsToInsert.push({\n        huntId: newHunt.id,\n        channel: EContactChannel.WHATSAPP_TEXT,\n        creditsAllocated: WHATSAPP_DAILY_LIMIT,\n        creditsConsumed: 0,\n      });\n    }\n\n    if (\n      validatedData.channelCredits?.ringlessVoice &&\n      validatedData.channelCredits.ringlessVoice > 0\n    ) {\n      channelCreditsToInsert.push({\n        huntId: newHunt.id,\n        channel: EContactChannel.RINGLESS_VOICE,\n        creditsAllocated: validatedData.channelCredits.ringlessVoice,\n        creditsConsumed: 0,\n      });\n    }\n\n    if (channelCreditsToInsert.length > 0) {\n      await tx.insert(huntChannelCredits).values(channelCreditsToInsert);\n    }\n\n    return newHunt;\n  });\n\n  updateTag(CACHE_TAGS.huntsByAccount(account.id));\n\n  return hunt;\n}\n\n/**\n * Updates hunt status (active/paused)\n */\nexport async function updateHuntStatus(huntId: string, status: THuntStatus) {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  const [updatedHunt] = await dbClient.rls(async (tx) => {\n    return tx\n      .update(hunts)\n      .set({ status })\n      .where(eq(hunts.id, huntId))\n      .returning();\n  });\n\n  await updateAccountHuntsCache(dbClient, huntId);\n\n  return updatedHunt;\n}\n\n/**\n * Updates hunt details and channel credits\n */\nexport async function updateHunt(huntId: string, data: unknown) {\n  // Validate input with Zod\n  const parseResult = updateHuntSchema.safeParse(data);\n  if (!parseResult.success) {\n    throw new Error(formatZodError(parseResult.error));\n  }\n\n  const validatedData = parseResult.data;\n\n  const dbClient = await createDrizzleSupabaseClient();\n\n  const [updatedHunt] = await dbClient.rls(async (tx) => {\n    const result = await tx\n      .update(hunts)\n      .set(validatedData)\n      .where(eq(hunts.id, huntId))\n      .returning();\n\n    return result;\n  });\n\n  await updateAccountHuntsCache(dbClient, huntId);\n\n  return updatedHunt;\n}\n\n/**\n * Updates or creates hunt channel credit allocations\n */\nexport async function updateHuntChannelCredits(\n  huntId: string,\n  channelCredits: {\n    sms?: number;\n    whatsapp?: number;\n    ringlessVoice?: number;\n  },\n) {\n  const supabase = await createClient();\n  const { data: userData } = await supabase.auth.getUser();\n\n  if (!userData.user) {\n    throw new Error(\"Non authentifiÃ©\");\n  }\n\n  const dbClient = await createDrizzleSupabaseClient();\n\n  await dbClient.rls(async (tx) => {\n    // Handle SMS credits\n    if (channelCredits.sms !== undefined) {\n      if (channelCredits.sms > 0) {\n        // Upsert: try to update, if not exists insert\n        const existing = await tx.query.huntChannelCredits.findFirst({\n          where: (table, { and, eq }) =>\n            and(\n              eq(table.huntId, huntId),\n              eq(table.channel, EContactChannel.SMS),\n            ),\n        });\n\n        if (existing) {\n          await tx\n            .update(huntChannelCredits)\n            .set({ creditsAllocated: channelCredits.sms })\n            .where(eq(huntChannelCredits.id, existing.id));\n        } else {\n          await tx.insert(huntChannelCredits).values({\n            huntId,\n            channel: EContactChannel.SMS,\n            creditsAllocated: channelCredits.sms,\n            creditsConsumed: 0,\n          });\n        }\n      }\n    }\n\n    // Handle WhatsApp credits - always set to daily limit (unlimited for users)\n    // Note: This function may not be called for WhatsApp anymore since it's auto-allocated\n    // Keeping this for backward compatibility and manual adjustments if needed\n    if (channelCredits.whatsapp !== undefined) {\n      const creditsToAllocate = WHATSAPP_DAILY_LIMIT; // Always use hard-coded limit\n\n      const existing = await tx.query.huntChannelCredits.findFirst({\n        where: (table, { and, eq }) =>\n          and(\n            eq(table.huntId, huntId),\n            eq(table.channel, EContactChannel.WHATSAPP_TEXT),\n          ),\n      });\n\n      if (existing) {\n        await tx\n          .update(huntChannelCredits)\n          .set({ creditsAllocated: creditsToAllocate })\n          .where(eq(huntChannelCredits.id, existing.id));\n      } else {\n        await tx.insert(huntChannelCredits).values({\n          huntId,\n          channel: EContactChannel.WHATSAPP_TEXT,\n          creditsAllocated: creditsToAllocate,\n          creditsConsumed: 0,\n        });\n      }\n    }\n\n    // Handle Ringless Voice credits\n    if (channelCredits.ringlessVoice !== undefined) {\n      if (channelCredits.ringlessVoice > 0) {\n        const existing = await tx.query.huntChannelCredits.findFirst({\n          where: (table, { and, eq }) =>\n            and(\n              eq(table.huntId, huntId),\n              eq(table.channel, EContactChannel.RINGLESS_VOICE),\n            ),\n        });\n\n        if (existing) {\n          await tx\n            .update(huntChannelCredits)\n            .set({ creditsAllocated: channelCredits.ringlessVoice })\n            .where(eq(huntChannelCredits.id, existing.id));\n        } else {\n          await tx.insert(huntChannelCredits).values({\n            huntId,\n            channel: EContactChannel.RINGLESS_VOICE,\n            creditsAllocated: channelCredits.ringlessVoice,\n            creditsConsumed: 0,\n          });\n        }\n      }\n    }\n  });\n\n  return { success: true };\n}\n\n/**\n * Deletes a hunt\n */\nexport async function deleteHunt(huntId: string) {\n  const dbClient = await createDrizzleSupabaseClient();\n\n  await dbClient.rls(async (tx) => {\n    return tx.delete(hunts).where(eq(hunts.id, huntId));\n  });\n\n  await updateAccountHuntsCache(dbClient, huntId);\n\n  return { success: true };\n}\n","export {createHunt as '40bc40327414d65c149623d29751f6236173c3d9aa'} from 'ACTIONS_MODULE0'\nexport {updateHunt as '60611e6860255adc0799d2db64bb54465f1f907a39'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_CACHE_0 as 'e0c6d22713dddd2f666ea2bc6c4707dc5bd51b4e50'} from 'ACTIONS_MODULE1'\nexport {$$RSC_SERVER_CACHE_1 as 'f0165f65ac6657ab99c1343b90c7d1753d9ed0dfd5'} from 'ACTIONS_MODULE1'\nexport {$$RSC_SERVER_CACHE_0 as 'e0d884f19ec9288fa94a30ca8841972647d88a166f'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"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"}